<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>004_performanceTuning_sqlProgGuide - sds-3.x/ScaDaMaLe</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../../../favicon.png">
        
        <link rel="stylesheet" href="../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../css/general.css">
        <link rel="stylesheet" href="../../../../css/chrome.css">
        
        <link rel="stylesheet" href="../../../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../highlight.css">
        <link rel="stylesheet" href="../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../../../../scroll-mdbook-outputs.css">
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../contents/000_1-sds-3-x/033_OBO_LoadExtract.html">033_OBO_LoadExtract</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/000_2-sds-3-x-ml/033_OBO_LoadExtract.html">033_OBO_LoadExtract</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/LinearAlgebra/LAlgCheatSheet.html">LAlgCheatSheet</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/000_MLlibProgGuide.html">000_MLlibProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/000_dataTypesProgGuide.html">000_dataTypesProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/001_LocalVector.html">001_LocalVector</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/002_LabeledPoint.html">002_LabeledPoint</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/003_LocalMatrix.html">003_LocalMatrix</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/004_DistributedMatrix.html">004_DistributedMatrix</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/005_RowMatrix.html">005_RowMatrix</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/006_IndexedRowMatrix.html">006_IndexedRowMatrix</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/007_CoordinateMatrix.html">007_CoordinateMatrix</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/MLlibProgrammingGuide/dataTypes/008_BlockMatrix.html">008_BlockMatrix</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/000_sqlProgGuide.html">000_sqlProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/001_overview_sqlProgGuide.html">001_overview_sqlProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/002_gettingStarted_sqlProgGuide.html">002_gettingStarted_sqlProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/003_dataSources_sqlProgGuide.html">003_dataSources_sqlProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/004_performanceTuning_sqlProgGuide.html" class="active">004_performanceTuning_sqlProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/005_distributedSqlEngine_sqlProgGuide.html">005_distributedSqlEngine_sqlProgGuide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/sdsDatasets/scraperUSStateofUnionAddresses.html">scraperUSStateofUnionAddresses</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/support/sdsFunctions.html">sdsFunctions</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/guide.html">guide</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/actions/collect.html">collect</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/actions/getNumPartitions.html">getNumPartitions</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/actions/reduce.html">reduce</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/coalesce.html">coalesce</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/distinct.html">distinct</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/filter.html">filter</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/flatMap.html">flatMap</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/groupByKey.html">groupByKey</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/groupBy.html">groupBy</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/join.html">join</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/keyBy.html">keyBy</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/map.html">map</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/mapPartitions.html">mapPartitions</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/mapPartitionsWithIndex.html">mapPartitionsWithIndex</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/partitionBy.html">partitionBy</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/reduceByKey.html">reduceByKey</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/sample.html">sample</a></li><li class="chapter-item expanded affix "><a href="../../../../contents/xtraResources/visualRDDApi/recall/transformations/union.html">union</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">sds-3.x/ScaDaMaLe</h1>

                    <div class="right-buttons">
                        
                        <a href="../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<h1 id="a-hrefhttpslamastexgithubioscalable-data-sciencesds22sds-22-scalable-data-sciencea"><a class="header" href="#a-hrefhttpslamastexgithubioscalable-data-sciencesds22sds-22-scalable-data-sciencea"><a href="https://lamastex.github.io/scalable-data-science/sds/2/2/">SDS-2.2, Scalable Data Science</a></a></h1>
</div>
<div class="cell markdown">
<p>This is an elaboration of the <a href="http://spark.apache.org/docs/latest/sql-programming-guide.html">Apache Spark 2.2 sql-progamming-guide</a>.</p>
<h1 id="a-hrefworkspacescalable-data-sciencextraresourcesprogguides1_6sqlprogrammingguide004_performancetuning_sqlprogguideperformance-tuninga"><a class="header" href="#a-hrefworkspacescalable-data-sciencextraresourcesprogguides1_6sqlprogrammingguide004_performancetuning_sqlprogguideperformance-tuninga"><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/004_performanceTuning_sqlProgGuide">Performance Tuning</a></a></h1>
<h2 id="a-hrefworkspacescalable-data-sciencextraresourcesprogguides1_6sqlprogrammingguide000_sqlprogguidespark-sql-programming-guidea"><a class="header" href="#a-hrefworkspacescalable-data-sciencextraresourcesprogguides1_6sqlprogrammingguide000_sqlprogguidespark-sql-programming-guidea"><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/000_sqlProgGuide">Spark Sql Programming Guide</a></a></h2>
<ul>
<li><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/001_overview_sqlProgGuide">Overview</a>
<ul>
<li>SQL</li>
<li>DataFrames</li>
<li>Datasets</li>
</ul>
</li>
<li><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/002_gettingStarted_sqlProgGuide">Getting Started</a>
<ul>
<li>Starting Point: SQLContext</li>
<li>Creating DataFrames</li>
<li>DataFrame Operations</li>
<li>Running SQL Queries Programmatically</li>
<li>Creating Datasets</li>
<li>Interoperating with RDDs
<ul>
<li>Inferring the Schema Using Reflection</li>
<li>Programmatically Specifying the Schema</li>
</ul>
</li>
</ul>
</li>
<li><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/003_dataSources_sqlProgGuide">Data Sources</a>
<ul>
<li>Generic Load/Save Functions
<ul>
<li>Manually Specifying Options</li>
<li>Run SQL on files directly</li>
<li>Save Modes</li>
<li>Saving to Persistent Tables</li>
</ul>
</li>
<li>Parquet Files
<ul>
<li>Loading Data Programmatically</li>
<li>Partition Discovery</li>
<li>Schema Merging</li>
<li>Hive metastore Parquet table conversion
<ul>
<li>Hive/Parquet Schema Reconciliation</li>
<li>Metadata Refreshing</li>
</ul>
</li>
<li>Configuration</li>
</ul>
</li>
<li>JSON Datasets</li>
<li>Hive Tables
<ul>
<li>Interacting with Different Versions of Hive Metastore</li>
</ul>
</li>
<li>JDBC To Other Databases</li>
<li>Troubleshooting</li>
</ul>
</li>
<li><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/004_performanceTuning_sqlProgGuide">Performance Tuning</a>
<ul>
<li>Caching Data In Memory</li>
<li>Other Configuration Options</li>
</ul>
</li>
<li><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/005_distributedSqlEngine_sqlProgGuide">Distributed SQL Engine</a>
<ul>
<li>Running the Thrift JDBC/ODBC server</li>
<li>Running the Spark SQL CLI</li>
</ul>
</li>
</ul>
</div>
<div class="cell markdown">
<h1 id="a-hrefworkspacescalable-data-sciencextraresourcesprogguides1_6sqlprogrammingguide004_performancetuning_sqlprogguideperformance-tuninga-1"><a class="header" href="#a-hrefworkspacescalable-data-sciencextraresourcesprogguides1_6sqlprogrammingguide004_performancetuning_sqlprogguideperformance-tuninga-1"><a href="/#workspace/scalable-data-science/xtraResources/ProgGuides1_6/sqlProgrammingGuide/004_performanceTuning_sqlProgGuide">Performance Tuning</a></a></h1>
<p>For some workloads it is possible to improve performance by either caching data in memory, or by turning on some experimental options.</p>
<h2 id="caching-data-in-memory"><a class="header" href="#caching-data-in-memory">Caching Data In Memory</a></h2>
<p>Spark SQL can cache tables using an in-memory columnar format by calling <code>spark.cacheTable(&quot;tableName&quot;)</code> or <code>dataset.cache()</code>. Then Spark SQL will scan only required columns and will automatically tune compression to minimize memory usage and GC pressure. You can call <code>spark.uncacheTable(&quot;tableName&quot;)</code> to remove the table from memory.</p>
<p>Configuration of in-memory caching can be done using the <code>setConf</code> method on <code>SparkSession</code> or by running <code>SET key=value</code> commands using SQL.</p>
<table><thead><tr><th>Property Name</th><th>Default</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>spark.sql.inMemoryColumnarStorage.compressed</code></td><td>true</td><td>When set to true Spark SQL will automatically select a compression codec for each column based on statistics of the data.</td></tr>
<tr><td><code>spark.sql.inMemoryColumnarStorage.batchSize</code></td><td>10000</td><td>Controls the size of batches for columnar caching. Larger batch sizes can improve memory utilization and compression, but risk OOMs when caching data.</td></tr>
</tbody></table>
<h2 id="other-configuration-options"><a class="header" href="#other-configuration-options">Other Configuration Options</a></h2>
<p>The following options can also be used to tune the performance of query execution. It is possible that these options will be deprecated in future release as more optimizations are performed automatically.</p>
<table><thead><tr><th>Property Name</th><th>Default</th><th>Meaning</th></tr></thead><tbody>
<tr><td><code>spark.sql.autoBroadcastJoinThreshold</code></td><td>10485760 (10 MB)</td><td>Configures the maximum size in bytes for a table that will be broadcast to all worker nodes when performing a join. By setting this value to -1 broadcasting can be disabled. Note that currently statistics are only supported for Hive Metastore tables where the command <code>ANALYZE TABLE &lt;tableName&gt; COMPUTE STATISTICS noscan</code> has been run.</td></tr>
<tr><td><code>spark.sql.tungsten.enabled</code></td><td>true</td><td>When true, use the optimized Tungsten physical execution backend which explicitly manages memory and dynamically generates bytecode for expression evaluation.</td></tr>
<tr><td><code>spark.sql.shuffle.partitions</code></td><td>200</td><td>Configures the number of partitions to use when shuffling data for joins or aggregations.</td></tr>
</tbody></table>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/003_dataSources_sqlProgGuide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/005_distributedSqlEngine_sqlProgGuide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/003_dataSources_sqlProgGuide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../../../contents/xtraResources/ProgGuides2_2/sqlProgrammingGuide/005_distributedSqlEngine_sqlProgGuide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
