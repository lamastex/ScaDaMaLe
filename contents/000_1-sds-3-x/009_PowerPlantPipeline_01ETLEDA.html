<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>009_PowerPlantPipeline_01ETLEDA - ScaDaMaLe/sds-3.x</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <link rel="stylesheet" href="../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../../scroll-mdbook-outputs.css">
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/000_ScaDaMaLe.html">000_ScaDaMaLe</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/001_whySpark.html">001_whySpark</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/002_00_loginToDatabricks.html">002_00_loginToDatabricks</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/002_01_multiLingualNotebooks.html">002_01_multiLingualNotebooks</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/003_00_scalaCrashCourse.html">003_00_scalaCrashCourse</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/003_01_scalaCrashCourse.html">003_01_scalaCrashCourse</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/004_RDDsTransformationsActions.html">004_RDDsTransformationsActions</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/005_RDDsTransformationsActionsHOMEWORK.html">005_RDDsTransformationsActionsHOMEWORK</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/006a_PipedRDD.html">006a_PipedRDD</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/006_WordCount.html">006_WordCount</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007a_SparkSQLProgGuide_HW.html">007a_SparkSQLProgGuide_HW</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html">007b_SparkSQLProgGuide_HW</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007c_SparkSQLProgGuide_HW.html">007c_SparkSQLProgGuide_HW</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html">007d_SparkSQLProgGuide_HW</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007e_SparkSQLProgGuide_HW.html">007e_SparkSQLProgGuide_HW</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html">007f_SparkSQLProgGuide_HW</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007g_PivotInSQL.html">007g_PivotInSQL</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/007_SparkSQLIntroBasics.html">007_SparkSQLIntroBasics</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html">008_DiamondsPipeline_01ETLEDA</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html" class="active">009_PowerPlantPipeline_01ETLEDA</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html">010_wikipediaClickStream_01ETLEDA</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/033_OBO_LoadExtract.html">033_OBO_LoadExtract</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html">033_OBO_PipedRDD_RigorousBayesianABTesting</a></li><li class="chapter-item expanded affix "><a href="../../contents/000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">035_LDA_CornellMovieDialogs</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">ScaDaMaLe/sds-3.x</h1>

                    <div class="right-buttons">
                        
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="cell markdown">
<p>ScaDaMaLe Course <a href="https://lamastex.github.io/scalable-data-science/sds/3/x/">site</a> and <a href="https://lamastex.github.io/ScaDaMaLe/index.html">book</a></p>
</div>
<div class="cell markdown">
<h3 id="power-plant-ml-pipeline-application---dataframe-part"><a class="header" href="#power-plant-ml-pipeline-application---dataframe-part">Power Plant ML Pipeline Application - DataFrame Part</a></h3>
<p>This is the Spark SQL parts of an end-to-end example of using a number of different machine learning algorithms to solve a supervised regression problem.</p>
<p>This is a break-down of <em>Power Plant ML Pipeline Application</em> from databricks.</p>
<p><strong>This will be a recurring example in the sequel</strong></p>
<h5 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h5>
<ul>
<li><strong>Step 1: Business Understanding</strong></li>
<li><strong>Step 2: Load Your Data</strong></li>
<li><strong>Step 3: Explore Your Data</strong></li>
<li><strong>Step 4: Visualize Your Data</strong></li>
<li><em>Step 5: Data Preparation</em></li>
<li><em>Step 6: Data Modeling</em></li>
<li><em>Step 7: Tuning and Evaluation</em></li>
<li><em>Step 8: Deployment</em></li>
</ul>
<p><em>We are trying to predict power output given a set of readings from various sensors in a gas-fired power generation plant. Power generation is a complex process, and understanding and predicting power output is an important element in managing a plant and its connection to the power grid.</em></p>
<ul>
<li>Given this business problem, we need to translate it to a Machine Learning task (actually a <em>Statistical</em> Machine Learning task).</li>
<li>The ML task here is <em>regression</em> since the label (or target) we will be trying to predict takes a <em>continuous numeric</em> value
<ul>
<li>Note: if the labels took values from a finite discrete set, such as, <code>Spam</code>/<code>Not-Spam</code> or <code>Good</code>/<code>Bad</code>/<code>Ugly</code>, then the ML task would be <em>classification</em>.</li>
</ul>
</li>
</ul>
<p><strong>Today, we will only cover Steps 1, 2, 3 and 4 above</strong>. You need introductions to linear algebra, stochastic gradient descent and decision trees before we can accomplish the <strong>applied ML task</strong> with some intuitive understanding. If you can't wait for ML then <strong>check out <a href="https://spark.apache.org/docs/latest/mllib-guide.html">Spark MLLib Programming Guide</a> for comming attractions!</strong></p>
<p>The example data is provided by UCI at <a href="https://archive.ics.uci.edu/ml/datasets/Combined+Cycle+Power+Plant">UCI Machine Learning Repository Combined Cycle Power Plant Data Set</a></p>
<p>You can read the background on the UCI page, but in summary:</p>
<ul>
<li>we have collected a number of readings from sensors at a Gas Fired Power Plant (also called a Peaker Plant) and</li>
<li>want to use those sensor readings to predict how much power the plant will generate in a couple weeks from now.</li>
<li>Again, today we will just focus on Steps 1-4 above that pertain to DataFrames.</li>
</ul>
<p>More information about Peaker or Peaking Power Plants can be found on Wikipedia <a href="https://en.wikipedia.org/wiki/Peaking_power_plant">https://en.wikipedia.org/wiki/Peaking<em>power</em>plant</a>.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//This allows easy embedding of publicly available information into any other notebook
//when viewing in git-book just ignore this block - you may have to manually chase the URL in frameIt(&quot;URL&quot;).
//Example usage:
// displayHTML(frameIt(&quot;https://en.wikipedia.org/wiki/Latent_Dirichlet_allocation#Topics_in_LDA&quot;,250))
def frameIt( u:String, h:Int ) : String = {
      &quot;&quot;&quot;&lt;iframe 
 src=&quot;&quot;&quot;&quot;+ u+&quot;&quot;&quot;&quot;
 width=&quot;95%&quot; height=&quot;&quot;&quot;&quot; + h + &quot;&quot;&quot;&quot;
 sandbox&gt;
  &lt;p&gt;
    &lt;a href=&quot;http://spark.apache.org/docs/latest/index.html&quot;&gt;
      Fallback link for browsers that, unlikely, don't support frames
    &lt;/a&gt;
  &lt;/p&gt;
&lt;/iframe&gt;&quot;&quot;&quot;
   }
displayHTML(frameIt(&quot;https://en.wikipedia.org/wiki/Peaking_power_plant&quot;,300))
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">displayHTML(frameIt(&quot;https://archive.ics.uci.edu/ml/datasets/Combined+Cycle+Power+Plant&quot;,500))
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">sc.version.replace(&quot;.&quot;, &quot;&quot;).toInt
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">// a good habit to ensure the code is being run on the appropriate version of Spark - we are using Spark 2.2 actually if we use SparkSession object spark down the road...
require(sc.version.replace(&quot;.&quot;, &quot;&quot;).toInt &gt;= 140, &quot;Spark 1.4.0+ is required to run this notebook. Please attach it to a Spark 1.4.0+ cluster.&quot;)
</code></pre>
</div>
<div class="cell markdown">
<h2 id="step-1-business-understanding"><a class="header" href="#step-1-business-understanding">Step 1: Business Understanding</a></h2>
<p>The first step in any machine learning task is to understand the business need.</p>
<p>As described in the overview we are trying to predict power output given a set of readings from various sensors in a gas-fired power generation plant.</p>
<p>The problem is a regression problem since the label (or target) we are trying to predict is numeric</p>
</div>
<div class="cell markdown">
<h2 id="step-2-load-your-data"><a class="header" href="#step-2-load-your-data">Step 2: Load Your Data</a></h2>
<p>Now that we understand what we are trying to do, we need to load our data and describe it, explore it and verify it.</p>
</div>
<div class="cell markdown">
<p>Data was downloaded already as these five Tab-separated-variable or tsv files.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(dbutils.fs.ls(&quot;/databricks-datasets/power-plant/data&quot;)) // Ctrl+Enter
</code></pre>
</div>
<div class="cell markdown">
<p>Now let us load the data from the Tab-separated-variable or tsv text file into an <code>RDD[String]</code> using the familiar <code>textFile</code> method.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">val powerPlantRDD = sc.textFile(&quot;/databricks-datasets/power-plant/data/Sheet1.tsv&quot;) // Ctrl+Enter
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">powerPlantRDD.take(5).foreach(println) // Ctrl+Enter to print first 5 lines
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">// let us make sure we are using Spark version greater than 2.2 - we need a version closer to 2.0 if we want to use SparkSession and SQLContext 
require(sc.version.replace(&quot;.&quot;, &quot;&quot;).toInt &gt;= 220, &quot;Spark 2.2.0+ is required to run this notebook. Please attach it to a Spark 2.2.0+ cluster.&quot;)
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">// this reads the tsv file and turns it into a dataframe
val powerPlantDF = spark.read // use 'sqlContext.read' instead if you want to use older Spark version &gt; 1.3  see 008_ notebook
    .format(&quot;csv&quot;) // use spark.csv package
    .option(&quot;header&quot;, &quot;true&quot;) // Use first line of all files as header
    .option(&quot;inferSchema&quot;, &quot;true&quot;) // Automatically infer data types
    .option(&quot;delimiter&quot;, &quot;\t&quot;) // Specify the delimiter as Tab or '\t'
    .load(&quot;/databricks-datasets/power-plant/data/Sheet1.tsv&quot;)
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">powerPlantDF.printSchema // print the schema of the DataFrame that was inferred
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">powerPlantDF.count
</code></pre>
</div>
<div class="cell markdown">
<h3 id="21-alternatively-load-data-via-the-upload-gui-feature-in-databricks"><a class="header" href="#21-alternatively-load-data-via-the-upload-gui-feature-in-databricks">2.1. Alternatively, load data via the upload GUI feature in databricks</a></h3>
<h2 id="use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce"><a class="header" href="#use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce">USE THIS FOR OTHER SMALLish DataSets you want to import to your CE</a></h2>
<p>Since the dataset is relatively small, we will use the upload feature in Databricks to upload the data as a table.</p>
<p>First download the Data Folder from <a href="https://archive.ics.uci.edu/ml/datasets/Combined+Cycle+Power+Plant">UCI Machine Learning Repository Combined Cycle Power Plant Data Set</a></p>
<p>The file is a multi-tab Excel document so you will need to save each tab as a Text file export.</p>
<p>I prefer exporting as a Tab-Separated-Values (TSV) since it is more consistent than CSV.</p>
<p>Call each file Folds5x2_pp&lt;Sheet 1..5&gt;.tsv and save to your machine.</p>
<p>Go to the Databricks Menu &gt; Tables &gt; Create Table</p>
<p>Select Datasource as &quot;File&quot;</p>
<p>Upload <em>ALL</em> 5 files at once.</p>
<p>See screenshots below (but refer <a href="https://docs.databricks.com/user-guide/importing-data.html">https://docs.databricks.com/user-guide/importing-data.html</a> for latest methods to import data):</p>
<p><strong>2.1.1. Create Table</strong> _________________</p>
<p>When you import your data, name your table <code>power_plant</code>, specify all of the columns with the datatype <code>Double</code> and make sure you check the <code>First row is header</code> box.</p>
<p><img src="http://training.databricks.com/databricks_guide/1_4_ML_Power_Plant_Import_Table.png" alt="alt text" /></p>
<p><strong>2.1.2. Review Schema</strong> __________________</p>
<p>Your table schema and preview should look like this after you click <code>Create Table</code>:</p>
<p><img src="http://training.databricks.com/databricks_guide/1_4_ML_Power_Plant_Import_Table_Schema.png" alt="alt text" /></p>
</div>
<div class="cell markdown">
<p>Now that your data is loaded let's explore it.</p>
</div>
<div class="cell markdown">
<h2 id="step-3-explore-your-data"><a class="header" href="#step-3-explore-your-data">Step 3: Explore Your Data</a></h2>
<p>Now that we understand what we are trying to do, we need to load our data and describe it, explore it and verify it.</p>
</div>
<div class="cell markdown">
<h4 id="viewing-the-table-as-text"><a class="header" href="#viewing-the-table-as-text">Viewing the table as text</a></h4>
<p>By uisng <code>.show</code> method we can see some of the contents of the table in plain text.</p>
<p>This works in pure Apache Spark, say in <code>Spark-Shell</code> without any notebook layer on top of Spark like databricks, zeppelin or jupyter.</p>
<p>It is a good idea to use this method when possible.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">powerPlantDF.show(10) // try putting 1000 here instead of 10
</code></pre>
</div>
<div class="cell markdown">
<h4 id="viewing-as-dataframe"><a class="header" href="#viewing-as-dataframe">Viewing as DataFrame</a></h4>
<p>This is almost necessary for a data scientist to gain visual insights into all pair-wise relationships between the several (3 to 6 or so) variables in question.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(powerPlantDF) 
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">powerPlantDF.count() // count the number of rows in DF
</code></pre>
</div>
<div class="cell markdown">
<h4 id="viewing-as-table-via-sql"><a class="header" href="#viewing-as-table-via-sql">Viewing as Table via SQL</a></h4>
<p>Let us look at what tables are already available, as follows:</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">sqlContext.tables.show() // Ctrl+Enter to see available tables
</code></pre>
</div>
<div class="cell markdown">
<p>We can also access the list of tables and databases using <code>spark.catalog</code> methods as explained here:</p>
<ul>
<li><a href="https://databricks.com/blog/2016/08/15/how-to-use-sparksession-in-apache-spark-2-0.html">https://databricks.com/blog/2016/08/15/how-to-use-sparksession-in-apache-spark-2-0.html</a></li>
</ul>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">spark.catalog.listTables.show(false)
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">spark.catalog.listDatabases.show(false)
</code></pre>
</div>
<div class="cell markdown">
<p>We need to create a temporary view of the DataFrame as a table before being able to access it via SQL.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">powerPlantDF.createOrReplaceTempView(&quot;power_plant_table&quot;) // Shift+Enter
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">sqlContext.tables.show() 
</code></pre>
</div>
<div class="cell markdown">
<p>Note that table names are in lower-case only!</p>
</div>
<div class="cell markdown">
<p><strong>You Try!</strong></p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//sqlContext // uncomment and put . after sqlContext and hit Tab to see what methods are available
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">//sqlContext.dropTempTable(&quot;power_plant_table&quot;) // uncomment and Ctrl+Enter if you want to remove the table!
</code></pre>
</div>
<div class="cell markdown">
<p>The following SQL statement simply selects all the columns (due to <code>*</code>) from <code>powerPlantTable</code>.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sql">-- Ctrl+Enter to query the rows via SQL
SELECT * FROM power_plant_table
</code></pre>
</div>
<div class="cell markdown">
<p>Note that the output of the above command is the same as <code>display(powerPlantDF)</code> we did earlier.</p>
</div>
<div class="cell markdown">
<p>We can use the SQL <code>desc</code> command to describe the schema. This is the SQL equivalent of <code>powerPlantDF.printSchema</code> we saw earlier.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sql">desc power_plant_table
</code></pre>
</div>
<div class="cell markdown">
<p><strong>Schema Definition</strong></p>
<p>Our schema definition from UCI appears below:</p>
<ul>
<li>AT = Atmospheric Temperature in C</li>
<li>V = Exhaust Vaccum Speed</li>
<li>AP = Atmospheric Pressure</li>
<li>RH = Relative Humidity</li>
<li>PE = Power Output</li>
</ul>
<p>PE is our label or target. This is the value we are trying to predict given the measurements.</p>
<p><em>Reference <a href="https://archive.ics.uci.edu/ml/datasets/Combined+Cycle+Power+Plant">UCI Machine Learning Repository Combined Cycle Power Plant Data Set</a></em></p>
</div>
<div class="cell markdown">
<p>Let's do some basic statistical analysis of all the columns.</p>
<p>We can use the describe function with no parameters to get some basic stats for each column like count, mean, max, min and standard deviation. More information can be found in the <a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.DataFrame">Spark API docs</a></p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(powerPlantDF.describe())
</code></pre>
</div>
<div class="cell markdown">
<h2 id="step-4-visualize-your-data"><a class="header" href="#step-4-visualize-your-data">Step 4: Visualize Your Data</a></h2>
<p>To understand our data, we will look for correlations between features and the label. This can be important when choosing a model. E.g., if features and a label are linearly correlated, a linear model like Linear Regression can do well; if the relationship is very non-linear, more complex models such as Decision Trees or neural networks can be better. We use the Databricks built in visualization to view each of our predictors in relation to the label column as a scatter plot to see the correlation between the predictors and the label.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sql">select AT as Temperature, PE as Power from power_plant_table
</code></pre>
</div>
<div class="cell markdown">
<p>From the above plot, it looks like there is strong linear correlation between temperature and Power Output!</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sql">select V as ExhaustVaccum, PE as Power from power_plant_table;
</code></pre>
</div>
<div class="cell markdown">
<p>The linear correlation is not as strong between Exhaust Vacuum Speed and Power Output but there is some semblance of a pattern.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sql">select AP as Pressure, PE as Power from power_plant_table;
</code></pre>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-sql">select RH as Humidity, PE as Power from power_plant_table;
</code></pre>
</div>
<div class="cell markdown">
<p>...and atmospheric pressure and relative humidity seem to have little to no linear correlation.</p>
<p>These pairwise plots can also be done directly using <code>display</code> on <code>select</code>ed columns of the DataFrame <code>powerPlantDF</code>.</p>
<p>In general <strong>we will shy from SQL as much as possible</strong> to focus on ML pipelines written with DataFrames and DataSets with occassional in-and-out of RDDs.</p>
<p>The illustations in <code>%sql</code> above are to mainly reassure those with a RDBMS background and SQL that their SQL expressibility can be directly used in Apache Spark and in databricks notebooks.</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(powerPlantDF.select($&quot;RH&quot;, $&quot;PE&quot;))
</code></pre>
</div>
<div class="cell markdown">
<p>Furthermore, you can interactively start playing with <code>display</code> on the full DataFrame!</p>
</div>
<div class="cell code" execution_count="1" scrolled="false">
<pre><code class="language-scala">display(powerPlantDF) // just as we did for the diamonds dataset
</code></pre>
</div>
<div class="cell markdown">
<p>We will do the following steps in the sequel.</p>
<ul>
<li><em>Step 5: Data Preparation</em></li>
<li><em>Step 6: Data Modeling</em></li>
<li><em>Step 7: Tuning and Evaluation</em></li>
<li><em>Step 8: Deployment</em></li>
</ul>
</div>
<div class="cell markdown">
<p>Datasource References:</p>
<ul>
<li>Pinar Tüfekci, Prediction of full load electrical power output of a base load operated combined cycle power plant using machine learning methods, International Journal of Electrical Power &amp; Energy Systems, Volume 60, September 2014, Pages 126-140, ISSN 0142-0615, <a href="http://www.journals.elsevier.com/international-journal-of-electrical-power-and-energy-systems/">Web Link</a></li>
<li>Heysem Kaya, Pinar Tüfekci , Sadik Fikret Gürgen: Local and Global Learning Methods for Predicting Power of a Combined Gas &amp; Steam Turbine, Proceedings of the International Conference on Emerging Trends in Computer and Electronics Engineering ICETCEE 2012, pp. 13-18 (Mar. 2012, Dubai) <a href="http://www.cmpe.boun.edu.tr/%7Ekaya/kaya2012gasturbine.pdf">Web Link</a></li>
</ul>
</div>
<div class="cell markdown">
<h3 id="we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset"><a class="header" href="#we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset">We will continue later with ML pipelines to do prediction with a fitted model from this dataset</a></h3>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../contents/000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../contents/000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../contents/000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../contents/000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
