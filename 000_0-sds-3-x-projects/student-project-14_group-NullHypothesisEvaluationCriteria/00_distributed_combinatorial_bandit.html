
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Distributed combinatorial bandits &#8212; Scalable Data Science &amp; Distributed Machine Learning</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reinforcement Learning for Intraday Trading" href="../student-project-15_group-FinancialDataStreams/00_video.html" />
    <link rel="prev" title="Genomics Analysis with Glow and Spark" href="../student-project-13_group-Genomics/01_1000genomes.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Scalable Data Science & Distributed Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/000_ScaDaMaLe.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark Core
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/001_whySpark.html">
   Why Apache Spark?
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html">
     Login to databricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#import-course-content-now">
     Import Course Content Now!
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#cloud-free-computing-environment">
     Cloud-free Computing Environment
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html">
     Multi-lingual Notebooks
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html">
   Scala Crash Course
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html">
     Scala Crash Course Continued
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html">
   Introduction to Spark
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/005_RDDsTransformationsActionsHOMEWORK.html">
     HOMEWORK on RDD Transformations and Actions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html">
     Piped RDDs and Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#pipe-rdds-to-system-commands">
     Pipe RDDs to System Commands
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#mappartitions">
     mapPartitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#foreachpartition">
     foreachPartition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#numerically-rigorous-bayesian-ab-testing">
     Numerically Rigorous Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#usage-instructions-for-isit1or2coins">
     Usage instructions for IsIt1or2Coins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/006_WordCount.html">
     Word Count on US State of the Union (SoU) Addresses
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark SQL
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html">
   Introduction to Spark SQL
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#getting-started-in-spark-2-x">
   Getting Started in Spark 2.x
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007a_SparkSQLProgGuide_HW.html">
     Spark Sql Programming Guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html#id1">
     Getting Started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007c_SparkSQLProgGuide_HW.html">
     Getting Started - Exercise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html">
     Data Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html#id1">
     Data Sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007e_SparkSQLProgGuide_HW.html">
     Performance Tuning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html">
     Distributed SQL Engine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html#id1">
     Distributed SQL Engine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html">
     SQL Pivoting since Spark 2.4
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#load-data">
     Load Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-in-sql">
     Pivoting in SQL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-aggregate-expressions">
     Pivoting with Multiple Aggregate Expressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-grouping-columns">
     Pivoting with Multiple Grouping Columns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-pivot-columns">
     Pivoting with Multiple Pivot Columns
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Extract Transform and Load
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html">
   Diamonds ML Pipeline Workflow - DataFrame ETL and EDA Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-1-load-data-as-dataframe">
   Step 1. Load data as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-2-understand-the-data">
   Step 2. Understand the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#let-us-run-through-some-basic-inteactive-sql-queries-next">
   Let us run through some basic inteactive SQL queries next
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#why-do-we-need-to-know-these-interactive-sql-queries">
   Why do we need to know these interactive SQL queries?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset">
   We will continue later with ML pipelines to do prediction with a fitted model from this dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html">
   Power Plant ML Pipeline Application - DataFrame Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-1-business-understanding">
   Step 1: Business Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-2-load-your-data">
   Step 2: Load Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce">
   USE THIS FOR OTHER SMALLish DataSets you want to import to your CE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-3-explore-your-data">
   Step 3: Explore Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-4-visualize-your-data">
   Step 4: Visualize Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html">
   Wiki Clickstream Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html#wikipedia-logo">
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html">
   Old Bailey Online Data Analysis in Apache Spark
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html#analysing-the-full-old-bailey-online-sessions-papers-dataset">
   Analysing the Full Old Bailey Online Sessions Papers Dataset
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html">
     Piped RDDs and Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#from-a-local-collection">
     From a Local Collection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#glom">
     glom
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#checkpointing">
     Checkpointing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#pipe-rdds-to-system-commands">
     Pipe RDDs to System Commands
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#mappartitions">
     mapPartitions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#foreachpartition">
     foreachPartition
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#numerically-rigorous-bayesian-ab-testing">
     Numerically Rigorous Bayesian AB Testing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#usage-instructions-for-isit1or2coins">
     Usage instructions for IsIt1or2Coins
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#parsing-the-output-from-isit1or2coins">
     Parsing the output from
     <code class="docutils literal notranslate">
      <span class="pre">
       IsIt1or2Coins
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#providing-case-classes-for-input-and-output-for-easy-spark-communication">
     Providing case classes for input and output for easy spark communication
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Trends in Money and News
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_9-sds-3-x-trends/000_TrendsInFinancialStocksAndNewsEvents.html">
   Trends in Financial Stocks and News Events
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/00a_FX1M.html">
     Historical FX-1-M Financial Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/00b_yfinance.html">
     yfinance Stock Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/000a_finance_utils.html">
     Utilities Needed for Financial Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/000b_gdelt_utils.html">
     Utilities Needed for Mass Media Data
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_9-sds-3-x-trends/01_trend_calculus_showcase.html">
   Finding trends in oil price data.
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/02_streamable_trend_calculus.html">
     Streaming Trend Calculus with Maximum Necessary Reversals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/03_streamable_trend_calculus_estimators.html">
     Markov Model for Trend Calculus
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_9-sds-3-x-trends/030_Spark_GDELT_project_001.html">
   Plugging into GDELT Mass Media Streams
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/030a_gdelt_EOI_detection.html">
     Detecting Events of Interest to OIL/GAS Price Trends
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_9-sds-3-x-trends/030b_gdelt_POI_detection.html">
     Detecting Persons of Interest to OIL/GAS Price Trends
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Distributed Deep Learning with Horovod
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/00_DDL_Introduction.html">
   Introduction to Distributed Deep Learning (DDL) with Horovod over Tensorflow/keras and Pytorch
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_7-sds-3-x-ddl/0x_mnist-tensorflow-keras.html">
     Distributed deep learning training using TensorFlow and Keras with HorovodRunner
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../000_7-sds-3-x-ddl/0y_mnist-pytorch.html">
     Distributed deep learning training using PyTorch with HorovodRunner for MNIST
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  WASP AI-Track Student Projects
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-01_group-TheTwoCultures/00_download_data.html">
   The two cultures
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/01_load_data.html">
     Preprocessing and loading the relevant data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/02_logisticregression.html">
     The two cultures - Classifying threads with logistic regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/03_word2vec.html">
     Classification using Word2Vec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-01_group-TheTwoCultures/04_LDA.html">
     Topic Modeling with LDA
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-02_group-LiUUmeaSceneGraphMotifs/01_SceneGraphMotifs.html">
   Exploring the GQA Scene Graph Dataset Structure and Properties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-03_group-GuangyiZhang/01_triads.html">
   Signed Triads in Social Media
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-04_group-DistributedLinearAlgebra/01_DistributedSVD.html">
   Distributed Linear Algebra
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-04_group-DistributedLinearAlgebra/02_CollaborativeFiltering.html">
     Music Recommendation System
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-05_group-LundDirichletAnalysts/01_Wikipedia_LDA_Analysis.html">
   Wikipedia analysis using Latent Dirichlet Allocation (LDA)
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-06_group-ParticleClustering/00_Introduction.html">
   Unsupervised clustering of particle physics data with distributed training
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/01_data_and_preprocessing.html">
     Data and preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/02_dl_single_machine.html">
     UCluster on a single machine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/03_dl_horovod.html">
     UCluster with distributed learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-06_group-ParticleClustering/04_evaluate.html">
     Evaluation
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-07_group-MathAtKTH/01_Coding_Motifs.html">
   Motif Finding
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-07_group-MathAtKTH/01_Coding_Motifs.html#application">
   Application
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-07_group-MathAtKTH/02_Data_Processing.html">
     Data Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-07_group-MathAtKTH/03_graph_string_converter.html">
     Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-07_group-MathAtKTH/03_graph_string_converter.html#examples">
     Examples
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html">
   Distributed ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html#distributed-ensembles-prediction-api">
   Distributed ensembles prediction API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html#application-example-distributed-predictions">
   Application example: Distributed predictions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-08_group-DistributedEnsemble/00_project.html#application-example-out-of-distribution-detection">
   Application example: Out of distribution detection
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-09_group-TopicModeling/01_Introduction.html">
   Topic Modeling with SARS-Cov-2 Genome 🧬
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/02_Data_Processing.html">
     Data Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/03_LDA.html">
     LDA - Extract Features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/04_Classification_CountVector.html">
     Classification CountVector
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html">
     Load processed data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html#explore-data">
     Explore data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html#classification">
     Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/05_Classification.html#evaluation">
     Evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-09_group-TopicModeling/06_Results.html">
     Results and Conclusion
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-10_group-Geosmus/01_Introduction.html">
   Twitter Streaming Using Geolocation and Emoji Based Sentiment Analysis
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/02_ClusteringEmoticonsBasedOnTweets.html">
     Clustering emoticons based on tweets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/03_Dynamic_Tweet_Maps.html">
     Dynamic Tweet Maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/04_conclusion.html">
     Conclusion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/05_appendix_get-cc-data.html">
     Notebook for collecting tweets with country codes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/07_a_appendix_extendedTwitterUtils2run.html">
     ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/07_a_appendix_extendedTwitterUtils2run.html#extended-spark-streaming-twitter-twitterutils">
     Extended spark.streaming.twitter.TwitterUtils
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-10_group-Geosmus/07_b_appendix_TTTDFfunctions.html">
     ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-11_group-Sketchings/00_QuantileEstimation.html">
   Anomaly Detection with Iterative Quantile Estimation and T-digest
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-12_group-CovidPandemic/00_ProjectDescriptionAndPlanning.html">
   Project Description and Introduction
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/01_DownloadFilesPeriodicallyScript.html">
     Download Files Periodically
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/01_StreamToFile.html">
     Stream to parquet file
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/021_DataPreprocess_Explain.html">
     Loading data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/021_DataPreprocess_Explain.html#preprocessing">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/02_DataPreprocess.html">
     Loading data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/02_DataPreprocess.html#preprocessing">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/03_ExplosiveAnalysis.html">
     This notebook is for explosive analysis of features in data.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/03_ExplosiveAnalysis.html#statistics-of-invariant-features">
     Statistics of invariant features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/03_ExplosiveAnalysis.html#correlation-between-invariant-features">
     Correlation between invariant features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/03_ExplosiveAnalysis.html#correlation-between-new-case-per-million-total-case-new-death-per-million-total-death-per-million-reproduction-rate-and-stringency-index">
     Correlation between new case per million, total case, new death per million, total death per million, reproduction rate and stringency index.
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/04_DataVisualize.html">
     Show reproduction rate of selected countries i.e. Sweden, Germany, Danmark, Finland, Norway
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/04_DataVisualize.html#visualize-total-cases-total-deaths-new-cases-and-new-deaths-during-pandemic">
     Visualize total cases, total deaths, new cases and new deaths during pandemic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/04_DataVisualize.html#total-deaths">
     Total Deaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/04_DataVisualize.html#new-cases">
     New Cases
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/04_DataVisualize.html#new-deaths">
     New Deaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/05_Clustering.html">
     Clustering of country features in the Covid 19 dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/06_DataPredicton_LR.html">
     Prediction with Linear Regression (LR) Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/07_DataPredicton_ARIMA.html">
     Prediction with Time Series model - ARIMA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-12_group-CovidPandemic/08_DataPrediction_GP.html">
     Prediction with time series model - Gaussian Processes
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html">
   Genomics Analysis with Glow and Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#load-libs-and-define-helper-functions">
   Load libs and define helper functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#read-data">
   Read data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#pca">
   PCA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#predicting-ethinicity">
   Predicting Ethinicity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-13_group-Genomics/01_1000genomes.html#filtering-of-snps-based-on-chi-squared-test">
   Filtering of SNPs based on chi-squared test
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Distributed combinatorial bandits
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/00_video.html">
   Reinforcement Learning for Intraday Trading
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/01_rl_intraday_trading.html">
     Reinforcement Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/01_rl_intraday_trading.html#summary-and-outlook">
     Summary and Outlook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/02_rl_intraday_trading_elephas.html">
     Reinforcement Learning - Distributed model tuning with Elephas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/02_rl_intraday_trading_elephas.html#elephas">
     Elephas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/02_rl_intraday_trading_elephas.html#notes-to-the-elephas-training">
     Notes to the elephas training
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-15_group-FinancialDataStreams/03_resources.html">
     Resources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-16_group-IntrusionDetection/00_Introduction.html">
   Intrusion Detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-16_group-IntrusionDetection/00_Introduction.html#preparing-the-dataframe-for-training-classifers">
   Preparing the DataFrame for training classifers
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-17_group-TowardsScalableTDA/00_introduction.html">
   Density Estimation via Voronoi Diagrams in High Dimensions
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-17_group-TowardsScalableTDA/01_methodology.html">
     Methodology
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-17_group-TowardsScalableTDA/02_gaussian_analysis.html">
     Gaussian Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-17_group-TowardsScalableTDA/03_robotics_dataset.html">
     Robotics Dataset
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-18_group-ProjectRL/00_Problem_Description.html">
   Recommender System
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/01_The_ALS_method.html">
     <span class="xref myst">
      The Alternating Least Squares method (ALS)
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/01_The_ALS_method.html#on-a-small-dataset">
     <span class="xref myst">
      On a small dataset
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/01_The_ALS_method.html#on-a-large-dataset-netflix-dataset">
     <span class="xref myst">
      On a large dataset - Netflix dataset
     </span>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-18_group-ProjectRL/02_Extensions.html">
     Extensions
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../student-project-19_group-Featuring/01_FundamentalMatrix.html">
   Fundamental Matrix
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-20_group-Generalization/01_Background.html">
   MixUp and Generalization
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/02_Random_Forest.html">
     Random Forests and MixUp
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/03_CNN_MNIST.html">
     CNN for MNIST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/04_CNN_Intel_Image.html">
     CNN for Intel Image Classification
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-20_group-Generalization/05_Horovod_test.html">
     CNNs and MixUp with Horovod
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/00_introduction.html">
   Graph Spectral Analysis
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/01_preprocess_data.html">
     Preprocess the data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/02_generate_graphs.html">
     Generate random graphs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/03_compute_rsvd.html">
     Compute RSVD
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-21_group-GraphSpectralAnalysis/04_analyse_eigenvalues.html">
     Analyse the eigenvalue spectrum
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../student-project-22_group-SwapWithDDP/00_Introduction.html">
   SWAP
   <em>
    With
   </em>
   DDP
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../student-project-22_group-SwapWithDDP/01_SWAP_with_DDP.html">
     SWAP
     <em>
      With
     </em>
     DDP
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/000_0-sds-3-x-projects/student-project-14_group-NullHypothesisEvaluationCriteria/00_distributed_combinatorial_bandit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html/issues/new?title=Issue%20on%20page%20%2F000_0-sds-3-x-projects/student-project-14_group-NullHypothesisEvaluationCriteria/00_distributed_combinatorial_bandit.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#idea">
   Idea
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practicalities">
     Practicalities
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-of-openstreetmap-data">
   Loading of OpenStreetMap data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-shortest-path-algorithm">
   The shortest path algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distributed-combinatorial-bandit-algorithm">
   Distributed combinatorial bandit algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#graph-visualization">
   Graph visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="distributed-combinatorial-bandits">
<h1>Distributed combinatorial bandits<a class="headerlink" href="#distributed-combinatorial-bandits" title="Permalink to this headline">¶</a></h1>
<p>Group Project Authors:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.chalmers.se/en/Staff/Pages/akerblon.aspx">Niklas
Åkerblom</a></p></li>
<li><p>Jonas Nordlöf</p></li>
<li><p><a class="reference external" href="https://www.jorge.se">Emilio Jorge</a></p></li>
</ul>
<p>Link to video presentation: <a class="reference external" href="https://youtu.be/uipIfFlluEI">Video</a></p>
<div class="section" id="idea">
<h2>Idea<a class="headerlink" href="#idea" title="Permalink to this headline">¶</a></h2>
<p>We try to solve a routing problem, that is trying to tell a vechicle
what the sportest path is to a destination. The problem is that the
dispatcher knows the connections in the graph but not the length of each
edge. The dispatcher learns how long it takes to traverse a path when a
vehicle travels it. This makes the routing problem an online learning
problem such that the dispatcher has to learn which paths to tell the
vehicle to take in a way that finds the best path, both in terms of
speed and gaining information about future good paths (more on this
later). Additionally the edges are stochastic, such that one traversal
is no enough to get perfect information.</p>
<p>This setting can be seen as a case of a combinatorial bandit where we
have to select a set of edges that reach the destination from our start
while balancing the need of getting a fast route with obtaining better
estimates of edges such that future paths can be more efficient (this is
known as exploration-explotation tradeoff).</p>
<p>Distributing this task could be an interesting idea, both since multiple
dispatchers and vehicles could work in parallell (which we do not
consider here) but also that large graphs can be sped up through
distributed computations in the shortest path problems that arise.</p>
<div class="section" id="practicalities">
<h3>Practicalities<a class="headerlink" href="#practicalities" title="Permalink to this headline">¶</a></h3>
<p>To make our task more realistic we have used data from OpenStreetMap, a
collection of real world map data to create a graph consisting of real
world roads. We also generate some synthetic data to experiment with.</p>
<p>The graph network then goes into our contextual bandit algorithm which
samples edge weights from a belief and then selects the shortest path
from this sampled graph. This leads to an algorithm with very nice
theoretical properties in terms of online learning. This method is well
known in the online learning community, but as far as we know has not
been done in a distributed fashion.</p>
</div>
</div>
<div class="section" id="loading-of-openstreetmap-data">
<h2>Loading of OpenStreetMap data<a class="headerlink" href="#loading-of-openstreetmap-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">scala.sys.process._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions.</span><span class="o">{</span><span class="n">col</span><span class="o">}</span>

<span class="k">def</span> <span class="n">toMap</span><span class="o">(</span><span class="n">tupesArray</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Row</span><span class="o">])</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Map</span><span class="o">[</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">]]</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">tupesArray</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">None</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">tuples</span> <span class="o">=</span> <span class="n">tupesArray</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="o">(</span>
          <span class="n">e</span><span class="o">.</span><span class="n">getAs</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;key&quot;</span><span class="o">),</span>
          <span class="n">e</span><span class="o">.</span><span class="n">getAs</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;value&quot;</span><span class="o">)</span>
        <span class="o">)</span>
      <span class="o">})</span>
      <span class="nc">Some</span><span class="o">(</span><span class="n">tuples</span><span class="o">.</span><span class="n">toMap</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="k">def</span> <span class="n">handleCommon</span><span class="o">()(</span><span class="n">df</span><span class="k">:</span><span class="kt">DataFrame</span><span class="o">)</span><span class="k">:</span><span class="kt">DataFrame</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">toMapUDF</span> <span class="o">=</span> <span class="n">udf</span><span class="o">(</span><span class="n">toMap</span> <span class="k">_</span><span class="o">)</span>
  <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="o">(</span><span class="s">&quot;uid&quot;</span><span class="o">,</span> <span class="s">&quot;user_sid&quot;</span><span class="o">,</span> <span class="s">&quot;changeset&quot;</span><span class="o">,</span> <span class="s">&quot;version&quot;</span><span class="o">,</span> <span class="s">&quot;timestamp&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;tags&quot;</span><span class="o">,</span> <span class="n">toMapUDF</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">&quot;tags&quot;</span><span class="o">)))</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql._
import scala.sys.process._
import org.apache.spark.sql.functions.col
toMap: (tupesArray: Seq[org.apache.spark.sql.Row])Option[Map[String,String]]
handleCommon: ()(df: org.apache.spark.sql.DataFrame)org.apache.spark.sql.DataFrame
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="n">sqlContext</span><span class="o">.</span><span class="n">setConf</span><span class="o">(</span><span class="s">&quot;spark.sql.parquet.binaryAsString&quot;</span><span class="o">,</span><span class="s">&quot;true&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">nodeDF</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;dbfs:/FileStore/group14/sweden-latest_osm_pbf_node.parquet&quot;</span><span class="o">).</span><span class="n">transform</span><span class="o">(</span><span class="n">handleCommon</span><span class="o">())</span>

<span class="k">val</span> <span class="n">wayDF</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">&quot;dbfs:/FileStore/group14/sweden_latest_osm_pbf_way.parquet&quot;</span><span class="o">).</span><span class="n">transform</span><span class="o">(</span><span class="n">handleCommon</span><span class="o">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>nodeDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: bigint, tags: map&lt;string,string&gt; ... 2 more fields]
wayDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: bigint, tags: map&lt;string,string&gt; ... 1 more field]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions.</span><span class="o">{</span><span class="n">explode</span><span class="o">,</span><span class="n">arrays_zip</span><span class="o">,</span> <span class="n">concat</span><span class="o">,</span><span class="n">array</span><span class="o">,</span> <span class="n">lit</span><span class="o">}</span>

<span class="k">val</span> <span class="n">wayDF_exploded</span> <span class="o">=</span> <span class="n">wayDF</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;exploded&quot;</span><span class="o">,</span> <span class="n">explode</span><span class="o">(</span><span class="n">arrays_zip</span><span class="o">(</span><span class="n">concat</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;nodes.nodeId&quot;</span><span class="o">,</span><span class="n">array</span><span class="o">(</span><span class="n">lit</span><span class="o">(-</span><span class="mi">1L</span><span class="o">))),</span> <span class="n">concat</span><span class="o">(</span><span class="n">array</span><span class="o">(</span><span class="n">lit</span><span class="o">(-</span><span class="mi">1L</span><span class="o">)),</span><span class="n">$</span><span class="s">&quot;nodes.nodeId&quot;</span><span class="o">))))</span>
<span class="k">val</span> <span class="n">wayDF_filtered</span> <span class="o">=</span> <span class="n">wayDF_exploded</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;exploded.0&quot;</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="s">&quot;exploded.1&quot;</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql._
import org.apache.spark.sql.functions.{explode, arrays_zip, concat, array, lit}
wayDF_exploded: org.apache.spark.sql.DataFrame = [id: bigint, tags: map&lt;string,string&gt; ... 2 more fields]
wayDF_filtered: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [id: bigint, tags: map&lt;string,string&gt; ... 2 more fields]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions._</span>

<span class="k">val</span> <span class="n">wayNodeDF</span> <span class="o">=</span> <span class="n">wayDF_exploded</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;exploded.0&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;start&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;exploded.1&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;end&quot;</span><span class="o">),</span><span class="n">$</span><span class="s">&quot;tags.highway&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;tags.maxspeed&quot;</span><span class="o">)</span>
<span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;highway&quot;</span> <span class="n">isin</span> <span class="o">(</span><span class="s">&quot;motorway&quot;</span><span class="o">,</span><span class="s">&quot;trunk&quot;</span><span class="o">,</span><span class="s">&quot;primary&quot;</span><span class="o">,</span><span class="s">&quot;secondary&quot;</span><span class="o">,</span> <span class="s">&quot;tertiary&quot;</span><span class="o">,</span> <span class="s">&quot;unclassified&quot;</span><span class="o">,</span> <span class="s">&quot;residential&quot;</span><span class="o">,</span><span class="s">&quot;motorway_link&quot;</span><span class="o">,</span> <span class="s">&quot;trunk_link&quot;</span><span class="o">,</span>  <span class="s">&quot;primary_link&quot;</span><span class="o">,</span> <span class="s">&quot;secondary_link&quot;</span><span class="o">,</span> <span class="s">&quot;tertiary_link&quot;</span><span class="o">))</span>

<span class="n">wayNodeDF</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;wayHighway&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">wayNodeDF_nonull</span> <span class="o">=</span> <span class="n">wayNodeDF</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;maxspeed&quot;</span><span class="o">,</span> <span class="n">when</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">.</span><span class="n">isNull</span> <span class="o">&amp;&amp;</span> <span class="n">col</span><span class="o">(</span><span class="s">&quot;highway&quot;</span><span class="o">)</span> <span class="o">==</span> <span class="s">&quot;motorway&quot;</span><span class="o">,</span> <span class="mi">110</span><span class="o">)</span>
                     <span class="o">.</span><span class="n">when</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">.</span><span class="n">isNull</span> <span class="o">&amp;&amp;</span> <span class="n">col</span><span class="o">(</span><span class="s">&quot;highway&quot;</span><span class="o">)==</span><span class="s">&quot;primary&quot;</span><span class="o">,</span> <span class="mi">50</span><span class="o">).</span><span class="n">when</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">.</span><span class="n">isNull</span> <span class="o">&amp;&amp;</span> <span class="n">col</span><span class="o">(</span><span class="s">&quot;highway&quot;</span><span class="o">)==</span><span class="s">&quot;secondary&quot;</span><span class="o">,</span> <span class="mi">50</span><span class="o">).</span><span class="n">when</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">.</span><span class="n">isNull</span> <span class="o">&amp;&amp;</span> <span class="n">col</span><span class="o">(</span><span class="s">&quot;highway&quot;</span><span class="o">)==</span><span class="s">&quot;motorway_link&quot;</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span>
                     <span class="o">.</span><span class="n">when</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">.</span><span class="n">isNull</span> <span class="o">&amp;&amp;</span> <span class="n">col</span><span class="o">(</span><span class="s">&quot;highway&quot;</span><span class="o">)==</span><span class="s">&quot;residential&quot;</span><span class="o">,</span> <span class="mi">15</span><span class="o">).</span><span class="n">when</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">.</span><span class="n">isNull</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span>
                     <span class="o">.</span><span class="n">otherwise</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">))</span>
<span class="n">wayNodeDF_nonull</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;wayHighway&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql.functions._
wayNodeDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [start: bigint, end: bigint ... 2 more fields]
wayNodeDF_nonull: org.apache.spark.sql.DataFrame = [start: bigint, end: bigint ... 2 more fields]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions._</span>

<span class="k">val</span> <span class="n">nodeLatLonDF</span> <span class="o">=</span> <span class="n">nodeDF</span>
  <span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;id&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;nodeId&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;latitude&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;startLat&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;longitude&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;startLong&quot;</span><span class="o">))</span>

<span class="k">val</span> <span class="n">endnodeLatLonDF</span> <span class="o">=</span> <span class="n">nodeDF</span>
  <span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;id&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;nodeId2&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;latitude&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;endLat&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;longitude&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;endLong&quot;</span><span class="o">))</span>

<span class="k">val</span> <span class="n">wayGeometryDF</span> <span class="o">=</span> <span class="n">wayNodeDF_nonull</span><span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="n">nodeLatLonDF</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;start&quot;</span> <span class="o">===</span> <span class="n">$</span><span class="s">&quot;nodeId&quot;</span><span class="o">).</span><span class="n">join</span><span class="o">(</span><span class="n">endnodeLatLonDF</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;end&quot;</span> <span class="o">===</span> <span class="n">$</span><span class="s">&quot;nodeId2&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">wayGeometry_distDF</span> <span class="o">=</span> <span class="n">wayGeometryDF</span><span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="n">pow</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">radians</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;endLat&quot;</span> <span class="o">-</span> <span class="n">$</span><span class="s">&quot;startLat&quot;</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">2</span><span class="o">)</span> <span class="o">+</span> <span class="n">cos</span><span class="o">(</span><span class="n">radians</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;startLat&quot;</span><span class="o">))</span> <span class="o">*</span> <span class="n">cos</span><span class="o">(</span><span class="n">radians</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;endLat&quot;</span><span class="o">))</span> <span class="o">*</span> <span class="n">pow</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">radians</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;endLong&quot;</span> <span class="o">-</span> <span class="n">$</span><span class="s">&quot;startLong&quot;</span><span class="o">)</span> <span class="o">/</span> <span class="mi">2</span><span class="o">),</span> <span class="mi">2</span><span class="o">))</span>
  <span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;distance&quot;</span><span class="o">,</span> <span class="n">atan2</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;a&quot;</span><span class="o">),</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(-</span><span class="n">$</span><span class="s">&quot;a&quot;</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">6371</span><span class="o">)</span>
  <span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;endLat&quot;</span><span class="o">&lt;</span><span class="mf">55.4326186d</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="s">&quot;endLong&quot;</span><span class="o">&gt;</span><span class="mf">13.7d</span><span class="o">)</span> <span class="c1">//Small area south of sweden.</span>
  <span class="o">.</span><span class="n">withColumn</span><span class="o">(</span><span class="s">&quot;time&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;distance&quot;</span><span class="o">/</span><span class="n">$</span><span class="s">&quot;maxspeed&quot;</span><span class="o">).</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;time&quot;</span><span class="o">,</span> <span class="s">&quot;start&quot;</span><span class="o">,</span> <span class="s">&quot;end&quot;</span><span class="o">,</span> <span class="s">&quot;distance&quot;</span><span class="o">,</span> <span class="s">&quot;maxspeed&quot;</span><span class="o">)</span>
<span class="n">wayGeometry_distDF</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="o">(</span><span class="s">&quot;wayGeometry_distDF&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql.functions._
nodeLatLonDF: org.apache.spark.sql.DataFrame = [nodeId: bigint, startLat: double ... 1 more field]
endnodeLatLonDF: org.apache.spark.sql.DataFrame = [nodeId2: bigint, endLat: double ... 1 more field]
wayGeometryDF: org.apache.spark.sql.DataFrame = [start: bigint, end: bigint ... 8 more fields]
wayGeometry_distDF: org.apache.spark.sql.DataFrame = [time: double, start: bigint ... 3 more fields]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>

<span class="k">import</span> <span class="nn">org.apache.spark.graphx._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.rdd.RDD</span>
<span class="k">val</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.000001</span>
<span class="k">val</span> <span class="n">edges</span><span class="k">:</span> <span class="kt">RDD</span><span class="o">[</span><span class="kt">Edge</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span>  <span class="o">=</span>  <span class="n">wayGeometry_distDF</span>
    <span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">&quot;start&quot;</span><span class="o">,</span> <span class="s">&quot;end&quot;</span><span class="o">,</span> <span class="s">&quot;time&quot;</span><span class="o">).</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">line</span> <span class="o">=&gt;</span> <span class="nc">Edge</span><span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="n">getAs</span><span class="o">(</span><span class="s">&quot;start&quot;</span><span class="o">),</span> <span class="n">line</span><span class="o">.</span><span class="n">getAs</span><span class="o">(</span><span class="s">&quot;end&quot;</span><span class="o">),</span> <span class="n">line</span><span class="o">.</span><span class="n">getAs</span><span class="o">(</span><span class="s">&quot;time&quot;</span><span class="o">)))</span>


<span class="k">val</span> <span class="n">graph</span> <span class="o">=</span> <span class="nc">Graph</span><span class="o">.</span><span class="n">fromEdges</span><span class="o">(</span><span class="n">edges</span><span class="o">,</span> <span class="s">&quot;defaultname&quot;</span><span class="o">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>

<span class="n">println</span><span class="o">(</span><span class="s">&quot;Num edges:&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">toDF</span><span class="o">.</span><span class="n">count</span><span class="o">())</span>
<span class="n">println</span><span class="o">(</span><span class="s">&quot;Num vertices:&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">toDF</span><span class="o">.</span><span class="n">count</span><span class="o">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Num edges:
4667
Num vertices:
4488
import org.apache.spark.graphx._
import org.apache.spark.rdd.RDD
eps: Double = 1.0E-6
edges: org.apache.spark.rdd.RDD[org.apache.spark.graphx.Edge[Double]] = MapPartitionsRDD[1075908] at map at command-2294440354339724:6
graph: org.apache.spark.graphx.Graph[String,Double] = org.apache.spark.graphx.impl.GraphImpl@7f4c143a
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-shortest-path-algorithm">
<h2>The shortest path algorithm<a class="headerlink" href="#the-shortest-path-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The implemented shorthest path alborithm uses the the distributed Pregel
algorithm and is divided into two parts.</p>
<p>The first part is based on the code in
<a href="http://lamastex.org/lmse/mep/src/GraphXShortestWeightedPaths.html" class="uri">http://lamastex.org/lmse/mep/src/GraphXShortestWeightedPaths.html</a>.
As the original code did not have have all functionality desiered
functionality, the algorithm did find the shortest distance but didn’t
keep track of the path itself, the algorithm was extend with this
functionality.</p>
<p>The first part takes a graph, where the edges are double values
representing the cost of trevelling between its connected nodes, and an
array of the ids of each goal node. As output, it provides a graph where
each node containse a Map-object of the different landmarks/goal nodes.
When a lookup is made in the map from a specific node, a tuple contaning
the shortest distance, the id of the next node in the path and the id of
the current node. The last element serves no pupose in the final results
but is used as a form of stopping critera in the algorithm.</p>
<p>The second part transforms the output of the first part to a “path
graph” where each edge is marked with either a 1 or a 0 depending on if
it is used in a path between a starting node and a goal node. Altough
this recursion can be performed on a single machine for small examples,
this procedure is also implemented using the Pregel algorithm to handle
situations of millions of edges.</p>
<p>The input of the second part is the graph created in the first part as
well as the id of a single goal node and a start node. The goal node has
to be in the set of goal nodes used in the first part. This part outputs
a “path graph” where each edge is given the value 1 or 0 depending on if
it is on the shortest path or not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">scala.reflect.ClassTag</span>
<span class="k">import</span> <span class="nn">org.apache.spark.graphx._</span>

<span class="cm">/**</span>
<span class="cm"> * Computes shortest weighted paths to the given set of goal nodes, returning a graph where each</span>
<span class="cm"> * vertex attribute is a map containing the shortest-path distance to each reachable landmark.</span>
<span class="cm"> * Currently supports only Graph of [VD, Double], where VD is an arbitrary vertex type.</span>
<span class="cm"> *</span>
<span class="cm"> * The object also include a function which transforms the resulting graph into a path_graph between a </span>
<span class="cm"> * specific starting node and goal node. Each edge in the path_grpah is either 1 or 0 depending if it is </span>
<span class="cm"> * the shortest path or not.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">object</span> <span class="nc">ShortestPath</span> <span class="k">extends</span> <span class="nc">Serializable</span> <span class="o">{</span>

  <span class="c1">// When finding the shortest path each node stores a map from the itself to each goal node.</span>
  <span class="c1">// The map returns an array includeing the total distance to the goal node as well as the</span>
  <span class="c1">// next node pn the shortest path to the goal node. The last value in the array is only </span>
  <span class="c1">// populated with the nodes own id and is only used for computational convenience. </span>
  <span class="k">type</span> <span class="kt">SPMap</span> <span class="o">=</span> <span class="nc">Map</span><span class="o">[</span><span class="kt">VertexId</span><span class="p">,</span> <span class="kt">Tuple3</span><span class="o">[</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">VertexId</span><span class="p">,</span> <span class="kt">VertexId</span><span class="o">]]</span>
  
  <span class="c1">// PN holds the information of the path nodes which are used for creating a path graph</span>
  <span class="c1">// PN = (&#39;Distance left to goal node&#39;, &#39;Next path node id&#39;, &#39;Goal node&#39;, &#39;Is on path&#39;)</span>
  <span class="k">type</span> <span class="kt">PN</span> <span class="o">=</span> <span class="nc">Tuple4</span><span class="o">[</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">VertexId</span><span class="p">,</span> <span class="kt">VertexId</span><span class="p">,</span> <span class="kt">Boolean</span><span class="o">]</span> 
  
  <span class="k">private</span> <span class="k">val</span> <span class="nc">INITIAL_DIST</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nc">DEFAULT_ID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1L</span>
  <span class="k">private</span> <span class="k">val</span> <span class="nc">INFINITY</span> <span class="o">=</span> <span class="nc">Int</span><span class="o">.</span><span class="nc">MaxValue</span><span class="o">.</span><span class="n">toDouble</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">makeMap</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="o">(</span><span class="kt">VertexId</span><span class="o">,</span> <span class="kt">Tuple3</span><span class="o">[</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">VertexId</span><span class="p">,</span> <span class="kt">VertexId</span><span class="o">])*)</span> <span class="o">=</span> <span class="nc">Map</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span>
  
  <span class="c1">//private def incrementMap(spmap: SPMap, delta: Double, id: VertexId): SPMap = { </span>
  <span class="c1">//  spmap.map { case (v, d) =&gt; v -&gt; (Tuple3(d._1 + delta, d._3, id)) }</span>
  <span class="c1">//}</span>
  <span class="k">private</span> <span class="k">def</span> <span class="n">incrementMap</span><span class="o">(</span><span class="n">spmap</span><span class="k">:</span> <span class="kt">SPMap</span><span class="o">,</span> <span class="n">delta</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">srcId</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">,</span> <span class="n">dstId</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">)</span><span class="k">:</span> <span class="kt">SPMap</span> <span class="o">=</span> <span class="o">{</span> 
    <span class="n">spmap</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nc">Tuple3</span><span class="o">(</span><span class="n">d</span><span class="o">.</span><span class="n">_1</span> <span class="o">+</span> <span class="n">delta</span><span class="o">,</span> <span class="n">dstId</span><span class="o">,</span> <span class="n">srcId</span><span class="o">))</span> <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">addMaps</span><span class="o">(</span><span class="n">spmap1</span><span class="k">:</span> <span class="kt">SPMap</span><span class="o">,</span> <span class="n">spmap2</span><span class="k">:</span> <span class="kt">SPMap</span><span class="o">)</span><span class="k">:</span> <span class="kt">SPMap</span> <span class="o">=</span> <span class="o">{</span>
    <span class="o">(</span><span class="n">spmap1</span><span class="o">.</span><span class="n">keySet</span> <span class="o">++</span> <span class="n">spmap2</span><span class="o">.</span><span class="n">keySet</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
    <span class="n">k</span> <span class="o">=&gt;{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">spmap1</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_1</span> <span class="o">&lt;</span> <span class="n">spmap2</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_1</span><span class="o">)</span> 
                <span class="n">k</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nc">Tuple3</span><span class="o">(</span><span class="n">spmap1</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_1</span><span class="o">,</span> 
                             <span class="n">spmap1</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_2</span><span class="o">,</span> 
                             <span class="n">spmap1</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_3</span><span class="o">))</span>
        <span class="k">else</span> 
                <span class="n">k</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nc">Tuple3</span><span class="o">(</span><span class="n">spmap2</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_1</span><span class="o">,</span> 
                             <span class="n">spmap2</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_2</span><span class="o">,</span> 
                             <span class="n">spmap2</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">)).</span><span class="n">_3</span><span class="o">))</span>
        <span class="o">}</span>
    <span class="o">}.</span><span class="n">toMap</span>
  <span class="o">}</span>
  
  <span class="c1">// at this point it does not really matter what vertex type is</span>
  <span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">VD</span><span class="o">](</span><span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">VD</span><span class="p">,</span> <span class="kt">Double</span><span class="o">],</span> <span class="n">landmarks</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">VertexId</span><span class="o">])</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">SPMap</span><span class="p">,</span> <span class="kt">Double</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">spGraph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapVertices</span> <span class="o">{</span> <span class="o">(</span><span class="n">vid</span><span class="o">,</span> <span class="n">attr</span><span class="o">)</span> <span class="o">=&gt;</span>
      <span class="c1">// initial value for itself is 0.0 as Double</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">landmarks</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">vid</span><span class="o">))</span> <span class="n">makeMap</span><span class="o">(</span><span class="n">vid</span> <span class="o">-&gt;</span> <span class="nc">Tuple3</span><span class="o">(</span><span class="nc">INITIAL_DIST</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">,</span> <span class="nc">DEFAULT_ID</span><span class="o">))</span> <span class="k">else</span> <span class="n">makeMap</span><span class="o">()</span>
    <span class="o">}</span>

    <span class="k">val</span> <span class="n">initMaps</span> <span class="o">=</span> <span class="n">makeMap</span><span class="o">()</span>

    <span class="k">def</span> <span class="n">vProg</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">,</span> <span class="n">attr</span><span class="k">:</span> <span class="kt">SPMap</span><span class="o">,</span> <span class="n">msg</span><span class="k">:</span> <span class="kt">SPMap</span><span class="o">)</span><span class="k">:</span> <span class="kt">SPMap</span> <span class="o">=</span> <span class="o">{</span>
      <span class="n">addMaps</span><span class="o">(</span><span class="n">attr</span><span class="o">,</span> <span class="n">msg</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="k">def</span> <span class="n">sendMsg</span><span class="o">(</span><span class="n">edge</span><span class="k">:</span> <span class="kt">EdgeTriplet</span><span class="o">[</span><span class="kt">SPMap</span><span class="p">,</span> <span class="kt">Double</span><span class="o">])</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[(</span><span class="kt">VertexId</span><span class="p">,</span> <span class="kt">SPMap</span><span class="o">)]</span> <span class="o">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">newAttr</span> <span class="o">=</span> <span class="n">incrementMap</span><span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="n">dstAttr</span><span class="o">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">attr</span><span class="o">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">srcId</span><span class="o">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">dstId</span><span class="o">)</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">edge</span><span class="o">.</span><span class="n">srcAttr</span> <span class="o">!=</span> <span class="n">addMaps</span><span class="o">(</span><span class="n">newAttr</span><span class="o">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">srcAttr</span><span class="o">))</span> <span class="nc">Iterator</span><span class="o">((</span><span class="n">edge</span><span class="o">.</span><span class="n">srcId</span><span class="o">,</span> <span class="n">newAttr</span><span class="o">))</span>
      <span class="k">else</span> <span class="nc">Iterator</span><span class="o">.</span><span class="n">empty</span>
    <span class="o">}</span>

    <span class="nc">Pregel</span><span class="o">(</span><span class="n">spGraph</span><span class="o">,</span> <span class="n">initMaps</span><span class="o">)(</span><span class="n">vProg</span><span class="o">,</span> <span class="n">sendMsg</span><span class="o">,</span> <span class="n">addMaps</span><span class="o">)</span>
  <span class="o">}</span>
  
  <span class="k">def</span> <span class="n">create_path_graph</span><span class="o">[</span><span class="kt">VD</span><span class="o">](</span><span class="n">graph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">SPMap</span><span class="p">,</span> <span class="kt">Double</span><span class="o">],</span> <span class="n">goalId</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">,</span> <span class="n">startId</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">)</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">PN</span><span class="p">,</span> <span class="kt">Int</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// For a given goal node we remove the lookup map and extend the state to a Tuple5 with the goal id and a boolean</span>
    <span class="k">val</span> <span class="n">path</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">)</span>
              <span class="o">.</span><span class="n">mapVertices</span><span class="o">((</span><span class="n">vertixId</span><span class="o">,</span> <span class="n">attr</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">attr</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">goalId</span><span class="o">))</span> <span class="o">{</span>
                  <span class="k">val</span> <span class="n">path_step</span> <span class="o">=</span> <span class="n">attr</span><span class="o">(</span><span class="n">goalId</span><span class="o">)</span>
                  <span class="k">if</span> <span class="o">(</span><span class="n">vertixId</span> <span class="o">==</span> <span class="n">path_step</span><span class="o">.</span><span class="n">_3</span> <span class="o">&amp;&amp;</span> <span class="n">path_step</span><span class="o">.</span><span class="n">_2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1L</span><span class="o">)</span>
                    <span class="o">(</span><span class="n">path_step</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span> <span class="n">goalId</span><span class="o">,</span> <span class="n">goalId</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span> <span class="c1">// while we are at it, we clean up the state a bit</span>
                  <span class="k">else</span>  
                    <span class="o">(</span><span class="n">path_step</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span> <span class="n">path_step</span><span class="o">.</span><span class="n">_2</span><span class="o">,</span> <span class="n">goalId</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
                <span class="o">}</span> <span class="k">else</span><span class="c1">// If the vertice does not have a map to our goal we add a default value to it</span>
                    <span class="o">(</span><span class="nc">INFINITY</span><span class="o">,</span> <span class="o">-</span><span class="mi">1L</span><span class="o">,</span> <span class="o">-</span><span class="mi">1L</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
              <span class="o">})</span>

      <span class="k">def</span> <span class="n">mergeMsg</span><span class="o">(</span><span class="n">msg1</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">,</span> <span class="n">msg2</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">)</span><span class="k">:</span> <span class="kt">VertexId</span> <span class="o">=</span> <span class="o">{</span> <span class="c1">// we should only get one msg</span>
          <span class="n">msg2</span>
      <span class="o">}</span>

      <span class="k">def</span> <span class="n">vprog</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">,</span> <span class="n">attr</span><span class="k">:</span> <span class="kt">PN</span><span class="o">,</span> <span class="n">msg</span><span class="k">:</span> <span class="kt">VertexId</span><span class="o">)</span><span class="k">:</span> <span class="kt">PN</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c1">// Check that the current node is the one adressed in the message</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">==</span> <span class="n">msg</span><span class="o">)</span>
          <span class="o">(</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="o">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">_3</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
        <span class="k">else</span> <span class="c1">// If the message is not addressed to the current node (happens for inital message), use the old value </span>
          <span class="n">attr</span>
      <span class="o">}</span>
      <span class="k">def</span> <span class="n">sendMsg</span><span class="o">(</span><span class="n">triplet</span><span class="k">:</span> <span class="kt">EdgeTriplet</span><span class="o">[</span><span class="kt">PN</span><span class="p">,</span> <span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[(</span><span class="kt">VertexId</span><span class="p">,</span> <span class="kt">VertexId</span><span class="o">)]</span> <span class="o">=</span> <span class="o">{</span>
        <span class="c1">// If dstId is the next node on the path and has not yet been activated</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">triplet</span><span class="o">.</span><span class="n">srcAttr</span><span class="o">.</span><span class="n">_2</span> <span class="o">==</span> <span class="n">triplet</span><span class="o">.</span><span class="n">dstId</span> <span class="o">&amp;&amp;</span> <span class="n">triplet</span><span class="o">.</span><span class="n">srcAttr</span><span class="o">.</span><span class="n">_4</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">triplet</span><span class="o">.</span><span class="n">dstAttr</span><span class="o">.</span><span class="n">_4</span><span class="o">)</span> 
          <span class="nc">Iterator</span><span class="o">((</span><span class="n">triplet</span><span class="o">.</span><span class="n">dstId</span><span class="o">,</span> <span class="n">triplet</span><span class="o">.</span><span class="n">dstId</span><span class="o">))</span><span class="c1">// Send next msg</span>
        <span class="k">else</span>
          <span class="nc">Iterator</span><span class="o">.</span><span class="n">empty</span><span class="c1">// Do nothing</span>
      <span class="o">}</span>

      <span class="nc">Pregel</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">startId</span><span class="o">)(</span><span class="n">vprog</span><span class="o">,</span> <span class="n">sendMsg</span><span class="o">,</span> <span class="n">mergeMsg</span><span class="o">).</span><span class="n">mapTriplets</span><span class="o">(</span><span class="n">triplet</span> <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">triplet</span><span class="o">.</span><span class="n">srcAttr</span><span class="o">.</span><span class="n">_2</span> <span class="o">==</span> <span class="n">triplet</span><span class="o">.</span><span class="n">dstId</span> <span class="o">&amp;&amp;</span> <span class="n">triplet</span><span class="o">.</span><span class="n">srcAttr</span><span class="o">.</span><span class="n">_4</span><span class="o">)</span>
          <span class="mi">1</span>
        <span class="k">else</span>
          <span class="mi">0</span>
      <span class="o">})</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import scala.reflect.ClassTag
import org.apache.spark.graphx._
defined object ShortestPath
</pre></div>
</div>
</div>
</div>
<p>To make the code somewhat more accessible, we wrap the execution of the
two parts above in a new function called <code class="docutils literal notranslate"><span class="pre">shortestPath</span></code>. This new
function takes the id of the start node and a single goal node as well
as the input graph as input. The function then ouputs the path graph
mentioned above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>

<span class="k">def</span> <span class="n">shortestPath</span><span class="o">(</span><span class="n">srcId</span> <span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">dstId</span> <span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">graph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">],</span> <span class="n">placeholder</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">placeholder</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="nc">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">distanceGraph</span> <span class="o">=</span> <span class="nc">ShortestPath</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">(</span><span class="n">dstId</span><span class="o">))</span>
    <span class="k">val</span> <span class="n">pathGraph</span> <span class="o">=</span> <span class="nc">ShortestPath</span><span class="o">.</span><span class="n">create_path_graph</span><span class="o">(</span><span class="n">distanceGraph</span><span class="o">,</span> <span class="n">dstId</span><span class="o">,</span> <span class="n">srcId</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">pathGraph</span><span class="o">.</span><span class="n">mapVertices</span><span class="o">((</span><span class="n">vid</span><span class="o">,</span> <span class="n">attr</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="mi">0L</span><span class="o">).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">shortestPath</span><span class="o">(</span><span class="n">srcId</span> <span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">dstId</span> <span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">graph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">shortestPath</span><span class="o">(</span><span class="n">srcId</span><span class="o">,</span> <span class="n">dstId</span><span class="o">,</span> <span class="n">graph</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import scala.util.Random
shortestPath: (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double], placeholder: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double])org.apache.spark.graphx.Graph[Long,Double]
shortestPath: (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double], placeholder: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double])org.apache.spark.graphx.Graph[Long,Double]
</pre></div>
</div>
</div>
</div>
<p>Since we want to work with edge attributes rather than vertex
attributes, we can’t work directly with graph joins in GraphX, since
they only join on vertices. This is a helper method to merge edge
attributes of two graphs with identical structure, through an inner join
on the respective edge RDDs and create a new graph with a tuple
combining edge attributes from both graphs. This will only work if both
graphs have identical partitioning strategies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">scala.reflect.ClassTag</span>

<span class="c1">// # Merge edge attributes of two (identical in structure) graphs</span>
<span class="k">def</span> <span class="n">mergeEdgeAttributes</span><span class="o">[</span><span class="kt">ED1</span> <span class="kt">:</span> <span class="kt">ClassTag</span><span class="p">,</span> <span class="kt">ED2</span> <span class="kt">:</span> <span class="kt">ClassTag</span><span class="o">](</span><span class="n">firstGraph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">ED1</span><span class="o">],</span> <span class="n">secondGraph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">ED2</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="o">(</span><span class="kt">ED1</span><span class="p">,</span> <span class="kt">ED2</span><span class="o">)]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nc">Graph</span><span class="o">(</span><span class="n">firstGraph</span><span class="o">.</span><span class="n">vertices</span><span class="o">,</span> <span class="n">firstGraph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">innerJoin</span><span class="o">(</span><span class="n">secondGraph</span><span class="o">.</span><span class="n">edges</span><span class="o">)</span> <span class="o">{(</span><span class="n">id1</span><span class="o">,</span> <span class="n">id2</span><span class="o">,</span> <span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)})</span> 
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import scala.reflect.ClassTag
mergeEdgeAttributes: [ED1, ED2](firstGraph: org.apache.spark.graphx.Graph[Long,ED1], secondGraph: org.apache.spark.graphx.Graph[Long,ED2])(implicit evidence$1: scala.reflect.ClassTag[ED1], implicit evidence$2: scala.reflect.ClassTag[ED2])org.apache.spark.graphx.Graph[Long,(ED1, ED2)]
</pre></div>
</div>
</div>
</div>
<p>In order to perform distributed sampling from Gaussian distributions in
Spark in a reproducible way (specifically for stochastic edge weights in
graphs), we want to be able to pass a seed to the random number
generator. For this to work consistently, we use the Spark SQL <code class="docutils literal notranslate"><span class="pre">randn</span></code>
function on the edge RDDs and subsequently build a new graph from the
sampled weights.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>

<span class="k">def</span> <span class="n">graphRandomGaussian</span><span class="o">(</span><span class="n">graph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="o">(</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">Double</span><span class="o">)],</span> <span class="n">seed</span> <span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">eps</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">sparkSqlRandom</span> <span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">sparkSqlRandom</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Graph</span><span class="o">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="o">,</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">toDF</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;srcId&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;dstId&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;attr._1&quot;</span> <span class="o">+</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;attr._2&quot;</span><span class="o">)</span> <span class="o">*</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">randn</span><span class="o">(</span><span class="n">seed</span><span class="o">)).</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">r</span> <span class="o">=&gt;</span> <span class="nc">Edge</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="n">getLong</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="n">getLong</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="n">getDouble</span><span class="o">(</span><span class="mi">2</span><span class="o">)))).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">scala</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">max</span><span class="o">(</span><span class="n">eps</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">))</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">scala</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">max</span><span class="o">(</span><span class="n">eps</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">+</span> <span class="nc">Random</span><span class="o">.</span><span class="n">nextGaussian</span><span class="o">()</span> <span class="o">*</span> <span class="n">scala</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">)))</span>
  <span class="o">}</span>
<span class="o">}</span> 

<span class="k">def</span> <span class="n">graphRandomGaussian</span><span class="o">(</span><span class="n">graph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="o">(</span><span class="kt">Double</span><span class="p">,</span> <span class="kt">Double</span><span class="o">)],</span> <span class="n">seed</span> <span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">eps</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">graphRandomGaussian</span><span class="o">(</span><span class="n">graph</span><span class="o">,</span> <span class="n">seed</span><span class="o">,</span> <span class="n">eps</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>import scala.util.Random
graphRandomGaussian: (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double, sparkSqlRandom: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double)org.apache.spark.graphx.Graph[Long,Double]
graphRandomGaussian: (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double, sparkSqlRandom: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double)org.apache.spark.graphx.Graph[Long,Double]
</pre></div>
</div>
</div>
</div>
<p>RDDs in Spark contain lineage graphs with information about previous
operations, for e.g. fault tolerance. These can increase significantly
in size after many transformations which may result in reduced
performance, especially in iterative algorithms (such as in GraphX). For
this reason, we truncate the lineage graph by checkpointing the RDDs.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">def</span> <span class="n">locallyCheckpointedGraph</span><span class="o">[</span><span class="kt">VD</span> <span class="kt">:</span> <span class="kt">ClassTag</span><span class="p">,</span> <span class="kt">ED</span> <span class="kt">:</span> <span class="kt">ClassTag</span><span class="o">](</span><span class="n">graph</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">VD</span><span class="p">,</span> <span class="kt">ED</span><span class="o">])</span> <span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">VD</span><span class="p">,</span> <span class="kt">ED</span><span class="o">]</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">mappedGraph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">edgeRdd</span> <span class="o">=</span> <span class="n">mappedGraph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">vertexRdd</span> <span class="o">=</span> <span class="n">mappedGraph</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">)</span>
  <span class="n">edgeRdd</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>
  <span class="n">edgeRdd</span><span class="o">.</span><span class="n">localCheckpoint</span><span class="o">()</span>
  <span class="n">edgeRdd</span><span class="o">.</span><span class="n">count</span><span class="o">()</span> <span class="c1">// We need this line to force the RDD to evaluate, otherwise the truncation is not performed</span>
  <span class="n">vertexRdd</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>
  <span class="n">vertexRdd</span><span class="o">.</span><span class="n">localCheckpoint</span><span class="o">()</span>
  <span class="n">vertexRdd</span><span class="o">.</span><span class="n">count</span><span class="o">()</span> <span class="c1">// We need this line to force the RDD to evaluate, otherwise the truncation is not performed</span>
  <span class="k">return</span> <span class="nc">Graph</span><span class="o">(</span><span class="n">vertexRdd</span><span class="o">,</span> <span class="n">edgeRdd</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="distributed-combinatorial-bandit-algorithm">
<h2>Distributed combinatorial bandit algorithm<a class="headerlink" href="#distributed-combinatorial-bandit-algorithm" title="Permalink to this headline">¶</a></h2>
<p>The cell below contains the distributed combinatorial bandit algorithm,
as well as the simulation framework. In a standard (stochastic)
multi-armed bandit problem setting, there is a set of actions
<span class="math notranslate nohighlight">\(\mathcal{A}\)</span> wherein each selected action <span class="math notranslate nohighlight">\(a \in \mathcal{A}\)</span> results
in the agent receiving a random reward <span class="math notranslate nohighlight">\(r(a)\)</span> from the environment. The
distributions of these rewards are unknown and it is the objective of an
agent to select actions to learn enough information about the reward
distributions such that the long-term rewards can be maximized.</p>
<p>Thompson Sampling is Bayesian bandit algorithm, where the assumption is
that the parameters of the reward distributions are drawn from some
known prior. By using observed rewards to compute a posterior
distribution, the posterior can be used to let the agent explore actions
which have a high probability of being optimal. In each iteration,
parameters are sampled from the posterior for all actions. The action
with the highest (sampled) expected reward is then selected. Thompson
Sampling is straightforward to extend to a combinatorial setting, where
instead of individual actions, subsets of actions subject to
combinatorial constraints are selected in each iteration.</p>
<p>Under the assumption that the travel times individual edges in the road
network graph are mutually independent, an online learning version of
the shortest path problem can be cast into the combinatorial bandit
setting. With the same assumption, the above operations can be performed
using Spark and GraphX, in an iterative algorithm. With the exception of
the step in which the distributed shortest path algorithm (through
pregel) is used to find the path with the lowest (sampled from the
posterior distribution) expected travel time, the rest of the steps can
be performed almost exclusively by using <code class="docutils literal notranslate"><span class="pre">mapEdges</span></code> transformations. In
this way, expensive repartitioning can be avoided.</p>
<p>As we see it, the main benefit with this approach is that if the road
network graph is very large, sub-graphs can be located on different
worker nodes.</p>
<p>NOTE: We run this with a toy example instead of the actual road network
graph, since we had performance issues keeping us from evaluating it in
a meaningful way.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">scala.math.sqrt</span>
<span class="k">import</span> <span class="nn">scala.math.max</span>

<span class="n">println</span><span class="o">(</span><span class="s">&quot;Starting experiment!&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">startTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>

<span class="k">val</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.00001</span>

<span class="c1">// # Horizon N</span>
<span class="k">var</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1">// # Source and destination node IDs</span>
<span class="c1">//val srcId = 0L</span>
<span class="k">var</span> <span class="n">srcId</span> <span class="o">=</span> <span class="mi">2010606671L</span>
<span class="c1">//val dstId = numVertices - 1L</span>
<span class="k">var</span> <span class="n">dstId</span> <span class="o">=</span> <span class="mi">2869293096L</span>

<span class="k">var</span> <span class="n">baseGraph</span><span class="k">:</span> <span class="kt">Graph</span><span class="o">[</span><span class="kt">Long</span><span class="p">,</span> <span class="kt">Double</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span>

<span class="c1">// # Toy example</span>
<span class="k">val</span> <span class="n">useToyExample</span> <span class="o">=</span> <span class="kc">true</span>
<span class="k">if</span> <span class="o">(</span><span class="n">useToyExample</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="n">srcId</span> <span class="o">=</span> <span class="mi">0L</span>
  <span class="n">dstId</span> <span class="o">=</span> <span class="n">numVertices</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="n">baseGraph</span> <span class="o">=</span> <span class="nc">Graph</span><span class="o">.</span><span class="n">fromEdges</span><span class="o">(</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">1</span> <span class="n">until</span> <span class="n">numVertices</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">flatMap</span><span class="o">(</span><span class="n">vid</span> <span class="o">=&gt;</span> <span class="nc">List</span><span class="o">(</span><span class="nc">Edge</span><span class="o">(</span><span class="mi">0L</span><span class="o">,</span> <span class="n">vid</span><span class="o">.</span><span class="n">toLong</span><span class="o">,</span> <span class="mf">100.0</span><span class="o">),</span> <span class="nc">Edge</span><span class="o">(</span><span class="n">vid</span><span class="o">.</span><span class="n">toLong</span><span class="o">,</span> <span class="n">numVertices</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mf">100.0</span><span class="o">))),</span> <span class="mi">0L</span><span class="o">)</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="n">baseGraph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapVertices</span><span class="o">((</span><span class="n">vid</span><span class="o">,</span> <span class="n">attr</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="mi">0L</span><span class="o">)</span>
<span class="o">}</span>

<span class="c1">// # Assumption: Gaussian rewards with known variance</span>
<span class="c1">// # Prior graph (map weight to prior mean and variance)</span>
<span class="k">val</span> <span class="n">varFactor</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="k">val</span> <span class="n">prior</span> <span class="o">=</span> <span class="n">baseGraph</span><span class="o">.</span><span class="n">mapVertices</span><span class="o">((</span><span class="n">vid</span><span class="o">,</span> <span class="n">attr</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="mi">0L</span><span class="o">).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">,</span> <span class="n">varFactor</span> <span class="o">*</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">)))</span>
<span class="k">var</span> <span class="n">posterior</span> <span class="o">=</span> <span class="n">prior</span>

<span class="c1">// # Environment (sample true environment from prior)</span>
<span class="k">val</span> <span class="n">env</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">prior</span><span class="o">,</span> <span class="n">graphRandomGaussian</span><span class="o">(</span><span class="n">prior</span><span class="o">,</span> <span class="n">seed</span><span class="o">,</span> <span class="n">eps</span><span class="o">)).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="o">.</span><span class="n">_2</span><span class="o">))</span>

<span class="c1">// # For regret calculations</span>
<span class="k">val</span> <span class="n">optimal</span> <span class="o">=</span> <span class="n">shortestPath</span><span class="o">(</span><span class="n">srcId</span><span class="o">,</span> <span class="n">dstId</span><span class="o">,</span> <span class="n">env</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="o">))</span>
<span class="k">val</span> <span class="n">optimalExpectedCost</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">optimal</span><span class="o">,</span> <span class="n">env</span><span class="o">).</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="o">).</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
<span class="k">val</span> <span class="n">optimalPathEdges</span> <span class="o">=</span> <span class="n">optimal</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="mi">1</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="n">srcId</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="n">dstId</span><span class="o">)).</span><span class="n">collect</span><span class="o">()</span>
<span class="n">printf</span><span class="o">(</span><span class="s">&quot;Optimal path edges: [%s]\n&quot;</span><span class="o">,</span> <span class="n">optimalPathEdges</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">))</span>

<span class="c1">// # Array with instant regret values</span>
<span class="k">var</span> <span class="n">lastAction</span> <span class="o">=</span> <span class="n">optimal</span>
<span class="k">var</span> <span class="n">allActions</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Double</span><span class="o">](</span><span class="mi">0</span><span class="o">))</span>

<span class="c1">// # Run experiment for N iterations</span>
<span class="k">for</span> <span class="o">(</span><span class="n">t</span> <span class="o">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">N</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">printf</span><span class="o">(</span><span class="s">&quot;Iteration %d, elapsed time: %d ms&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">)</span>
  
  <span class="c1">// # Checkpoint to break lineage graph</span>
  <span class="n">allActions</span> <span class="o">=</span> <span class="n">locallyCheckpointedGraph</span><span class="o">(</span><span class="n">allActions</span><span class="o">)</span>
  <span class="n">posterior</span> <span class="o">=</span> <span class="n">locallyCheckpointedGraph</span><span class="o">(</span><span class="n">posterior</span><span class="o">)</span>
  
  <span class="c1">// # Find action (super arm) using posterior sampling</span>
  <span class="k">val</span> <span class="n">sampledParameters</span> <span class="o">=</span> <span class="n">graphRandomGaussian</span><span class="o">(</span><span class="n">posterior</span><span class="o">,</span> <span class="n">seed</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">eps</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">action</span> <span class="o">=</span> <span class="n">shortestPath</span><span class="o">(</span><span class="n">srcId</span><span class="o">,</span> <span class="n">dstId</span><span class="o">,</span> <span class="n">sampledParameters</span><span class="o">)</span>
  <span class="n">lastAction</span> <span class="o">=</span> <span class="n">action</span>
  
  <span class="c1">// # Apply action on environments (assuming path is indicated by 1-valued edge attributes) and observe realized costs</span>
  <span class="k">val</span> <span class="n">realizedEnv</span> <span class="o">=</span> <span class="n">graphRandomGaussian</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="n">seed</span><span class="o">+</span><span class="n">t</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="o">,</span> <span class="n">eps</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">observation</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">action</span><span class="o">,</span> <span class="n">realizedEnv</span><span class="o">).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">)</span>
  
  <span class="c1">// # Update posterior</span>
  <span class="n">posterior</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">action</span><span class="o">,</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">observation</span><span class="o">,</span> <span class="n">posterior</span><span class="o">))).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">trueVar</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="o">.</span><span class="n">_2</span>
    <span class="k">val</span> <span class="n">act</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span>
    <span class="k">val</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span>
    <span class="k">val</span> <span class="n">pMean</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span>
    <span class="k">val</span> <span class="n">pVar</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">act</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">newVar</span> <span class="o">=</span> <span class="o">(</span><span class="mi">1</span><span class="o">/(</span><span class="mi">1</span><span class="o">/</span><span class="n">trueVar</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">pVar</span><span class="o">))</span>
      <span class="o">(</span><span class="n">newVar</span><span class="o">*(</span><span class="n">obs</span><span class="o">/</span><span class="n">trueVar</span> <span class="o">+</span> <span class="n">pMean</span><span class="o">/</span><span class="n">pVar</span><span class="o">),</span> <span class="n">newVar</span><span class="o">)</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="o">(</span><span class="n">pMean</span><span class="o">,</span> <span class="n">pVar</span><span class="o">)</span>
    <span class="o">}</span>  
  <span class="o">})</span>
  
  <span class="c1">// # Calculate regret</span>
  <span class="n">allActions</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">allActions</span><span class="o">,</span> <span class="n">action</span><span class="o">).</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">:+</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">)</span>
  <span class="n">printf</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">printf</span><span class="o">(</span><span class="s">&quot;Starting aggregation of regret values, elapsed time: %d ms\n&quot;</span><span class="o">,</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">)</span>

<span class="c1">// # Aggregation of regret values</span>
<span class="k">val</span> <span class="n">countActions</span> <span class="o">=</span> <span class="n">allActions</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">))</span>
<span class="n">allActions</span> <span class="o">=</span> <span class="n">allActions</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>
<span class="k">val</span> <span class="n">instantRegretValues</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Double</span><span class="o">](</span><span class="n">N</span><span class="o">)</span>
<span class="k">for</span> <span class="o">(</span><span class="n">t</span> <span class="o">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">N</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">action</span> <span class="o">=</span> <span class="n">allActions</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">(</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="o">))</span>
  <span class="k">val</span> <span class="n">actionExpectedCost</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="o">(</span><span class="n">action</span><span class="o">,</span> <span class="n">env</span><span class="o">).</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="o">).</span><span class="n">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">instantRegret</span> <span class="o">=</span> <span class="n">actionExpectedCost</span> <span class="o">-</span> <span class="n">optimalExpectedCost</span>
  <span class="n">instantRegretValues</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">=</span> <span class="n">instantRegret</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">endTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
<span class="n">printf</span><span class="o">(</span><span class="s">&quot;Finished experiment! Elapsed time:%d\n&quot;</span><span class="o">,</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting experiment!
Optimal path edges: [(0,1),(1,9)]
Iteration 0, elapsed time: 15793 ms
Iteration 1, elapsed time: 37679 ms
Iteration 2, elapsed time: 78937 ms
Iteration 3, elapsed time: 96495 ms
Iteration 4, elapsed time: 114013 ms
Iteration 5, elapsed time: 129434 ms
Iteration 6, elapsed time: 149040 ms
Iteration 7, elapsed time: 161854 ms
Iteration 8, elapsed time: 178462 ms
Iteration 9, elapsed time: 193178 ms
Iteration 10, elapsed time: 208457 ms
Iteration 11, elapsed time: 228850 ms
Iteration 12, elapsed time: 249601 ms
Iteration 13, elapsed time: 277713 ms
Iteration 14, elapsed time: 300296 ms
Iteration 15, elapsed time: 315547 ms
Iteration 16, elapsed time: 334719 ms
Iteration 17, elapsed time: 352283 ms
Iteration 18, elapsed time: 370505 ms
Iteration 19, elapsed time: 384963 ms
Iteration 20, elapsed time: 400986 ms
Iteration 21, elapsed time: 419840 ms
Iteration 22, elapsed time: 437701 ms
Iteration 23, elapsed time: 463018 ms
Iteration 24, elapsed time: 494099 ms
Iteration 25, elapsed time: 515728 ms
Iteration 26, elapsed time: 553540 ms
Iteration 27, elapsed time: 575015 ms
Iteration 28, elapsed time: 592082 ms
Iteration 29, elapsed time: 624349 ms
Iteration 30, elapsed time: 645980 ms
Iteration 31, elapsed time: 686832 ms
Iteration 32, elapsed time: 716649 ms
Iteration 33, elapsed time: 746812 ms
Iteration 34, elapsed time: 763532 ms
Iteration 35, elapsed time: 786390 ms
Iteration 36, elapsed time: 813434 ms
Iteration 37, elapsed time: 835171 ms
Iteration 38, elapsed time: 866043 ms
Iteration 39, elapsed time: 892568 ms
Iteration 40, elapsed time: 918749 ms
Iteration 41, elapsed time: 942338 ms
Iteration 42, elapsed time: 956895 ms
Iteration 43, elapsed time: 972804 ms
Iteration 44, elapsed time: 986972 ms
Iteration 45, elapsed time: 1003529 ms
Iteration 46, elapsed time: 1021157 ms
Iteration 47, elapsed time: 1053163 ms
Iteration 48, elapsed time: 1069664 ms
Iteration 49, elapsed time: 1089713 ms
Iteration 50, elapsed time: 1119183 ms
Iteration 51, elapsed time: 1132827 ms
Iteration 52, elapsed time: 1144452 ms
Iteration 53, elapsed time: 1159900 ms
Iteration 54, elapsed time: 1174581 ms
Iteration 55, elapsed time: 1192365 ms
Iteration 56, elapsed time: 1206917 ms
Iteration 57, elapsed time: 1221419 ms
Iteration 58, elapsed time: 1235554 ms
Iteration 59, elapsed time: 1253976 ms
Iteration 60, elapsed time: 1283507 ms
Iteration 61, elapsed time: 1303086 ms
Iteration 62, elapsed time: 1318591 ms
Iteration 63, elapsed time: 1348081 ms
Iteration 64, elapsed time: 1365186 ms
Iteration 65, elapsed time: 1385235 ms
Iteration 66, elapsed time: 1399504 ms
Iteration 67, elapsed time: 1428328 ms
Iteration 68, elapsed time: 1443365 ms
Iteration 69, elapsed time: 1466065 ms
Iteration 70, elapsed time: 1485121 ms
Iteration 71, elapsed time: 1501413 ms
Iteration 72, elapsed time: 1517653 ms
Iteration 73, elapsed time: 1535818 ms
Iteration 74, elapsed time: 1550425 ms
Iteration 75, elapsed time: 1582959 ms
Iteration 76, elapsed time: 1599048 ms
Iteration 77, elapsed time: 1617722 ms
Iteration 78, elapsed time: 1634656 ms
Iteration 79, elapsed time: 1656438 ms
Iteration 80, elapsed time: 1676291 ms
Iteration 81, elapsed time: 1693179 ms
Iteration 82, elapsed time: 1710943 ms
Iteration 83, elapsed time: 1725179 ms
Iteration 84, elapsed time: 1738993 ms
Iteration 85, elapsed time: 1757378 ms
Iteration 86, elapsed time: 1772705 ms
Iteration 87, elapsed time: 1811560 ms
Iteration 88, elapsed time: 1827914 ms
Iteration 89, elapsed time: 1848061 ms
Iteration 90, elapsed time: 1869575 ms
Iteration 91, elapsed time: 1887501 ms
Iteration 92, elapsed time: 1902993 ms
Iteration 93, elapsed time: 1925588 ms
Iteration 94, elapsed time: 1951213 ms
Iteration 95, elapsed time: 1969550 ms
Iteration 96, elapsed time: 1997350 ms
Iteration 97, elapsed time: 2013487 ms
Iteration 98, elapsed time: 2027179 ms
Iteration 99, elapsed time: 2041817 ms
Starting aggregation of regret values, elapsed time: 2065189 ms
Finished experiment! Elapsed time:2131615
import scala.math.sqrt
import scala.math.max
startTime: Long = 1610442657284
seed: Int = 1000
eps: Double = 1.0E-5
N: Int = 100
srcId: Long = 0
dstId: Long = 9
baseGraph: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@28b64ba4
useToyExample: Boolean = true
varFactor: Double = 0.01
prior: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@74f06565
posterior: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@751a558c
env: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@8ce8e2
optimal: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@6ee0cb5a
optimalExpectedCost: Double = 170.67842154901433
optimalPathEdges: Array[(org.apache.spark.graphx.VertexId, org.apache.spark.graphx.VertexId)] = Array((0,1), (1,9))
lastAction: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@4806b809
allActions: org.apache.spark.graphx.Graph[Long,Array[Double]] = org.apache.spark.graphx.impl.GraphImpl@3ebc1a58
countActions: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@6d46efc7
allActions: org.apache.spark.graphx.Graph[Long,Array[Double]] = org.apache.spark.graphx.impl.GraphImpl@3ebc1a58
instantRegretValues: Array[Double] = Array(26.636988940342178, 23.984447406903655, 0.0, 0.0, 0.0, 28.749696934220793, 0.0, 43.00788444960253, 0.0, 36.899665259259336, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 37.27307360794842, 0.0, 13.28180079789928, 0.0, 13.28180079789928, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13.28180079789928, 13.28180079789928, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 13.28180079789928, 0.0)
endTime: Long = 1610444788899
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="graph-visualization">
<h2>Graph visualization<a class="headerlink" href="#graph-visualization" title="Permalink to this headline">¶</a></h2>
<p>In order to analys the data we visualize a graph which show the number
times it has been visited by the exploration algorithm. When visualised,
the edges with multiple visits are marked with a thicker line. Note that
the graph will get very cluttered if more than 50 nodes are in the
graph.</p>
<p>But first, we need to initialize the d3 package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">package</span> <span class="nn">d3</span>


<span class="c1">// We use a package object so that we can define top level classes like Edge that need to be used in other cells</span>
<span class="c1">// This was modified by Ivan Sadikov to make sure it is compatible the latest databricks notebook</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">com.databricks.backend.daemon.driver.EnhancedRDDFunctions.displayHTML</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Edge</span><span class="o">(</span><span class="n">src</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">dest</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">count</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Node</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Link</span><span class="o">(</span><span class="n">source</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">target</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">value</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Graph</span><span class="o">(</span><span class="n">nodes</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Node</span><span class="o">],</span> <span class="n">links</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Link</span><span class="o">])</span>

<span class="k">object</span> <span class="nc">graphs</span> <span class="o">{</span>
<span class="c1">// val sqlContext = SQLContext.getOrCreate(org.apache.spark.SparkContext.getOrCreate())  /// fix</span>
<span class="k">val</span> <span class="n">sqlContext</span> <span class="o">=</span> <span class="nc">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">().</span><span class="n">getOrCreate</span><span class="o">().</span><span class="n">sqlContext</span>
<span class="k">import</span> <span class="nn">sqlContext.implicits._</span>
  
<span class="k">def</span> <span class="n">force</span><span class="o">(</span><span class="n">clicks</span><span class="k">:</span> <span class="kt">Dataset</span><span class="o">[</span><span class="kt">Edge</span><span class="o">],</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">960</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">data</span> <span class="o">=</span> <span class="n">clicks</span><span class="o">.</span><span class="n">collect</span><span class="o">()</span>
  <span class="k">val</span> <span class="n">nodes</span> <span class="o">=</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">src</span><span class="o">)</span> <span class="o">++</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">dest</span><span class="o">)).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">replaceAll</span><span class="o">(</span><span class="s">&quot;_&quot;</span><span class="o">,</span> <span class="s">&quot; &quot;</span><span class="o">)).</span><span class="n">toSet</span><span class="o">.</span><span class="n">toSeq</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="nc">Node</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">links</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">t</span> <span class="o">=&gt;</span>
    <span class="nc">Link</span><span class="o">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">indexWhere</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">replaceAll</span><span class="o">(</span><span class="s">&quot;_&quot;</span><span class="o">,</span> <span class="s">&quot; &quot;</span><span class="o">)),</span> <span class="n">nodes</span><span class="o">.</span><span class="n">indexWhere</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">replaceAll</span><span class="o">(</span><span class="s">&quot;_&quot;</span><span class="o">,</span> <span class="s">&quot; &quot;</span><span class="o">)),</span> <span class="n">t</span><span class="o">.</span><span class="n">count</span> <span class="o">/</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">showGraph</span><span class="o">(</span><span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">(</span><span class="nc">Graph</span><span class="o">(</span><span class="n">nodes</span><span class="o">,</span> <span class="n">links</span><span class="o">)).</span><span class="n">toDF</span><span class="o">().</span><span class="n">toJSON</span><span class="o">.</span><span class="n">first</span><span class="o">())</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm"> * Displays a force directed graph using d3</span>
<span class="cm"> * input: {&quot;nodes&quot;: [{&quot;name&quot;: &quot;...&quot;}], &quot;links&quot;: [{&quot;source&quot;: 1, &quot;target&quot;: 2, &quot;value&quot;: 0}]}</span>
<span class="cm"> */</span>
<span class="k">def</span> <span class="n">showGraph</span><span class="o">(</span><span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">graph</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>

<span class="n">displayHTML</span><span class="o">(</span><span class="s">s&quot;&quot;&quot;</span>
<span class="s">&lt;style&gt;</span>

<span class="s">.node_circle {</span>
<span class="s">  stroke: #777;</span>
<span class="s">  stroke-width: 1.3px;</span>
<span class="s">}</span>

<span class="s">.node_label {</span>
<span class="s">  pointer-events: none;</span>
<span class="s">}</span>

<span class="s">.link {</span>
<span class="s">  stroke: #777;</span>
<span class="s">  stroke-opacity: .2;</span>
<span class="s">}</span>

<span class="s">.node_count {</span>
<span class="s">  stroke: #777;</span>
<span class="s">  stroke-width: 1.0px;</span>
<span class="s">  fill: #999;</span>
<span class="s">}</span>

<span class="s">text.legend {</span>
<span class="s">  font-family: Verdana;</span>
<span class="s">  font-size: 13px;</span>
<span class="s">  fill: #000;</span>
<span class="s">}</span>

<span class="s">.node text {</span>
<span class="s">  font-family: &quot;Helvetica Neue&quot;,&quot;Helvetica&quot;,&quot;Arial&quot;,sans-serif;</span>
<span class="s">  font-size: 17px;</span>
<span class="s">  font-weight: 200;</span>
<span class="s">}</span>

<span class="s">&lt;/style&gt;</span>

<span class="s">&lt;div id=&quot;clicks-graph&quot;&gt;</span>
<span class="s">&lt;script src=&quot;//d3js.org/d3.v3.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="s">&lt;script&gt;</span>

<span class="s">var graph = </span><span class="si">$graph</span><span class="s">;</span>

<span class="s">var width = </span><span class="si">$width</span><span class="s">,</span>
<span class="s">    height = </span><span class="si">$height</span><span class="s">;</span>

<span class="s">var color = d3.scale.category20();</span>

<span class="s">var force = d3.layout.force()</span>
<span class="s">    .charge(-700)</span>
<span class="s">    .linkDistance(180)</span>
<span class="s">    .size([width, height]);</span>

<span class="s">var svg = d3.select(&quot;#clicks-graph&quot;).append(&quot;svg&quot;)</span>
<span class="s">    .attr(&quot;width&quot;, width)</span>
<span class="s">    .attr(&quot;height&quot;, height);</span>
<span class="s">    </span>
<span class="s">force</span>
<span class="s">    .nodes(graph.nodes)</span>
<span class="s">    .links(graph.links)</span>
<span class="s">    .start();</span>

<span class="s">var link = svg.selectAll(&quot;.link&quot;)</span>
<span class="s">    .data(graph.links)</span>
<span class="s">    .enter().append(&quot;line&quot;)</span>
<span class="s">    .attr(&quot;class&quot;, &quot;link&quot;)</span>
<span class="s">    .style(&quot;stroke-width&quot;, function(d) { return Math.sqrt(d.value); });</span>

<span class="s">var node = svg.selectAll(&quot;.node&quot;)</span>
<span class="s">    .data(graph.nodes)</span>
<span class="s">    .enter().append(&quot;g&quot;)</span>
<span class="s">    .attr(&quot;class&quot;, &quot;node&quot;)</span>
<span class="s">    .call(force.drag);</span>

<span class="s">node.append(&quot;circle&quot;)</span>
<span class="s">    .attr(&quot;r&quot;, 10)</span>
<span class="s">    .style(&quot;fill&quot;, function (d) {</span>
<span class="s">    if (d.name.startsWith(&quot;other&quot;)) { return color(1); } else { return color(2); };</span>
<span class="s">})</span>

<span class="s">node.append(&quot;text&quot;)</span>
<span class="s">      .attr(&quot;dx&quot;, 10)</span>
<span class="s">      .attr(&quot;dy&quot;, &quot;.35em&quot;)</span>
<span class="s">      .text(function(d) { return d.name });</span>
<span class="s">      </span>
<span class="s">//Now we are giving the SVGs co-ordinates - the force layout is generating the co-ordinates which this code is using to update the attributes of the SVG elements</span>
<span class="s">force.on(&quot;tick&quot;, function () {</span>
<span class="s">    link.attr(&quot;x1&quot;, function (d) {</span>
<span class="s">        return d.source.x;</span>
<span class="s">    })</span>
<span class="s">        .attr(&quot;y1&quot;, function (d) {</span>
<span class="s">        return d.source.y;</span>
<span class="s">    })</span>
<span class="s">        .attr(&quot;x2&quot;, function (d) {</span>
<span class="s">        return d.target.x;</span>
<span class="s">    })</span>
<span class="s">        .attr(&quot;y2&quot;, function (d) {</span>
<span class="s">        return d.target.y;</span>
<span class="s">    });</span>
<span class="s">    d3.selectAll(&quot;circle&quot;).attr(&quot;cx&quot;, function (d) {</span>
<span class="s">        return d.x;</span>
<span class="s">    })</span>
<span class="s">        .attr(&quot;cy&quot;, function (d) {</span>
<span class="s">        return d.y;</span>
<span class="s">    });</span>
<span class="s">    d3.selectAll(&quot;text&quot;).attr(&quot;x&quot;, function (d) {</span>
<span class="s">        return d.x;</span>
<span class="s">    })</span>
<span class="s">        .attr(&quot;y&quot;, function (d) {</span>
<span class="s">        return d.y;</span>
<span class="s">    });</span>
<span class="s">});</span>
<span class="s">&lt;/script&gt;</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">)</span>
<span class="o">}</span>
  
  <span class="k">def</span> <span class="n">help</span><span class="o">()</span> <span class="o">=</span> <span class="o">{</span>
<span class="n">displayHTML</span><span class="o">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;p&gt;</span>
<span class="s">Produces a force-directed graph given a collection of edges of the following form:&lt;/br&gt;</span>
<span class="s">&lt;tt&gt;&lt;font color=&quot;#a71d5d&quot;&gt;case class&lt;/font&gt; &lt;font color=&quot;#795da3&quot;&gt;Edge&lt;/font&gt;(&lt;font color=&quot;#ed6a43&quot;&gt;src&lt;/font&gt;: &lt;font color=&quot;#a71d5d&quot;&gt;String&lt;/font&gt;, &lt;font color=&quot;#ed6a43&quot;&gt;dest&lt;/font&gt;: &lt;font color=&quot;#a71d5d&quot;&gt;String&lt;/font&gt;, &lt;font color=&quot;#ed6a43&quot;&gt;count&lt;/font&gt;: &lt;font color=&quot;#a71d5d&quot;&gt;Long&lt;/font&gt;)&lt;/tt&gt;</span>
<span class="s">&lt;/p&gt;</span>
<span class="s">&lt;p&gt;Usage:&lt;br/&gt;</span>
<span class="s">&lt;tt&gt;&lt;font color=&quot;#a71d5d&quot;&gt;import&lt;/font&gt; &lt;font color=&quot;#ed6a43&quot;&gt;d3._&lt;/font&gt;&lt;/tt&gt;&lt;br/&gt;</span>
<span class="s">&lt;tt&gt;&lt;font color=&quot;#795da3&quot;&gt;graphs.force&lt;/font&gt;(&lt;/br&gt;</span>
<span class="s">&amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ed6a43&quot;&gt;height&lt;/font&gt; = &lt;font color=&quot;#795da3&quot;&gt;500&lt;/font&gt;,&lt;br/&gt;</span>
<span class="s">&amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ed6a43&quot;&gt;width&lt;/font&gt; = &lt;font color=&quot;#795da3&quot;&gt;500&lt;/font&gt;,&lt;br/&gt;</span>
<span class="s">&amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ed6a43&quot;&gt;clicks&lt;/font&gt;: &lt;font color=&quot;#795da3&quot;&gt;Dataset&lt;/font&gt;[&lt;font color=&quot;#795da3&quot;&gt;Edge&lt;/font&gt;])&lt;/tt&gt;</span>
<span class="s">&lt;/p&gt;&quot;&quot;&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning: classes defined within packages cannot be redefined without a cluster restart.
Compilation successful.
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">import</span> <span class="nn">org.graphframes.GraphFrame</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions.lit</span> <span class="c1">// import the lit function in sql</span>

<span class="k">val</span> <span class="n">visitedEdges</span> <span class="o">=</span> <span class="nc">GraphFrame</span><span class="o">.</span><span class="n">fromGraphX</span><span class="o">(</span><span class="n">countActions</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">toInt</span><span class="o">))</span>
<span class="k">val</span> <span class="n">visits</span> <span class="o">=</span> <span class="n">visitedEdges</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;attr&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;count&quot;</span><span class="o">))</span>
<span class="k">val</span> <span class="n">maxVisits</span> <span class="o">=</span> <span class="n">visits</span><span class="o">.</span><span class="n">agg</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">max</span><span class="o">(</span><span class="n">visits</span><span class="o">(</span><span class="s">&quot;count&quot;</span><span class="o">)))</span>
<span class="n">d3</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">force</span><span class="o">(</span>
  <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="o">,</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">,</span>
  <span class="n">clicks</span> <span class="o">=</span> <span class="n">visitedEdges</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;src&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;dst&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;dest&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;attr&quot;</span><span class="o">.</span><span class="n">divide</span><span class="o">(</span><span class="n">maxVisits</span><span class="o">.</span><span class="n">first</span><span class="o">().</span><span class="n">getInt</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="n">multiply</span><span class="o">(</span><span class="mi">500</span><span class="o">).</span><span class="n">cast</span><span class="o">(</span><span class="s">&quot;int&quot;</span><span class="o">).</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;count&quot;</span><span class="o">)).</span><span class="n">as</span><span class="o">[</span><span class="kt">d3.Edge</span><span class="o">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>

.node_circle {
  stroke: #777;
  stroke-width: 1.3px;
}

.node_label {
  pointer-events: none;
}

.link {
  stroke: #777;
  stroke-opacity: .2;
}

.node_count {
  stroke: #777;
  stroke-width: 1.0px;
  fill: #999;
}

text.legend {
  font-family: Verdana;
  font-size: 13px;
  fill: #000;
}

.node text {
  font-family: "Helvetica Neue","Helvetica","Arial",sans-serif;
  font-size: 17px;
  font-weight: 200;
}

</style>

<div id="clicks-graph">
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var graph = {"nodes":[{"name":"8"},{"name":"4"},{"name":"9"},{"name":"5"},{"name":"6"},{"name":"1"},{"name":"0"},{"name":"2"},{"name":"7"},{"name":"3"}],"links":[{"source":6,"target":5,"value":26},{"source":5,"target":2,"value":26},{"source":6,"target":7,"value":1},{"source":7,"target":2,"value":1},{"source":6,"target":9,"value":2},{"source":9,"target":2,"value":2},{"source":6,"target":1,"value":1},{"source":1,"target":2,"value":1},{"source":6,"target":3,"value":1},{"source":3,"target":2,"value":1},{"source":6,"target":4,"value":1},{"source":4,"target":2,"value":1},{"source":6,"target":8,"value":1},{"source":8,"target":2,"value":1},{"source":6,"target":0,"value":1},{"source":0,"target":2,"value":1}]};

var width = 1000,
    height = 500;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(-700)
    .linkDistance(180)
    .size([width, height]);

var svg = d3.select("#clicks-graph").append("svg")
    .attr("width", width)
    .attr("height", height);

force
    .nodes(graph.nodes)
    .links(graph.links)
    .start();

var link = svg.selectAll(".link")
    .data(graph.links)
    .enter().append("line")
    .attr("class", "link")
    .style("stroke-width", function(d) { return Math.sqrt(d.value); });

var node = svg.selectAll(".node")
    .data(graph.nodes)
    .enter().append("g")
    .attr("class", "node")
    .call(force.drag);

node.append("circle")
    .attr("r", 10)
    .style("fill", function (d) {
    if (d.name.startsWith("other")) { return color(1); } else { return color(2); };
})

node.append("text")
      .attr("dx", 10)
      .attr("dy", ".35em")
      .text(function(d) { return d.name });

//Now we are giving the SVGs co-ordinates - the force layout is generating the co-ordinates which this code is using to update the attributes of the SVG elements
force.on("tick", function () {
    link.attr("x1", function (d) {
        return d.source.x;
    })
        .attr("y1", function (d) {
        return d.source.y;
    })
        .attr("x2", function (d) {
        return d.target.x;
    })
        .attr("y2", function (d) {
        return d.target.y;
    });
    d3.selectAll("circle").attr("cx", function (d) {
        return d.x;
    })
        .attr("cy", function (d) {
        return d.y;
    });
    d3.selectAll("text").attr("x", function (d) {
        return d.x;
    })
        .attr("y", function (d) {
        return d.y;
    });
});
</script>
</div>
</div></div>
</div>
<p>We can also visualize the shortest path in the graph.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>

<span class="k">val</span> <span class="n">posteriorShortestPath</span> <span class="o">=</span> <span class="nc">GraphFrame</span><span class="o">.</span><span class="n">fromGraphX</span><span class="o">(</span><span class="n">lastAction</span><span class="o">.</span><span class="n">mapEdges</span><span class="o">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">toInt</span><span class="o">*</span><span class="mi">10000</span><span class="o">))</span>

<span class="n">d3</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">force</span><span class="o">(</span>
  <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span><span class="o">,</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">,</span>
  <span class="n">clicks</span> <span class="o">=</span> <span class="n">posteriorShortestPath</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">$</span><span class="s">&quot;src&quot;</span><span class="o">,</span> <span class="n">$</span><span class="s">&quot;dst&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;dest&quot;</span><span class="o">),</span> <span class="n">$</span><span class="s">&quot;attr&quot;</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="s">&quot;count&quot;</span><span class="o">)).</span><span class="n">as</span><span class="o">[</span><span class="kt">d3.Edge</span><span class="o">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<style>

.node_circle {
  stroke: #777;
  stroke-width: 1.3px;
}

.node_label {
  pointer-events: none;
}

.link {
  stroke: #777;
  stroke-opacity: .2;
}

.node_count {
  stroke: #777;
  stroke-width: 1.0px;
  fill: #999;
}

text.legend {
  font-family: Verdana;
  font-size: 13px;
  fill: #000;
}

.node text {
  font-family: "Helvetica Neue","Helvetica","Arial",sans-serif;
  font-size: 17px;
  font-weight: 200;
}

</style>

<div id="clicks-graph">
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var graph = {"nodes":[{"name":"8"},{"name":"4"},{"name":"9"},{"name":"5"},{"name":"6"},{"name":"1"},{"name":"0"},{"name":"2"},{"name":"7"},{"name":"3"}],"links":[{"source":6,"target":5,"value":501},{"source":5,"target":2,"value":501},{"source":6,"target":7,"value":1},{"source":7,"target":2,"value":1},{"source":6,"target":9,"value":1},{"source":9,"target":2,"value":1},{"source":6,"target":1,"value":1},{"source":1,"target":2,"value":1},{"source":6,"target":3,"value":1},{"source":3,"target":2,"value":1},{"source":6,"target":4,"value":1},{"source":4,"target":2,"value":1},{"source":6,"target":8,"value":1},{"source":8,"target":2,"value":1},{"source":6,"target":0,"value":1},{"source":0,"target":2,"value":1}]};

var width = 1000,
    height = 500;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(-700)
    .linkDistance(180)
    .size([width, height]);

var svg = d3.select("#clicks-graph").append("svg")
    .attr("width", width)
    .attr("height", height);

force
    .nodes(graph.nodes)
    .links(graph.links)
    .start();

var link = svg.selectAll(".link")
    .data(graph.links)
    .enter().append("line")
    .attr("class", "link")
    .style("stroke-width", function(d) { return Math.sqrt(d.value); });

var node = svg.selectAll(".node")
    .data(graph.nodes)
    .enter().append("g")
    .attr("class", "node")
    .call(force.drag);

node.append("circle")
    .attr("r", 10)
    .style("fill", function (d) {
    if (d.name.startsWith("other")) { return color(1); } else { return color(2); };
})

node.append("text")
      .attr("dx", 10)
      .attr("dy", ".35em")
      .text(function(d) { return d.name });

//Now we are giving the SVGs co-ordinates - the force layout is generating the co-ordinates which this code is using to update the attributes of the SVG elements
force.on("tick", function () {
    link.attr("x1", function (d) {
        return d.source.x;
    })
        .attr("y1", function (d) {
        return d.source.y;
    })
        .attr("x2", function (d) {
        return d.target.x;
    })
        .attr("y2", function (d) {
        return d.target.y;
    });
    d3.selectAll("circle").attr("cx", function (d) {
        return d.x;
    })
        .attr("cy", function (d) {
        return d.y;
    });
    d3.selectAll("text").attr("x", function (d) {
        return d.x;
    })
        .attr("y", function (d) {
        return d.y;
    });
});
</script>
</div>
</div></div>
</div>
<p>Now we visualize the instant regret. We should see a lot ot spikes in
the beginning of the graph but the general trend should be that the
curve decrease to zero while having fewer spikes as the algorithm gets
closer to the optimal solutions. Note that there will always be some
spikes as these corresponds to “exploratory” actions.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">val</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="o">((</span><span class="mi">1</span> <span class="n">to</span> <span class="n">N</span><span class="o">)</span> <span class="n">zip</span> <span class="n">instantRegretValues</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">&quot;Iteration (t)&quot;</span><span class="o">,</span><span class="s">&quot;Instant regret&quot;</span><span class="o">)</span>
<span class="n">display</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr class="header">
<th>Iteration (t)</th>
<th>Instant regret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>26.636988940342178</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>23.984447406903655</td>
</tr>
<tr class="odd">
<td>3.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>4.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>5.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>6.0</td>
<td>28.749696934220793</td>
</tr>
<tr class="odd">
<td>7.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>8.0</td>
<td>43.00788444960253</td>
</tr>
<tr class="odd">
<td>9.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>10.0</td>
<td>36.899665259259336</td>
</tr>
<tr class="odd">
<td>11.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>12.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>13.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>14.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>15.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>16.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>17.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>18.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>19.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>20.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>21.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>22.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>23.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>24.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>25.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>26.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>27.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>28.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>29.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>30.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>31.0</td>
<td>37.27307360794842</td>
</tr>
<tr class="even">
<td>32.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>33.0</td>
<td>13.28180079789928</td>
</tr>
<tr class="even">
<td>34.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>35.0</td>
<td>13.28180079789928</td>
</tr>
<tr class="even">
<td>36.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>37.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>38.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>39.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>40.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>41.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>42.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>43.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>44.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>45.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>46.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>47.0</td>
<td>13.28180079789928</td>
</tr>
<tr class="even">
<td>48.0</td>
<td>13.28180079789928</td>
</tr>
<tr class="odd">
<td>49.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>50.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>51.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>52.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>53.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>54.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>55.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>56.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>57.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>58.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>59.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>60.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>61.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>62.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>63.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>64.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>65.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>66.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>67.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>68.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>69.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>70.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>71.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>72.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>73.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>74.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>75.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>76.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>77.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>78.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>79.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>80.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>81.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>82.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>83.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>84.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>85.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>86.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>87.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>88.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>89.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>90.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>91.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>92.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>93.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>94.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>95.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>96.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>97.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>98.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td>99.0</td>
<td>13.28180079789928</td>
</tr>
<tr class="even">
<td>100.0</td>
<td>0.0</td>
</tr>
</tbody>
</table></div></div>
</div>
<p>We can also show the cumulative regret. As the algorithm reaches a final
solution, the instantaneous regret should decrease and the cumulative
regret should reach a plateau.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">scala</span>
<span class="k">val</span> <span class="n">cumulativeRegret</span> <span class="o">=</span> <span class="n">instantRegretValues</span><span class="o">.</span><span class="n">scanLeft</span><span class="o">(</span><span class="mf">0.0</span><span class="o">)(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
<span class="k">val</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="o">((</span><span class="mi">1</span> <span class="n">to</span> <span class="n">N</span><span class="o">)</span> <span class="n">zip</span> <span class="n">cumulativeRegret</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">&quot;Iteration (t)&quot;</span><span class="o">,</span><span class="s">&quot;Cumulative regret&quot;</span><span class="o">)</span>
<span class="n">display</span><span class="o">(</span><span class="n">df</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<thead>
<tr class="header">
<th>Iteration (t)</th>
<th>Cumulative regret</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>26.636988940342178</td>
</tr>
<tr class="odd">
<td>3.0</td>
<td>50.62143634724583</td>
</tr>
<tr class="even">
<td>4.0</td>
<td>50.62143634724583</td>
</tr>
<tr class="odd">
<td>5.0</td>
<td>50.62143634724583</td>
</tr>
<tr class="even">
<td>6.0</td>
<td>50.62143634724583</td>
</tr>
<tr class="odd">
<td>7.0</td>
<td>79.37113328146663</td>
</tr>
<tr class="even">
<td>8.0</td>
<td>79.37113328146663</td>
</tr>
<tr class="odd">
<td>9.0</td>
<td>122.37901773106915</td>
</tr>
<tr class="even">
<td>10.0</td>
<td>122.37901773106915</td>
</tr>
<tr class="odd">
<td>11.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>12.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>13.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>14.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>15.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>16.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>17.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>18.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>19.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>20.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>21.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>22.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>23.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>24.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>25.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>26.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>27.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>28.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>29.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>30.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="odd">
<td>31.0</td>
<td>159.2786829903285</td>
</tr>
<tr class="even">
<td>32.0</td>
<td>196.5517565982769</td>
</tr>
<tr class="odd">
<td>33.0</td>
<td>196.5517565982769</td>
</tr>
<tr class="even">
<td>34.0</td>
<td>209.8335573961762</td>
</tr>
<tr class="odd">
<td>35.0</td>
<td>209.8335573961762</td>
</tr>
<tr class="even">
<td>36.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="odd">
<td>37.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="even">
<td>38.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="odd">
<td>39.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="even">
<td>40.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="odd">
<td>41.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="even">
<td>42.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="odd">
<td>43.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="even">
<td>44.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="odd">
<td>45.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="even">
<td>46.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="odd">
<td>47.0</td>
<td>223.11535819407547</td>
</tr>
<tr class="even">
<td>48.0</td>
<td>236.39715899197475</td>
</tr>
<tr class="odd">
<td>49.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>50.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>51.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>52.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>53.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>54.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>55.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>56.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>57.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>58.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>59.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>60.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>61.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>62.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>63.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>64.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>65.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>66.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>67.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>68.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>69.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>70.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>71.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>72.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>73.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>74.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>75.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>76.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>77.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>78.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>79.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>80.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>81.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>82.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>83.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>84.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>85.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>86.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>87.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>88.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>89.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>90.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>91.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>92.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>93.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>94.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>95.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>96.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>97.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>98.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="odd">
<td>99.0</td>
<td>249.67895978987403</td>
</tr>
<tr class="even">
<td>100.0</td>
<td>262.9607605877733</td>
</tr>
</tbody>
</table></div></div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Sadikov, I., &amp; Sainudiin, R.. (2016). Distributed Weighted Shortest
Paths.
<a href="http://lamastex.org/lmse/mep/src/GraphXShortestWeightedPaths.html" class="uri">http://lamastex.org/lmse/mep/src/GraphXShortestWeightedPaths.html</a>.</p>
<p>Thompson, W. (1933). On the likelihood that one unknown probability
exceeds another in view of the evidence of two samples. <em>Biometrika</em>,
25(3–4), 285-–294.</p>
<p>Wang, S., &amp; Chen, W. (2018). Thompson sampling for combinatorial
semi-bandits. In <em>International Conference on Machine Learning</em> (pp.
5114–5122).</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "scala212"
        },
        kernelOptions: {
            kernelName: "scala212",
            path: "./000_0-sds-3-x-projects/student-project-14_group-NullHypothesisEvaluationCriteria"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'scala212'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../student-project-13_group-Genomics/01_1000genomes.html" title="previous page">Genomics Analysis with Glow and Spark</a>
    <a class='right-next' id="next-link" href="../student-project-15_group-FinancialDataStreams/00_video.html" title="next page">Reinforcement Learning for Intraday Trading</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By ScaDaMaLe Team<br/>
        
            &copy; Copyright 2020 Creative Commons Zero v1.0 Universal.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>