
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Shortest Path algorithm &#8212; Scalable Data Science &amp; Distributed Machine Learning</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Scalable Data Science & Distributed Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/000_ScaDaMaLe.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark Core
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/001_whySpark.html">
   Why Apache Spark?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html">
   databricks community edition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#essentials-of-databricks-cloud-dbc-in-a-big-hurry">
   Essentials of Databricks Cloud (DBC) in a Big Hurry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-what-is-databricks-cloud">
   DBC Essentials: What is Databricks Cloud?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-shard-cluster-notebook-and-dashboard">
   DBC Essentials: Shard, Cluster, Notebook and Dashboard
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-team-state-collaboration-elastic-resources">
   DBC Essentials: Team, State, Collaboration, Elastic Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#you-should-all-have-databricks-community-edition-account-by-now">
   You Should All Have databricks community edition account by now!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#import-course-content-now">
   Import Course Content Now!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#cloud-free-computing-environment-optional-but-recommended">
   Cloud-free Computing Environment (Optional but recommended)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html">
   Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html#further-reference-homework-recurrrent-points-of-reference">
   Further Reference / Homework / Recurrrent Points of Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html">
   Introduction to Scala through Scala Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-in-your-own-computer">
   Scala in your own computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-resources">
   Scala Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#introduction-to-scala">
   Introduction to Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#let-s-get-our-hands-dirty-in-scala">
   Let’s get our hands dirty in Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-types">
   Scala Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#expressions">
   Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#blocks">
   Blocks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#functions">
   Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#methods">
   Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#classes">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#case-classes">
   Case Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#objects">
   Objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#traits">
   Traits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#main-method">
   Main Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#what-i-try-not-do-while-learning-a-new-language">
   What I try not do while learning a new language?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html">
   Scala Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#let-s-continue-to-get-our-hands-dirty-in-scala">
   Let’s continue to get our hands dirty in Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#scala-type-hierarchy">
   Scala Type Hierarchy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#scala-collections">
   Scala Collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#exercise-in-functional-programming">
   Exercise in Functional Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#lazy-evaluation">
   Lazy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#recursions">
   Recursions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html">
   Introduction to Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html#spark-cluster-overview">
   Spark Cluster Overview:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/005_RDDsTransformationsActionsHOMEWORK.html">
   HOMEWORK notebook - RDDs Transformations and Actions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html">
   Piped RDDs and Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#from-a-local-collection">
   From a Local Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#glom">
   glom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#checkpointing">
   Checkpointing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#pipe-rdds-to-system-commands">
   Pipe RDDs to System Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#mappartitions">
   mapPartitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#foreachpartition">
   foreachPartition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#numerically-rigorous-bayesian-ab-testing">
   Numerically Rigorous Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#usage-instructions-for-isit1or2coins">
   Usage instructions for IsIt1or2Coins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006_WordCount.html">
   Word Count on US State of the Union (SoU) Addresses
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark SQL
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html">
   Introduction to Spark SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#overview">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#datasets-and-dataframes">
   Datasets and DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#getting-started-in-spark-2-x">
   Getting Started in Spark 2.x
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007a_SparkSQLProgGuide_HW.html">
   Spark Sql Programming Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html#id1">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007c_SparkSQLProgGuide_HW.html">
   Getting Started - Exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html">
   Data Sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html#id1">
   Data Sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007e_SparkSQLProgGuide_HW.html">
   Performance Tuning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html">
   Distributed SQL Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html#id1">
   Distributed SQL Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html">
   ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#sql-pivoting-since-spark-2-4">
   SQL Pivoting since Spark 2.4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#load-data">
   Load Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-in-sql">
   Pivoting in SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-aggregate-expressions">
   Pivoting with Multiple Aggregate Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-grouping-columns">
   Pivoting with Multiple Grouping Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-pivot-columns">
   Pivoting with Multiple Pivot Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html">
   Diamonds ML Pipeline Workflow - DataFrame ETL and EDA Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-1-load-data-as-dataframe">
   Step 1. Load data as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-2-understand-the-data">
   Step 2. Understand the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#let-us-run-through-some-basic-inteactive-sql-queries-next">
   Let us run through some basic inteactive SQL queries next
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#why-do-we-need-to-know-these-interactive-sql-queries">
   Why do we need to know these interactive SQL queries?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset">
   We will continue later with ML pipelines to do prediction with a fitted model from this dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html">
   Power Plant ML Pipeline Application - DataFrame Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-1-business-understanding">
   Step 1: Business Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-2-load-your-data">
   Step 2: Load Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce">
   USE THIS FOR OTHER SMALLish DataSets you want to import to your CE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-3-explore-your-data">
   Step 3: Explore Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-4-visualize-your-data">
   Step 4: Visualize Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html">
   Wiki Clickstream Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html#wikipedia-logo">
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html">
   Old Bailey Online Data Analysis in Apache Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html#analysing-the-full-old-bailey-online-sessions-papers-dataset">
   Analysing the Full Old Bailey Online Sessions Papers Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html">
   Piped RDDs and Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#from-a-local-collection">
   From a Local Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#glom">
   glom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#checkpointing">
   Checkpointing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#pipe-rdds-to-system-commands">
   Pipe RDDs to System Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#mappartitions">
   mapPartitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#foreachpartition">
   foreachPartition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#numerically-rigorous-bayesian-ab-testing">
   Numerically Rigorous Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#usage-instructions-for-isit1or2coins">
   Usage instructions for IsIt1or2Coins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#parsing-the-output-from-isit1or2coins">
   Parsing the output from
   <code class="docutils literal notranslate">
    <span class="pre">
     IsIt1or2Coins
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#providing-case-classes-for-input-and-output-for-easy-spark-communication">
   Providing case classes for input and output for easy spark communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Distribute Deep Learning with Horovod
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/00_DDL_Introduction.html">
   Introduction to Distributed Deep Learning (DDL) with Horovod over Tensorflow/keras and Pytorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/0x_mnist-tensorflow-keras.html">
   Distributed deep learning training using TensorFlow and Keras with HorovodRunner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/0y_mnist-pytorch.html">
   Distributed deep learning training using PyTorch with HorovodRunner for MNIST
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  WASP AI-Track Student Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Voluntary Student Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html">
   Plugging into GDELT Streams - TODO - IN PROGRESS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html#this-is-just-dipping-our-pinky-toe-in-this-ocean-of-information">
   This is just dipping our pinky toe in this ocean of information!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html#download-from-gdelt-project">
   Download from gdelt-project
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/000_0-sds-3-x-projects/student-project-14_group-NullHypothesisEvaluationCriteria/wip_distributed_combinatorial_bandit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html/issues/new?title=Issue%20on%20page%20%2F000_0-sds-3-x-projects/student-project-14_group-NullHypothesisEvaluationCriteria/wip_distributed_combinatorial_bandit.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   The Shortest Path algorithm
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#graph-visualization">
   Graph visualization
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="p">(</span><span class="n">copied</span> <span class="kn">from</span> <span class="nn">http</span><span class="p">:</span><span class="o">//</span><span class="n">lamastex</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">lmse</span><span class="o">/</span><span class="n">mep</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">GraphXShortestWeightedPaths</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">scala.util.Random</span>
<span class="kn">import</span> <span class="nn">scala.math.max</span>

<span class="kn">import</span> <span class="nn">scala.reflect.ClassTag</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.graphx._</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.graphx.</span><span class="p">{</span><span class="n">Graph</span><span class="p">,</span> <span class="n">VertexId</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.graphx.util.GraphGenerators</span>


<span class="o">//</span> <span class="n">A</span> <span class="n">graph</span> <span class="k">with</span> <span class="n">edge</span> <span class="n">attributes</span> <span class="n">containing</span> <span class="n">distances</span>
<span class="o">//</span><span class="n">val</span> <span class="n">graphSeed</span> <span class="o">=</span> <span class="mi">123</span><span class="n">L</span>
<span class="n">val</span> <span class="n">graphSeed</span> <span class="o">=</span> <span class="mi">3</span><span class="n">L</span>
<span class="n">val</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">val</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">Double</span><span class="p">]</span> <span class="o">=</span> <span class="n">GraphGenerators</span><span class="o">.</span><span class="n">logNormalGraph</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">numVertices</span> <span class="o">=</span> <span class="n">numVertices</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">graphSeed</span><span class="p">)</span><span class="o">.</span><span class="n">mapEdges</span> <span class="p">{</span> <span class="n">e</span> <span class="o">=&gt;</span> 
  <span class="o">//</span> <span class="n">to</span> <span class="n">make</span> <span class="n">things</span> <span class="n">nicer</span> <span class="n">we</span> <span class="n">assign</span> <span class="mi">0</span> <span class="n">distance</span> <span class="n">to</span> <span class="n">itself</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">srcId</span> <span class="o">==</span> <span class="n">e</span><span class="o">.</span><span class="n">dstId</span><span class="p">)</span> <span class="mf">0.0</span> <span class="k">else</span> <span class="n">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="p">()</span>
<span class="p">}</span><span class="o">.</span><span class="n">groupEdges</span><span class="p">((</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import scala.util.Random
import scala.math.max
import scala.reflect.ClassTag
import org.apache.spark.graphx._
import org.apache.spark.graphx.{Graph, VertexId}
import org.apache.spark.graphx.util.GraphGenerators
graphSeed: Long = 3
numVertices: Int = 50
graph: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@4d95da76
</pre></div>
</div>
</div></blockquote>
<div class="section" id="the-shortest-path-algorithm">
<h1>The Shortest Path algorithm<a class="headerlink" href="#the-shortest-path-algorithm" title="Permalink to this headline">¶</a></h1>
<p>The implemented shorthest path alborithm uses the the distributed Pregel
algorithm and is divided into two parts.</p>
<p>The first part is based on the code in
<code class="docutils literal notranslate"><span class="pre">998_EX_01_GraphXShortestWeightedPaths</span></code>. As the original code did not
have have all functionality desiered functionality, the algorithm did
find the shortest distance but didn’t keep track of the path itself, the
algorithm was extend with this functionality.</p>
<p>The first part takes a graph, where the edges are double values
representing the cost of trevelling between its connected nodes, and an
array of the ids of each goal node. As output, it provides a graph where
each node containse a Map-object of the different landmarks/goal nodes.
When a lookup is made in the map from a specific node, a tuple contaning
the shortest distance, the id of the next node in the path and the id of
the current node. The last element serves no pupose in the final results
but is used as a form of stopping critera in the algorithm.</p>
<p>The second part transforms the output of the first part to a “path
graph” where each edge is marked with either a 1 or a 0 depending on if
it is used in a path between a starting node and a goal node. Altough
this recursion can be performed on a single machine for small examples,
this procedure is also implemented using the Pregel algorithm to handle
situations of millions of edges.</p>
<p>The input of the second part is the graph created in the first part as
well as the id of a single goal node and a start node. The goal node has
to be in the set of goal nodes used in the first part. This part outputs
a “path graph” where each edge is given the value 1 or 0 depending on if
it is on the shortest path or not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import scala.reflect.ClassTag
import org.apache.spark.graphx._

/**
 * Computes shortest weighted paths to the given set of goal nodes, returning a graph where each
 * vertex attribute is a map containing the shortest-path distance to each reachable landmark.
 * Currently supports only Graph of [VD, Double], where VD is an arbitrary vertex type.
 *
 * The object also include a function which transforms the resulting graph into a path_graph between a 
 * specific starting node and goal node. Each edge in the path_grpah is either 1 or 0 depending if it is 
 * the shortest path or not.
 *
 */
object ShortestPath extends Serializable {

  // When finding the shortest path each node stores a map from the itself to each goal node.
  // The map returns an array includeing the total distance to the goal node as well as the
  // next node pn the shortest path to the goal node. The last value in the array is only 
  // populated with the nodes own id and is only used for computational convenience. 
  type SPMap = Map[VertexId, Tuple3[Double, VertexId, VertexId]]
  
  // PN holds the information of the path nodes which are used for creating a path graph
  // PN = (&#39;Distance left to goal node&#39;, &#39;Next path node id&#39;, &#39;Goal node&#39;, &#39;Is on path&#39;)
  type PN = Tuple4[Double, VertexId, VertexId, Boolean] 
  
  private val INITIAL_DIST = 0.0
  private val DEFAULT_ID = -1L
  private val INFINITY = Int.MaxValue.toDouble

  private def makeMap(x: (VertexId, Tuple3[Double, VertexId, VertexId])*) = Map(x: _*)
  
  private def incrementMap(spmap: SPMap, delta: Double, id: VertexId): SPMap = { 
    spmap.map { case (v, d) =&gt; v -&gt; (Tuple3(d._1 + delta, d._3, id)) }
  }

  private def addMaps(spmap1: SPMap, spmap2: SPMap): SPMap = {
    (spmap1.keySet ++ spmap2.keySet).map {
    k =&gt;{
        if (spmap1.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._1 &lt; spmap2.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._1) 
                k -&gt; (Tuple3(spmap1.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._1, 
                             spmap1.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._2, 
                             spmap1.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._3))
        else 
                k -&gt; (Tuple3(spmap2.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._1, 
                             spmap2.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._2, 
                             spmap2.getOrElse(k, Tuple3(INFINITY, DEFAULT_ID, DEFAULT_ID))._3))
        }
    }.toMap
  }
  
  // at this point it does not really matter what vertex type is
  def run[VD](graph: Graph[VD, Double], landmarks: Seq[VertexId]): Graph[SPMap, Double] = {
    val spGraph = graph.mapVertices { (vid, attr) =&gt;
      // initial value for itself is 0.0 as Double
      if (landmarks.contains(vid)) makeMap(vid -&gt; Tuple3(INITIAL_DIST, DEFAULT_ID, DEFAULT_ID)) else makeMap()
    }

    val initMaps = makeMap()

    def vProg(id: VertexId, attr: SPMap, msg: SPMap): SPMap = {
      addMaps(attr, msg)
    }

    def sendMsg(edge: EdgeTriplet[SPMap, Double]): Iterator[(VertexId, SPMap)] = {
      val newAttr = incrementMap(edge.dstAttr, edge.attr, edge.srcId) // newAttr is the value 
      if (edge.srcAttr._1 &gt; addMaps(newAttr, edge.srcAttr)._1) Iterator((edge.srcId, newAttr))
      else Iterator.empty
    }

    Pregel(spGraph, initMaps)(vProg, sendMsg, addMaps)
  }
  
  def create_path_graph[VD](graph: Graph[SPMap, Double], goalId: VertexId, startId: VertexId): Graph[PN, Int] = {
    // For a given goal node we remove the lookup map and extend the state to a Tuple5 with the goal id and a boolean
    val path = graph.mapEdges(e =&gt; 0)
              .mapVertices((vertixId, attr) =&gt; {
                if (attr.contains(goalId)) {
                  val path_step = attr(goalId)
                  if (vertixId == path_step._3 &amp;&amp; path_step._2 == -1L)
                    (path_step._1, goalId, goalId, false) // while we are at it, we clean up the state a bit
                  else  
                    (path_step._1, path_step._2, goalId, false)
                } else// If the vertice does not have a map to our goal we add a default value to it
                    (INFINITY, -1L, -1L, false)
              })

      def mergeMsg(msg1: VertexId, msg2: VertexId): VertexId = { // we should only get one msg
          msg2
      }

      def vprog(id: VertexId, attr: PN, msg: VertexId): PN = {
        // Check that the current node is the one adressed in the message
        if (id == msg)
          (attr._1, attr._2, attr._3, true)
        else // If the message is not addressed to the current node (happens for inital message), use the old value 
          attr
      }
      def sendMsg(triplet: EdgeTriplet[PN, Int]): Iterator[(VertexId, VertexId)] = {
        // If dstId is the next node on the path and has not yet been activated
        if (triplet.srcAttr._2 == triplet.dstId &amp;&amp; triplet.srcAttr._4 &amp;&amp; !triplet.dstAttr._4) 
          Iterator((triplet.dstId, triplet.dstId))// Send next msg
        else
          Iterator.empty// Do nothing
      }

      Pregel(path, startId)(vprog, sendMsg, mergeMsg).mapTriplets(triplet =&gt; {
        if(triplet.srcAttr._2 == triplet.dstId &amp;&amp; triplet.srcAttr._4)
          1
        else
          0
      })
  }
}

println(&quot;Usage: val result = GraphXShortestWeightedPaths.run(graph, Seq(4L, 0L, 9L))&quot;)
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: val result = GraphXShortestWeightedPaths.run(graph, Seq(4L, 0L, 9L))
import scala.reflect.ClassTag
import org.apache.spark.graphx._
defined object ShortestPath
</pre></div>
</div>
</div></blockquote>
<p>To make the code somewhat more accesible, we wrap the execution of the
two parts above in a new function called <code class="docutils literal notranslate"><span class="pre">shortestPath</span></code>. This new
function takes the id of the start node and a single goal node as well
as the input graph as input. The function then ouputs the path graph
mentioned above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.util.Random</span>

<span class="k">def</span> <span class="nf">shortestPath</span><span class="p">(</span><span class="n">srcId</span> <span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">dstId</span> <span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">graph</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">Double</span><span class="p">],</span> <span class="n">placeholder</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">)</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">Double</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">placeholder</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">distanceGraph</span> <span class="o">=</span> <span class="n">ShortestPath</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">Seq</span><span class="p">(</span><span class="n">dstId</span><span class="p">))</span>
    <span class="n">val</span> <span class="n">pathGraph</span> <span class="o">=</span> <span class="n">ShortestPath</span><span class="o">.</span><span class="n">create_path_graph</span><span class="p">(</span><span class="n">distanceGraph</span><span class="p">,</span> <span class="n">dstId</span><span class="p">,</span> <span class="n">srcId</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pathGraph</span><span class="o">.</span><span class="n">mapVertices</span><span class="p">((</span><span class="n">vid</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="n">L</span><span class="p">)</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">shortestPath</span><span class="p">(</span><span class="n">srcId</span> <span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">dstId</span> <span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="n">graph</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">Double</span><span class="p">])</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">Double</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">shortestPath</span><span class="p">(</span><span class="n">srcId</span><span class="p">,</span> <span class="n">dstId</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">false</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import scala.util.Random
shortestPath: (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double], placeholder: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double])org.apache.spark.graphx.Graph[Long,Double]
shortestPath: (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double], placeholder: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (srcId: Long, dstId: Long, graph: org.apache.spark.graphx.Graph[Long,Double])org.apache.spark.graphx.Graph[Long,Double]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.reflect.ClassTag</span>

<span class="o">//</span> <span class="c1"># Merge edge attributes of two (identical in structure) graphs</span>
<span class="k">def</span> <span class="nf">mergeEdgeAttributes</span><span class="p">[</span><span class="n">ED1</span> <span class="p">:</span> <span class="n">ClassTag</span><span class="p">,</span> <span class="n">ED2</span> <span class="p">:</span> <span class="n">ClassTag</span><span class="p">](</span><span class="n">firstGraph</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">ED1</span><span class="p">],</span> <span class="n">secondGraph</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">ED2</span><span class="p">])</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="p">(</span><span class="n">ED1</span><span class="p">,</span> <span class="n">ED2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Graph</span><span class="p">(</span><span class="n">firstGraph</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">firstGraph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">innerJoin</span><span class="p">(</span><span class="n">secondGraph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="p">{(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)})</span> 
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import scala.reflect.ClassTag
mergeEdgeAttributes: [ED1, ED2](firstGraph: org.apache.spark.graphx.Graph[Long,ED1], secondGraph: org.apache.spark.graphx.Graph[Long,ED2])(implicit evidence$1: scala.reflect.ClassTag[ED1], implicit evidence$2: scala.reflect.ClassTag[ED2])org.apache.spark.graphx.Graph[Long,(ED1, ED2)]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Test</span> <span class="n">graph</span>
<span class="n">val</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">[</span><span class="n">Long</span><span class="p">,</span> <span class="n">Double</span><span class="p">]</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">fromEdges</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="mi">1</span> <span class="n">until</span> <span class="n">numVertices</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">vid</span> <span class="o">=&gt;</span> <span class="n">List</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">,</span> <span class="n">vid</span><span class="o">.</span><span class="n">toLong</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">Edge</span><span class="p">(</span><span class="n">vid</span><span class="o">.</span><span class="n">toLong</span><span class="p">,</span> <span class="n">numVertices</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))),</span> <span class="mi">0</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>graph: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@6c5928bd
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import scala.util.Random

def graphRandomGaussian(graph : Graph[Long, (Double, Double)], seed : Int, eps : Double, sparkSqlRandom : Boolean) : Graph[Long, Double] = {
  if (sparkSqlRandom) {
    return Graph(graph.vertices, graph.edges.toDF.select($&quot;srcId&quot;, $&quot;dstId&quot;, $&quot;attr._1&quot; + org.apache.spark.sql.functions.sqrt($&quot;attr._2&quot;) * org.apache.spark.sql.functions.randn(seed)).rdd.map(r =&gt; Edge(r.getLong(0), r.getLong(1), r.getDouble(2)))).mapEdges(e =&gt; scala.math.max(eps, e.attr))
  } else {
    return graph.mapEdges(e =&gt; scala.math.max(eps, e.attr._1 + Random.nextGaussian() * scala.math.sqrt(e.attr._2)))
  }
} 

def graphRandomGaussian(graph : Graph[Long, (Double, Double)], seed : Int, eps : Double) : Graph[Long, Double] = {
  return graphRandomGaussian(graph, seed, eps, true)
}
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import scala.util.Random
graphRandomGaussian: (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double, sparkSqlRandom: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double)org.apache.spark.graphx.Graph[Long,Double]
graphRandomGaussian: (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double, sparkSqlRandom: Boolean)org.apache.spark.graphx.Graph[Long,Double] &lt;and&gt; (graph: org.apache.spark.graphx.Graph[Long,(Double, Double)], seed: Int, eps: Double)org.apache.spark.graphx.Graph[Long,Double]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.math.sqrt</span>
<span class="kn">import</span> <span class="nn">scala.math.max</span>

<span class="n">println</span><span class="p">(</span><span class="s2">&quot;Starting experiment!&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>

<span class="n">val</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">val</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.00001</span>

<span class="o">//</span> <span class="c1"># Horizon N</span>
<span class="n">val</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">30</span>

<span class="o">//</span> <span class="c1"># Source and destination node IDs</span>
<span class="n">val</span> <span class="n">srcId</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span>
<span class="n">val</span> <span class="n">dstId</span> <span class="o">=</span> <span class="n">numVertices</span> <span class="o">-</span> <span class="mi">1</span><span class="n">L</span>

<span class="o">//</span> <span class="c1"># Assumption: Gaussian rewards with known variance</span>
<span class="o">//</span> <span class="c1"># Prior graph (map weight to prior mean and variance)</span>
<span class="o">//</span> <span class="n">TODO</span><span class="p">:</span> <span class="n">Prior</span> <span class="n">mean</span> <span class="kn">from</span> <span class="nn">real</span> <span class="n">graph</span>
<span class="n">val</span> <span class="n">priorMean</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">val</span> <span class="n">priorVar</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">val</span> <span class="n">prior</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">priorMean</span><span class="p">,</span> <span class="n">priorVar</span><span class="p">))</span>
<span class="n">var</span> <span class="n">posterior</span> <span class="o">=</span> <span class="n">prior</span>

<span class="o">//</span> <span class="c1"># Environment (sample true environment from prior)</span>
<span class="n">val</span> <span class="n">trueVar</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">val</span> <span class="n">env</span> <span class="o">=</span> <span class="n">graphRandomGaussian</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="n">trueVar</span><span class="p">))</span>

<span class="o">//</span> <span class="c1"># For regret calculations</span>
<span class="n">val</span> <span class="n">optimal</span> <span class="o">=</span> <span class="n">shortestPath</span><span class="p">(</span><span class="n">srcId</span><span class="p">,</span> <span class="n">dstId</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="p">))</span>
<span class="n">val</span> <span class="n">optimalExpectedCost</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">optimal</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="n">_</span><span class="p">)</span>
<span class="n">val</span> <span class="n">optimalPathEdges</span> <span class="o">=</span> <span class="n">optimal</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">srcId</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">dstId</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Optimal path edges: [</span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">optimalPathEdges</span><span class="o">.</span><span class="n">mkString</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

<span class="o">//</span> <span class="c1"># Array with instant regret values</span>
<span class="n">val</span> <span class="n">instantRegretValues</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Array</span><span class="p">[</span><span class="n">Double</span><span class="p">](</span><span class="n">N</span><span class="p">)</span>
<span class="n">var</span> <span class="n">lastAction</span> <span class="o">=</span> <span class="n">optimal</span>

<span class="o">//</span> <span class="c1"># Run experiment for N iterations</span>
<span class="k">for</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Iteration </span><span class="si">%d</span><span class="s2">, elapsed time: </span><span class="si">%d</span><span class="s2"> ms&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">)</span>
  
  <span class="o">//</span> <span class="c1"># Find action (super arm) using posterior sampling</span>
  <span class="n">val</span> <span class="n">sampledParameters</span> <span class="o">=</span> <span class="n">graphRandomGaussian</span><span class="p">(</span><span class="n">posterior</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">action</span> <span class="o">=</span> <span class="n">shortestPath</span><span class="p">(</span><span class="n">srcId</span><span class="p">,</span> <span class="n">dstId</span><span class="p">,</span> <span class="n">sampledParameters</span><span class="p">)</span>
  <span class="n">lastAction</span> <span class="o">=</span> <span class="n">action</span>
  
  <span class="o">//</span> <span class="c1"># Apply action on environments (assuming path is indicated by 1-valued edge attributes) and observe realized costs</span>
  <span class="n">val</span> <span class="n">realizedEnv</span> <span class="o">=</span> <span class="n">graphRandomGaussian</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">observation</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">realizedEnv</span><span class="p">)</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="p">)</span>
  
  <span class="o">//</span> <span class="c1"># Update posterior</span>
  <span class="n">posterior</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">posterior</span><span class="p">)</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">val</span> <span class="n">obs</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span>
    <span class="n">val</span> <span class="n">pMean</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span>
    <span class="n">val</span> <span class="n">pVar</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_2</span>
    <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">trueVar</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">pVar</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">obs</span><span class="o">/</span><span class="n">trueVar</span> <span class="o">+</span> <span class="n">pMean</span><span class="o">/</span><span class="n">pVar</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">trueVar</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">pVar</span><span class="p">)))</span>
  <span class="p">})</span>
  
  <span class="o">//</span> <span class="c1"># Calculate regret</span>
  <span class="o">//</span><span class="n">val</span> <span class="n">actionExpectedCost</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="n">_</span><span class="p">)</span>
  <span class="o">//</span><span class="n">val</span> <span class="n">instantRegret</span> <span class="o">=</span> <span class="n">actionExpectedCost</span> <span class="o">-</span> <span class="n">optimalExpectedCost</span>
  <span class="o">//</span><span class="n">instantRegretValues</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">=</span> <span class="n">instantRegret</span>
  <span class="o">//</span><span class="n">val</span> <span class="n">actionPathEdges</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">srcId</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">dstId</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
  <span class="o">//</span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;, instant regret: </span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">instantRegret</span><span class="p">)</span>
  <span class="o">//</span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;, action path edges: [</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">actionPathEdges</span><span class="o">.</span><span class="n">mkString</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">val</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Finished experiment! Elapsed time:</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Starting experiment!
Optimal path edges: [(0,4),(4,9)]
Iteration 0, elapsed time: 124927 ms
Iteration 1, elapsed time: 218948 ms
Iteration 2, elapsed time: 254865 ms
Iteration 3, elapsed time: 300192 ms
Iteration 4, elapsed time: 384399 ms
Iteration 5, elapsed time: 415356 ms
Iteration 6, elapsed time: 473626 ms
Iteration 7, elapsed time: 603751 ms
Iteration 8, elapsed time: 649864 ms
Iteration 9, elapsed time: 657970 ms
Iteration 10, elapsed time: 711303 ms
Iteration 11, elapsed time: 733911 ms
Iteration 12, elapsed time: 768825 ms
Iteration 13, elapsed time: 864619 ms
Iteration 14, elapsed time: 908692 ms
Iteration 15, elapsed time: 969860 ms
Iteration 16, elapsed time: 1034139 ms
Iteration 17, elapsed time: 1089197 ms
Iteration 18, elapsed time: 1184161 ms
Iteration 19, elapsed time: 1264011 ms
Iteration 20, elapsed time: 1334011 ms
Iteration 21, elapsed time: 1395009 ms
Iteration 22, elapsed time: 1493679 ms
Iteration 23, elapsed time: 1573276 ms
Iteration 24, elapsed time: 1634326 ms
Iteration 25, elapsed time: 1733819 ms
Iteration 26, elapsed time: 1820353 ms
Iteration 27, elapsed time: 1875346 ms
Iteration 28, elapsed time: 1948843 ms
Iteration 29, elapsed time: 2048672 ms
Finished experiment! Elapsed time:2119322
import scala.math.sqrt
import scala.math.max
startTime: Long = 1609958630541
seed: Int = 1000
eps: Double = 1.0E-5
N: Int = 30
srcId: Long = 0
dstId: Long = 9
priorMean: Double = 100.0
priorVar: Double = 10.0
prior: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@5e483f07
posterior: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@4a4132b1
trueVar: Double = 10.0
env: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@636784b2
optimal: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@77c0d44c
optimalExpectedCost: Double = 190.72770275035734
optimalPathEdges: Array[(org.apache.spark.graphx.VertexId, org.apache.spark.graphx.VertexId)] = Array((0,4), (4,9))
instantRegretValues: Array[Double] = Array(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
lastAction: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@138e7325
endTime: Long = 1609960749863
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scala.util.Random</span>
<span class="kn">import</span> <span class="nn">scala.math.sqrt</span>
<span class="kn">import</span> <span class="nn">scala.math.max</span>

<span class="n">println</span><span class="p">(</span><span class="s2">&quot;Starting experiment!&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">()</span>

<span class="n">val</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">val</span> <span class="n">rng</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">val</span> <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.00001</span>

<span class="o">//</span> <span class="c1"># Horizon N</span>
<span class="n">val</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">30</span>

<span class="o">//</span> <span class="c1"># Source and destination node IDs</span>
<span class="n">val</span> <span class="n">srcId</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span>
<span class="n">val</span> <span class="n">dstId</span> <span class="o">=</span> <span class="n">numVertices</span> <span class="o">-</span> <span class="mi">1</span><span class="n">L</span>

<span class="o">//</span> <span class="c1"># Assumption: Gaussian rewards with known variance</span>
<span class="o">//</span> <span class="c1"># Prior graph (map weight to prior mean and variance)</span>
<span class="o">//</span> <span class="n">TODO</span><span class="p">:</span> <span class="n">Prior</span> <span class="n">mean</span> <span class="kn">from</span> <span class="nn">real</span> <span class="n">graph</span>
<span class="n">val</span> <span class="n">priorMean</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">val</span> <span class="n">priorVar</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">val</span> <span class="n">prior</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">priorMean</span><span class="p">,</span> <span class="n">priorVar</span><span class="p">))</span>
<span class="n">var</span> <span class="n">posterior</span> <span class="o">=</span> <span class="n">prior</span>

<span class="o">//</span> <span class="c1"># Environment (sample true environment from prior)</span>
<span class="n">val</span> <span class="n">trueVar</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">val</span> <span class="n">env</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">nextGaussian</span><span class="p">()</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="p">)),</span> <span class="n">trueVar</span><span class="p">))</span>

<span class="o">//</span> <span class="c1"># For regret calculations</span>
<span class="n">val</span> <span class="n">optimal</span> <span class="o">=</span> <span class="n">shortestPath</span><span class="p">(</span><span class="n">srcId</span><span class="p">,</span> <span class="n">dstId</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span><span class="p">))</span>
<span class="n">val</span> <span class="n">optimalExpectedCost</span> <span class="o">=</span> <span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">optimal</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="p">)</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="n">_</span><span class="p">)</span>
<span class="n">val</span> <span class="n">optimalPathEdges</span> <span class="o">=</span> <span class="n">optimal</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">srcId</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">dstId</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Optimal path edges: [</span><span class="si">%s</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">optimalPathEdges</span><span class="o">.</span><span class="n">mkString</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

<span class="n">val</span> <span class="n">sampledParameters</span> <span class="o">=</span> <span class="n">posterior</span><span class="o">.</span><span class="n">mapEdges</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">nextGaussian</span><span class="p">()</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="p">)))</span>
<span class="n">val</span> <span class="n">action</span> <span class="o">=</span> <span class="n">shortestPath</span><span class="p">(</span><span class="n">srcId</span><span class="p">,</span> <span class="n">dstId</span><span class="p">,</span> <span class="n">sampledParameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Starting experiment!
Optimal path edges: [(0,5),(5,9)]
import scala.util.Random
import scala.math.sqrt
import scala.math.max
startTime: Long = 1609932752437
seed: Int = 1000
rng: scala.util.Random = scala.util.Random@55ffb303
eps: Double = 1.0E-5
N: Int = 30
srcId: Long = 0
dstId: Long = 9
priorMean: Double = 100.0
priorVar: Double = 10.0
prior: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@660b2c60
posterior: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@660b2c60
trueVar: Double = 10.0
env: org.apache.spark.graphx.Graph[Long,(Double, Double)] = org.apache.spark.graphx.impl.GraphImpl@15febbf8
optimal: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@2f6f564e
optimalExpectedCost: Double = 207.25786634313445
optimalPathEdges: Array[(org.apache.spark.graphx.VertexId, org.apache.spark.graphx.VertexId)] = Array((0,5), (5,9))
sampledParameters: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@258e9bf1
action: org.apache.spark.graphx.Graph[Long,Double] = org.apache.spark.graphx.impl.GraphImpl@6c700943
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">optimal</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">toDF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">toDF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">optimal</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">mergeEdgeAttributes</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">e</span> <span class="o">=&gt;</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_1</span> <span class="o">*</span> <span class="n">e</span><span class="o">.</span><span class="n">attr</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">_1</span><span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
</div>
<div class="section" id="graph-visualization">
<h1>Graph visualization<a class="headerlink" href="#graph-visualization" title="Permalink to this headline">¶</a></h1>
<p>what do we want to visualize??</p>
<p>shortest path for small algorithm???</p>
<p>But first, we need to initialize the d3 package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">d3</span>


<span class="o">//</span> <span class="n">We</span> <span class="n">use</span> <span class="n">a</span> <span class="n">package</span> <span class="nb">object</span> <span class="n">so</span> <span class="n">that</span> <span class="n">we</span> <span class="n">can</span> <span class="n">define</span> <span class="n">top</span> <span class="n">level</span> <span class="n">classes</span> <span class="n">like</span> <span class="n">Edge</span> <span class="n">that</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">other</span> <span class="n">cells</span>
<span class="o">//</span> <span class="n">This</span> <span class="n">was</span> <span class="n">modified</span> <span class="n">by</span> <span class="n">Ivan</span> <span class="n">Sadikov</span> <span class="n">to</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">compatible</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">databricks</span> <span class="n">notebook</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="kn">import</span> <span class="nn">com.databricks.backend.daemon.driver.EnhancedRDDFunctions.displayHTML</span>

<span class="n">case</span> <span class="k">class</span> <span class="nc">Edge</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="n">Long</span><span class="p">)</span>

<span class="n">case</span> <span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="n">case</span> <span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Long</span><span class="p">)</span>
<span class="n">case</span> <span class="k">class</span> <span class="nc">Graph</span><span class="p">(</span><span class="n">nodes</span><span class="p">:</span> <span class="n">Seq</span><span class="p">[</span><span class="n">Node</span><span class="p">],</span> <span class="n">links</span><span class="p">:</span> <span class="n">Seq</span><span class="p">[</span><span class="n">Link</span><span class="p">])</span>

<span class="nb">object</span> <span class="n">graphs</span> <span class="p">{</span>
<span class="o">//</span> <span class="n">val</span> <span class="n">sqlContext</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">SparkContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">())</span>  <span class="o">///</span> <span class="n">fix</span>
<span class="n">val</span> <span class="n">sqlContext</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="p">()</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span><span class="o">.</span><span class="n">sqlContext</span>
<span class="kn">import</span> <span class="nn">sqlContext.implicits._</span>
  
<span class="k">def</span> <span class="nf">force</span><span class="p">(</span><span class="n">clicks</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">[</span><span class="n">Edge</span><span class="p">],</span> <span class="n">height</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">960</span><span class="p">):</span> <span class="n">Unit</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">val</span> <span class="n">data</span> <span class="o">=</span> <span class="n">clicks</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
  <span class="n">val</span> <span class="n">nodes</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">src</span><span class="p">)</span> <span class="o">++</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">dest</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">replaceAll</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">))</span><span class="o">.</span><span class="n">toSet</span><span class="o">.</span><span class="n">toSeq</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span>
  <span class="n">val</span> <span class="n">links</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">t</span> <span class="o">=&gt;</span>
    <span class="n">Link</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">indexWhere</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">replaceAll</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)),</span> <span class="n">nodes</span><span class="o">.</span><span class="n">indexWhere</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">replaceAll</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)),</span> <span class="n">t</span><span class="o">.</span><span class="n">count</span> <span class="o">/</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">showGraph</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">Seq</span><span class="p">(</span><span class="n">Graph</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">links</span><span class="p">))</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">toJSON</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
<span class="p">}</span>

<span class="o">/**</span>
 <span class="o">*</span> <span class="n">Displays</span> <span class="n">a</span> <span class="n">force</span> <span class="n">directed</span> <span class="n">graph</span> <span class="n">using</span> <span class="n">d3</span>
 <span class="o">*</span> <span class="nb">input</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">}],</span> <span class="s2">&quot;links&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}</span>
 <span class="o">*/</span>
<span class="k">def</span> <span class="nf">showGraph</span><span class="p">(</span><span class="n">height</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Unit</span> <span class="o">=</span> <span class="p">{</span>

<span class="n">displayHTML</span><span class="p">(</span><span class="n">s</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;style&gt;</span>

<span class="s2">.node_circle {</span>
<span class="s2">  stroke: #777;</span>
<span class="s2">  stroke-width: 1.3px;</span>
<span class="s2">}</span>

<span class="s2">.node_label {</span>
<span class="s2">  pointer-events: none;</span>
<span class="s2">}</span>

<span class="s2">.link {</span>
<span class="s2">  stroke: #777;</span>
<span class="s2">  stroke-opacity: .2;</span>
<span class="s2">}</span>

<span class="s2">.node_count {</span>
<span class="s2">  stroke: #777;</span>
<span class="s2">  stroke-width: 1.0px;</span>
<span class="s2">  fill: #999;</span>
<span class="s2">}</span>

<span class="s2">text.legend {</span>
<span class="s2">  font-family: Verdana;</span>
<span class="s2">  font-size: 13px;</span>
<span class="s2">  fill: #000;</span>
<span class="s2">}</span>

<span class="s2">.node text {</span>
<span class="s2">  font-family: &quot;Helvetica Neue&quot;,&quot;Helvetica&quot;,&quot;Arial&quot;,sans-serif;</span>
<span class="s2">  font-size: 17px;</span>
<span class="s2">  font-weight: 200;</span>
<span class="s2">}</span>

<span class="s2">&lt;/style&gt;</span>

<span class="s2">&lt;div id=&quot;clicks-graph&quot;&gt;</span>
<span class="s2">&lt;script src=&quot;//d3js.org/d3.v3.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="s2">&lt;script&gt;</span>

<span class="s2">var graph = $graph;</span>

<span class="s2">var width = $width,</span>
<span class="s2">    height = $height;</span>

<span class="s2">var color = d3.scale.category20();</span>

<span class="s2">var force = d3.layout.force()</span>
<span class="s2">    .charge(-700)</span>
<span class="s2">    .linkDistance(180)</span>
<span class="s2">    .size([width, height]);</span>

<span class="s2">var svg = d3.select(&quot;#clicks-graph&quot;).append(&quot;svg&quot;)</span>
<span class="s2">    .attr(&quot;width&quot;, width)</span>
<span class="s2">    .attr(&quot;height&quot;, height);</span>
<span class="s2">    </span>
<span class="s2">force</span>
<span class="s2">    .nodes(graph.nodes)</span>
<span class="s2">    .links(graph.links)</span>
<span class="s2">    .start();</span>

<span class="s2">var link = svg.selectAll(&quot;.link&quot;)</span>
<span class="s2">    .data(graph.links)</span>
<span class="s2">    .enter().append(&quot;line&quot;)</span>
<span class="s2">    .attr(&quot;class&quot;, &quot;link&quot;)</span>
<span class="s2">    .style(&quot;stroke-width&quot;, function(d) { return Math.sqrt(d.value); });</span>

<span class="s2">var node = svg.selectAll(&quot;.node&quot;)</span>
<span class="s2">    .data(graph.nodes)</span>
<span class="s2">    .enter().append(&quot;g&quot;)</span>
<span class="s2">    .attr(&quot;class&quot;, &quot;node&quot;)</span>
<span class="s2">    .call(force.drag);</span>

<span class="s2">node.append(&quot;circle&quot;)</span>
<span class="s2">    .attr(&quot;r&quot;, 10)</span>
<span class="s2">    .style(&quot;fill&quot;, function (d) {</span>
<span class="s2">    if (d.name.startsWith(&quot;other&quot;)) { return color(1); } else { return color(2); };</span>
<span class="s2">})</span>

<span class="s2">node.append(&quot;text&quot;)</span>
<span class="s2">      .attr(&quot;dx&quot;, 10)</span>
<span class="s2">      .attr(&quot;dy&quot;, &quot;.35em&quot;)</span>
<span class="s2">      .text(function(d) { return d.name });</span>
<span class="s2">      </span>
<span class="s2">//Now we are giving the SVGs co-ordinates - the force layout is generating the co-ordinates which this code is using to update the attributes of the SVG elements</span>
<span class="s2">force.on(&quot;tick&quot;, function () {</span>
<span class="s2">    link.attr(&quot;x1&quot;, function (d) {</span>
<span class="s2">        return d.source.x;</span>
<span class="s2">    })</span>
<span class="s2">        .attr(&quot;y1&quot;, function (d) {</span>
<span class="s2">        return d.source.y;</span>
<span class="s2">    })</span>
<span class="s2">        .attr(&quot;x2&quot;, function (d) {</span>
<span class="s2">        return d.target.x;</span>
<span class="s2">    })</span>
<span class="s2">        .attr(&quot;y2&quot;, function (d) {</span>
<span class="s2">        return d.target.y;</span>
<span class="s2">    });</span>
<span class="s2">    d3.selectAll(&quot;circle&quot;).attr(&quot;cx&quot;, function (d) {</span>
<span class="s2">        return d.x;</span>
<span class="s2">    })</span>
<span class="s2">        .attr(&quot;cy&quot;, function (d) {</span>
<span class="s2">        return d.y;</span>
<span class="s2">    });</span>
<span class="s2">    d3.selectAll(&quot;text&quot;).attr(&quot;x&quot;, function (d) {</span>
<span class="s2">        return d.x;</span>
<span class="s2">    })</span>
<span class="s2">        .attr(&quot;y&quot;, function (d) {</span>
<span class="s2">        return d.y;</span>
<span class="s2">    });</span>
<span class="s2">});</span>
<span class="s2">&lt;/script&gt;</span>
<span class="s2">&lt;/div&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<span class="p">}</span>
  
  <span class="k">def</span> <span class="nf">help</span><span class="p">()</span> <span class="o">=</span> <span class="p">{</span>
<span class="n">displayHTML</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;p&gt;</span>
<span class="s2">Produces a force-directed graph given a collection of edges of the following form:&lt;/br&gt;</span>
<span class="s2">&lt;tt&gt;&lt;font color=&quot;#a71d5d&quot;&gt;case class&lt;/font&gt; &lt;font color=&quot;#795da3&quot;&gt;Edge&lt;/font&gt;(&lt;font color=&quot;#ed6a43&quot;&gt;src&lt;/font&gt;: &lt;font color=&quot;#a71d5d&quot;&gt;String&lt;/font&gt;, &lt;font color=&quot;#ed6a43&quot;&gt;dest&lt;/font&gt;: &lt;font color=&quot;#a71d5d&quot;&gt;String&lt;/font&gt;, &lt;font color=&quot;#ed6a43&quot;&gt;count&lt;/font&gt;: &lt;font color=&quot;#a71d5d&quot;&gt;Long&lt;/font&gt;)&lt;/tt&gt;</span>
<span class="s2">&lt;/p&gt;</span>
<span class="s2">&lt;p&gt;Usage:&lt;br/&gt;</span>
<span class="s2">&lt;tt&gt;&lt;font color=&quot;#a71d5d&quot;&gt;import&lt;/font&gt; &lt;font color=&quot;#ed6a43&quot;&gt;d3._&lt;/font&gt;&lt;/tt&gt;&lt;br/&gt;</span>
<span class="s2">&lt;tt&gt;&lt;font color=&quot;#795da3&quot;&gt;graphs.force&lt;/font&gt;(&lt;/br&gt;</span>
<span class="s2">&amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ed6a43&quot;&gt;height&lt;/font&gt; = &lt;font color=&quot;#795da3&quot;&gt;500&lt;/font&gt;,&lt;br/&gt;</span>
<span class="s2">&amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ed6a43&quot;&gt;width&lt;/font&gt; = &lt;font color=&quot;#795da3&quot;&gt;500&lt;/font&gt;,&lt;br/&gt;</span>
<span class="s2">&amp;nbsp;&amp;nbsp;&lt;font color=&quot;#ed6a43&quot;&gt;clicks&lt;/font&gt;: &lt;font color=&quot;#795da3&quot;&gt;Dataset&lt;/font&gt;[&lt;font color=&quot;#795da3&quot;&gt;Edge&lt;/font&gt;])&lt;/tt&gt;</span>
<span class="s2">&lt;/p&gt;&quot;&quot;&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Warning: classes defined within packages cannot be redefined without a cluster restart.
Compilation successful.
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import org.graphframes.GraphFrame
import d3._
import org.apache.spark.sql.functions.lit // import the lit function in sql
val priorShortestPath = GraphFrame.fromGraphX(graph.mapEdges(e =&gt; e.attr.toInt*10000))

d3.graphs.force(
  height = 500,
  width = 1000,
  clicks = priorShortestPath.edges.select($&quot;src&quot;, $&quot;dst&quot;.as(&quot;dest&quot;), $&quot;attr&quot;.as(&quot;count&quot;)).as[d3.Edge])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
val posteriorShortestPath = GraphFrame.fromGraphX(lastAction.mapEdges(e =&gt; e.attr.toInt*10000))

d3.graphs.force(
  height = 500,
  width = 1000,
  clicks = posteriorShortestPath.edges.select($&quot;src&quot;, $&quot;dst&quot;.as(&quot;dest&quot;), $&quot;attr&quot;.as(&quot;count&quot;)).as[d3.Edge])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>display(posteriorShortestPath.edges.select($&quot;src&quot;, $&quot;dst&quot;.as(&quot;dest&quot;), $&quot;attr&quot;.as(&quot;count&quot;)).as[d3.Edge])
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>We can also show the cumulative regret. As the algorithm reaches a final
solution, the instantaneous regret should decrease and the cumulative
regret should reach a plateau.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">cumulativeRegret</span> <span class="o">=</span> <span class="n">instantRegretValues</span><span class="o">.</span><span class="n">scanLeft</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)(</span><span class="n">_</span> <span class="o">+</span> <span class="n">_</span><span class="p">)</span>
<span class="n">val</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">parallelize</span><span class="p">((</span><span class="mi">1</span> <span class="n">to</span> <span class="n">N</span><span class="p">)</span> <span class="nb">zip</span> <span class="n">cumulativeRegret</span><span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="s2">&quot;Iteration (t)&quot;</span><span class="p">,</span><span class="s2">&quot;Cumulative regret&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// This is just to be able to debug the graph

import scala.util.Random
import scala.math.sqrt
import scala.math.max

println(&quot;Graph export!&quot;)

val eps = 0.00001

// # Assumption: Gaussian rewards with known variance
// # Prior graph (map weight to prior mean and variance)
// TODO: Prior mean from real graph
val priorMean = 100.0
val priorVar = 10.0
val prior = graph.mapEdges(e =&gt; (priorMean, priorVar))

// # Environment (sample true environment from prior)
val env = prior.mapEdges(e =&gt; (max(eps, e.attr._1 + Random.nextGaussian() * sqrt(e.attr._2)), 0.0))

// # Display DF
display(env.edges.toDF.select($&quot;srcId&quot;.as(&quot;nodeFrom&quot;), $&quot;dstId&quot;.as(&quot;nodeTo&quot;), $&quot;attr._1&quot;.as(&quot;Length&quot;), 
                              $&quot;attr._2&quot;.as(&quot;fromLat&quot;), $&quot;attr._2&quot;.as(&quot;fromLon&quot;),
                              $&quot;attr._2&quot;.as(&quot;toLat&quot;), $&quot;attr._2&quot;.as(&quot;toLon&quot;)))
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./000_0-sds-3-x-projects/student-project-14_group-NullHypothesisEvaluationCriteria"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By ScaDaMaLe Team<br/>
        
            &copy; Copyright 2020 Creative Commons Zero v1.0 Universal.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>