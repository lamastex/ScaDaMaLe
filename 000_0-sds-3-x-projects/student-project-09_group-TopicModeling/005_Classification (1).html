
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>&lt;no title&gt; &#8212; Scalable Data Science &amp; Distributed Machine Learning</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Scalable Data Science & Distributed Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/000_ScaDaMaLe.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark Core
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/001_whySpark.html">
   Why Apache Spark?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html">
   databricks community edition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#essentials-of-databricks-cloud-dbc-in-a-big-hurry">
   Essentials of Databricks Cloud (DBC) in a Big Hurry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-what-is-databricks-cloud">
   DBC Essentials: What is Databricks Cloud?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-shard-cluster-notebook-and-dashboard">
   DBC Essentials: Shard, Cluster, Notebook and Dashboard
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-team-state-collaboration-elastic-resources">
   DBC Essentials: Team, State, Collaboration, Elastic Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#you-should-all-have-databricks-community-edition-account-by-now">
   You Should All Have databricks community edition account by now!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#import-course-content-now">
   Import Course Content Now!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#cloud-free-computing-environment-optional-but-recommended">
   Cloud-free Computing Environment (Optional but recommended)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html">
   Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html#further-reference-homework-recurrrent-points-of-reference">
   Further Reference / Homework / Recurrrent Points of Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html">
   Introduction to Scala through Scala Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-in-your-own-computer">
   Scala in your own computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-resources">
   Scala Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#introduction-to-scala">
   Introduction to Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#let-s-get-our-hands-dirty-in-scala">
   Let’s get our hands dirty in Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-types">
   Scala Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#expressions">
   Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#blocks">
   Blocks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#functions">
   Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#methods">
   Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#classes">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#case-classes">
   Case Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#objects">
   Objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#traits">
   Traits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#main-method">
   Main Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#what-i-try-not-do-while-learning-a-new-language">
   What I try not do while learning a new language?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html">
   Scala Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#let-s-continue-to-get-our-hands-dirty-in-scala">
   Let’s continue to get our hands dirty in Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#scala-type-hierarchy">
   Scala Type Hierarchy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#scala-collections">
   Scala Collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#exercise-in-functional-programming">
   Exercise in Functional Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#lazy-evaluation">
   Lazy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#recursions">
   Recursions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html">
   Introduction to Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html#spark-cluster-overview">
   Spark Cluster Overview:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/005_RDDsTransformationsActionsHOMEWORK.html">
   HOMEWORK notebook - RDDs Transformations and Actions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html">
   Piped RDDs and Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#from-a-local-collection">
   From a Local Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#glom">
   glom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#checkpointing">
   Checkpointing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#pipe-rdds-to-system-commands">
   Pipe RDDs to System Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#mappartitions">
   mapPartitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#foreachpartition">
   foreachPartition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#numerically-rigorous-bayesian-ab-testing">
   Numerically Rigorous Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#usage-instructions-for-isit1or2coins">
   Usage instructions for IsIt1or2Coins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006_WordCount.html">
   Word Count on US State of the Union (SoU) Addresses
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark SQL
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html">
   Introduction to Spark SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#overview">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#datasets-and-dataframes">
   Datasets and DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#getting-started-in-spark-2-x">
   Getting Started in Spark 2.x
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007a_SparkSQLProgGuide_HW.html">
   Spark Sql Programming Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html#id1">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007c_SparkSQLProgGuide_HW.html">
   Getting Started - Exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html">
   Data Sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html#id1">
   Data Sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007e_SparkSQLProgGuide_HW.html">
   Performance Tuning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html">
   Distributed SQL Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html#id1">
   Distributed SQL Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html">
   ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#sql-pivoting-since-spark-2-4">
   SQL Pivoting since Spark 2.4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#load-data">
   Load Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-in-sql">
   Pivoting in SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-aggregate-expressions">
   Pivoting with Multiple Aggregate Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-grouping-columns">
   Pivoting with Multiple Grouping Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-pivot-columns">
   Pivoting with Multiple Pivot Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html">
   Diamonds ML Pipeline Workflow - DataFrame ETL and EDA Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-1-load-data-as-dataframe">
   Step 1. Load data as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-2-understand-the-data">
   Step 2. Understand the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#let-us-run-through-some-basic-inteactive-sql-queries-next">
   Let us run through some basic inteactive SQL queries next
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#why-do-we-need-to-know-these-interactive-sql-queries">
   Why do we need to know these interactive SQL queries?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset">
   We will continue later with ML pipelines to do prediction with a fitted model from this dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html">
   Power Plant ML Pipeline Application - DataFrame Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-1-business-understanding">
   Step 1: Business Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-2-load-your-data">
   Step 2: Load Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce">
   USE THIS FOR OTHER SMALLish DataSets you want to import to your CE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-3-explore-your-data">
   Step 3: Explore Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-4-visualize-your-data">
   Step 4: Visualize Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html">
   Wiki Clickstream Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html#wikipedia-logo">
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html">
   Old Bailey Online Data Analysis in Apache Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html#analysing-the-full-old-bailey-online-sessions-papers-dataset">
   Analysing the Full Old Bailey Online Sessions Papers Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html">
   Piped RDDs and Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#from-a-local-collection">
   From a Local Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#glom">
   glom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#checkpointing">
   Checkpointing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#pipe-rdds-to-system-commands">
   Pipe RDDs to System Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#mappartitions">
   mapPartitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#foreachpartition">
   foreachPartition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#numerically-rigorous-bayesian-ab-testing">
   Numerically Rigorous Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#usage-instructions-for-isit1or2coins">
   Usage instructions for IsIt1or2Coins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#parsing-the-output-from-isit1or2coins">
   Parsing the output from
   <code class="docutils literal notranslate">
    <span class="pre">
     IsIt1or2Coins
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#providing-case-classes-for-input-and-output-for-easy-spark-communication">
   Providing case classes for input and output for easy spark communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Distribute Deep Learning with Horovod
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/00_DDL_Introduction.html">
   Introduction to Distributed Deep Learning (DDL) with Horovod over Tensorflow/keras and Pytorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/0x_mnist-tensorflow-keras.html">
   Distributed deep learning training using TensorFlow and Keras with HorovodRunner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/0y_mnist-pytorch.html">
   Distributed deep learning training using PyTorch with HorovodRunner for MNIST
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  WASP AI-Track Student Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Voluntary Student Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html">
   Plugging into GDELT Streams - TODO - IN PROGRESS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html#this-is-just-dipping-our-pinky-toe-in-this-ocean-of-information">
   This is just dipping our pinky toe in this ocean of information!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html#download-from-gdelt-project">
   Download from gdelt-project
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/000_0-sds-3-x-projects/student-project-09_group-TopicModeling/005_Classification (1).ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html/issues/new?title=Issue%20on%20page%20%2F000_0-sds-3-x-projects/student-project-09_group-TopicModeling/005_Classification (1).html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="simple nav section-nav flex-column">
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Load</span> <span class="n">LDA</span> <span class="n">model</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">topic</span> <span class="n">distributions</span>
<span class="o">//</span> <span class="n">data</span> <span class="nb">format</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="p">[</span><span class="n">genome</span><span class="p">:</span><span class="n">string</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span><span class="n">string</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span><span class="n">long</span><span class="p">]</span>
<span class="n">val</span> <span class="n">k_mers_df_train</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;dbfs:/FileStore/shared_uploads/caylak@kth.se/data_train&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">k_mers_df_test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;dbfs:/FileStore/shared_uploads/caylak@kth.se/data_test&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">data</span> <span class="nb">format</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="p">[</span><span class="n">_1</span><span class="p">:</span> <span class="n">bigint</span><span class="p">,</span> <span class="n">_2</span><span class="p">:</span> <span class="n">vector</span><span class="p">]</span> <span class="n">the</span> <span class="n">vector</span> <span class="n">part</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">topic</span> <span class="n">distributions</span>
<span class="n">val</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;dbfs:/FileStore/shared_uploads/caylak@kth.se/topic_dist_train_tmp&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;dbfs:/FileStore/shared_uploads/caylak@kth.se/topic_dist_test_tmp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>k_mers_df_train: org.apache.spark.sql.DataFrame = [genome: string, label: string ... 1 more field]
k_mers_df_test: org.apache.spark.sql.DataFrame = [genome: string, label: string ... 1 more field]
trainingData: org.apache.spark.sql.DataFrame = [_1: bigint, _2: vector]
testData: org.apache.spark.sql.DataFrame = [_1: bigint, _2: vector]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">testData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;dbfs:/FileStore/shared_uploads/caylak@kth.se/topic_dist_test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">FloatType</span>

<span class="n">firstelement</span><span class="o">=</span><span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">FloatType</span><span class="p">())</span>
<span class="n">testData</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">firstelement</span><span class="p">(</span><span class="s1">&#39;_2&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+------------+
|&lt;lambda&gt;(_2)|
+------------+
| 0.098783955|
|  0.09921763|
|  0.09954901|
|  0.09979748|
|  0.09992802|
|  0.09876957|
|  0.10090187|
|  0.10046894|
|  0.10041641|
| 0.099867895|
|  0.10105545|
| 0.099601574|
|  0.09951745|
|  0.10045864|
|  0.09878429|
|   0.0993379|
|  0.10007749|
|  0.10007781|
|  0.09985662|
|   0.1001038|
+------------+
only showing top 20 rows
</pre></div>
</div>
</div></blockquote>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Out[10]: [&#39;&lt;lambda&gt;(_2)&#39;, &#39;&lt;lambda&gt;(_2)&#39;]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.sql.functions._

val arr_max_df = testData.withColumn(&quot;res&quot;, array_max($&quot;_2&quot;))

arr_max_df.show()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">distributions</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>distributions: org.apache.spark.sql.DataFrame = [_2: vector]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">distributions</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>res32: Array[org.apache.spark.sql.Row] = Array([[0.05001287366843784,0.05004600876940525,0.050043300861893174,0.04992445087522449,0.04989027618089037,0.0500213285700815,0.05005898629025325,0.0500518176957626,0.04995232036626174,0.04996466954347265,0.05000450002616852,0.05005636999453604,0.0498470722831295,0.04999132401442033,0.05009426160660837,0.05002498350257868,0.050055494608950715,0.050033006254048176,0.049980093570543414,0.04994686131733314]], [[0.05000556922630469,0.04998299320674995,0.05002190677050916,0.049946103798623666,0.04998885712435416,0.05000591536603424,0.04998201383805509,0.05005154038644628,0.049983023596915956,0.04996312585886514,0.050039226046401285,0.04998483635376038,0.04999263141902274,0.04997888258713219,0.05004847996288107,0.05000765092103313,0.050029108630356776,0.05003844761283082,0.050003191541797484,0.04994649575192555]])
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">rdd2</span> <span class="o">=</span> <span class="n">distributions</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span> <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>rdd2: org.apache.spark.rdd.RDD[Any] = MapPartitionsRDD[379742] at map at command-2294440354339455:1
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rdd2</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>res49: Array[Any] = Array([0.05001287366843784,0.05004600876940525,0.050043300861893174,0.04992445087522449,0.04989027618089037,0.0500213285700815,0.05005898629025325,0.0500518176957626,0.04995232036626174,0.04996466954347265,0.05000450002616852,0.05005636999453604,0.0498470722831295,0.04999132401442033,0.05009426160660837,0.05002498350257868,0.050055494608950715,0.050033006254048176,0.049980093570543414,0.04994686131733314])
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">newrdd2</span> <span class="o">=</span> <span class="n">newrdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">row</span> <span class="o">=&gt;</span> <span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">dfWithSchema</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">newrdd</span><span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.autoBroadcastJoinThreshold&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">val</span> <span class="n">mergedTrainingData</span> <span class="o">=</span> <span class="n">trainingData</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k_mers_df_train</span><span class="p">,</span><span class="n">trainingData</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="n">k_mers_df_train</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mergedTrainingData: org.apache.spark.sql.DataFrame = [_1: bigint, _2: vector ... 3 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">mergedTestData</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k_mers_df_test</span><span class="p">,</span><span class="n">testData</span><span class="p">(</span><span class="s2">&quot;_1&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="n">k_mers_df_test</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mergedTestData: org.apache.spark.sql.DataFrame = [_1: bigint, _2: vector ... 3 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mergedTrainingData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+-----+--------------------+--------------------+------------+-----+
|   _1|                  _2|              genome|       label|   id|
+-----+--------------------+--------------------+------------+-----+
|23928|[0.05218793826923...|ACT CTT TTT TTC T...|northamerica|23928|
|23984|[0.05205842680397...|AGA GAT ATC TCT C...|northamerica|23984|
|23929|[0.04985890751686...|TAT ATA TAC ACC C...|northamerica|23929|
|25242|[0.04823768833064...|TTT TTA TAT ATA T...|northamerica|25242|
|23229|[0.05293353532457...|AAG AGG GGT GTT T...|northamerica|23229|
+-----+--------------------+--------------------+------------+-----+
only showing top 5 rows
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mergedTestData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+----+--------------------+--------------------+-------+----+
|  _1|                  _2|              genome|  label|  id|
+----+--------------------+--------------------+-------+----+
|1277|[0.04996298840239...|ACT CTT TTT TTC T...|oceania|1277|
|1224|[0.05000807149599...|ACT CTT TTT TTC T...|oceania|1224|
|2173|[0.04997859238978...|AGA GAT ATC TCT C...|oceania|2173|
| 541|[0.05000547376345...|CTC TCT CTT TTG T...|oceania| 541|
|1371|[0.04997786268672...|AGA GAT ATC TCT C...|oceania|1371|
+----+--------------------+--------------------+-------+----+
only showing top 5 rows
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mergedTrainingData</span><span class="o">.</span><span class="n">schema</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>res34: org.apache.spark.sql.types.StructType = StructType(StructField(_1,LongType,true), StructField(_2,org.apache.spark.ml.linalg.VectorUDT@3bfc3ba7,true), StructField(genome,StringType,true), StructField(label,StringType,true), StructField(id,LongType,true))
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.sql.DataFrame</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.sql.functions.lit</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.math3.distribution.NormalDistribution</span>
<span class="n">val</span> <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">r</span> <span class="o">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Random</span>
<span class="k">def</span> <span class="nf">getOrigin</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">Integer</span><span class="p">):</span> <span class="n">String</span><span class="o">=</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">30</span><span class="p">)</span>
    <span class="s2">&quot;Africa&quot;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">60</span><span class="p">)</span>
    <span class="s2">&quot;Europe&quot;</span>
  <span class="k">else</span>
    <span class="s2">&quot;Asia&quot;</span>
<span class="k">def</span> <span class="nf">getDataPoint</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">Integer</span><span class="p">):</span> <span class="n">Double</span><span class="o">=</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">N_africa</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">N_europe</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
  <span class="k">else</span>
    <span class="n">N_asia</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="n">var</span> <span class="n">N_europe</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NormalDistribution</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">var</span> <span class="n">N_africa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NormalDistribution</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mf">1.4</span><span class="p">)</span>
<span class="n">var</span> <span class="n">N_asia</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NormalDistribution</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">addColumnsFast</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">):</span> <span class="n">DataFrame</span> <span class="o">=</span> 
  <span class="n">df</span><span class="o">.</span><span class="n">collect</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">id</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">getOrigin</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">getDataPoint</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">getDataPoint</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">getDataPoint</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">toSeq</span>
    <span class="o">.</span><span class="n">toDF</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;topic_1&quot;</span><span class="p">,</span> <span class="s2">&quot;topic_2&quot;</span><span class="p">,</span> <span class="s2">&quot;topic_3&quot;</span><span class="p">)</span>

<span class="n">val</span> <span class="n">trainingData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">addColumnsFast</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">val</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="n">addColumnsFast</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>

<span class="n">trainingData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Time taken: 194 ms
Time taken: 35 ms
+---+------+------------------+-------------------+--------------------+
| id|origin|           topic_1|            topic_2|             topic_3|
+---+------+------------------+-------------------+--------------------+
|  1|Africa|  5.83777351706712|  7.349972418703414|    6.61662824819416|
|  2|Africa|3.8250718188086923|  5.490187621881647|  5.4796719306461785|
|  3|Africa|2.5107844489290225|  6.828411793489071|   5.894964244062407|
|  4|Africa| 6.751902343774979|  4.715773920336069|   7.950798899603711|
|  5|Africa| 5.692182024875181|   5.20516485677467|   6.837812012019507|
|  6|Africa| 7.265373268814024|  4.739860849217642|   5.888776980715231|
|  7|Africa|3.2850499171125715|  3.014172252632103|    5.64065807813007|
|  8|Africa| 6.289192325974664| 3.3346245847805545|  3.8549160253296026|
|  9|Africa|3.9449624992374934|  4.484524428773987|   3.786898223532835|
| 10|Africa| 4.364116740242096|  3.690682100477985|  5.4829577857011405|
| 11|Africa| 4.813145577970281|  7.756058246580167|  6.6158807415724965|
| 12|Africa| 4.536488015296846|  6.424314602996467|   3.825316489493102|
| 13|Africa| 5.964501998245242|  4.820438789517563|   6.868016673462996|
| 14|Africa| 6.988218263075146|  4.653409852364857|   5.247630003939556|
| 15|Africa| 4.653698814595546|  4.186782294338912|   6.909289414004915|
| 16|Africa| 5.825824728701091| 3.0548104869529946|   5.872787584632095|
| 17|Africa| 4.939239964751502|  5.230089812481755|  3.9101615563744705|
| 18|Africa|1.9640490923201424|  5.168073776140124|   4.138227945475363|
| 19|Africa| 4.054670753427284|  2.856642136219815|   5.874860411326041|
| 20|Africa| 7.427811837585756|  5.369465921406486|   4.065292189654439|
| 21|Africa| 5.351519156116671|  4.265413371012905|  4.8196777162346995|
| 22|Africa|  5.68337982212939|  4.978513534123361|  4.5180667594279305|
| 23|Africa|  4.86762722276645|  5.347125964902536|   6.789134685312184|
| 24|Africa| 6.712483795813862| 3.6900901582457797|  2.6733882833398286|
| 25|Africa| 7.344675173796055| 5.3952987109613035|  3.1632583699352876|
| 26|Africa| 4.891463234521708|  2.160898022587189|   4.475577304199971|
| 27|Africa| 4.293130640883305|  5.834199502347502|   5.604766756858305|
| 28|Africa| 4.211578216587954| 6.8883573685968535|   6.016204384390766|
| 29|Africa| 4.611266293274312|  2.933689690450092|   6.651992065621831|
| 30|Europe|3.6765421989349236|  0.047400654266885|  2.9576451982000074|
| 31|Europe| 2.416951074650528| 1.3220845785226472|  2.3396005595411298|
| 32|Europe| 2.201490607308248|  0.695096897340256|  1.4408358991459065|
| 33|Europe|2.3671635683815295|  2.682452493450806|  2.9694741564901554|
| 34|Europe|1.1607307907197708| 2.2360910479955383|  1.8178768646384096|
| 35|Europe| 4.124052516653103|  2.320631725771898|  1.9865335821403907|
| 36|Europe|1.5767322333590605| 0.7533220749391005|   3.078069411084817|
| 37|Europe|1.6775914480249743|  1.357685719118919|  1.0238736198349492|
| 38|Europe| 2.968322357947945|0.21344363600260619|   1.213341252313659|
| 39|Europe|3.0165643895827525|   2.83941816961008|  2.9741923335713953|
| 40|Europe|1.3985790794418587|  1.786013227033429|  1.5429846540186456|
| 41|Europe|3.5622642751626485|  0.602510059206437|  1.9348215936397626|
| 42|Europe|1.2053686905376357| 0.6339377129326846|  2.8290277797507253|
| 43|Europe|1.5429704074969042| 1.5700372599142745|  2.3973029177901743|
| 44|Europe| 1.910235818695376| 1.6703630093901827|  2.7797409480956157|
| 45|Europe|1.6176530012553825|0.21168023068729847|   3.213303582037832|
| 46|Europe|2.4285004335338134| 2.3687665678543834|  1.9420943878859402|
| 47|Europe|2.5324870177742627|   0.52570967355585|   3.423828210873946|
| 48|Europe|1.6807051055494195|  2.364873205423158|  1.0938481909831572|
| 49|Europe|2.3049433801696217| 0.2235146227952669| 0.43357789441195305|
| 50|Europe|0.7543157135804881| 2.0488389767202357|   2.451455697677579|
| 51|Europe|0.5307467873488603| 1.9130170826729473|  2.2714855741476407|
| 52|Europe| 1.388182975823657| 1.5561333752841193|  0.5924275326329973|
| 53|Europe|2.7634338300066323| 3.0960295334308454|  1.6700608572975373|
| 54|Europe| 2.228664910039027| 2.0918095484206534|  0.6618346203945285|
| 55|Europe|1.6494949542467023|  1.473678414242738|   0.885325678754296|
| 56|Europe| 2.797190121751861| 1.1059593492790611|  1.5053048522744459|
| 57|Europe| 2.276406175609889|  2.039036200165476|  0.6482979152368846|
| 58|Europe|1.6170360969668491|  2.912947294400106|  2.2622734905098056|
| 59|Europe|1.9364597680052982| 1.2199270314988566|  1.2293603488526104|
| 60|  Asia| 2.100694406775541| 3.2357305267561407|  1.5761706866669734|
| 61|  Asia|3.6436191398681634| 2.3691180995941252|  1.4497029445650973|
| 62|  Asia|2.6666319929300886|  3.161281243954478|   1.356311476983467|
| 63|  Asia| 2.096001393204647|  3.546849940498507|   3.615347257928505|
| 64|  Asia| 4.039923533013969|  4.156196310620002|   4.381407357168491|
| 65|  Asia|2.4862729998062307|  4.980694561767325|  1.7882130273496375|
| 66|  Asia|2.9275997834057645|  5.362816911431885|   5.105952017378549|
| 67|  Asia|2.5910943376441367|  4.424325092682374|  1.7032775980219752|
| 68|  Asia|3.5627531193489035| 2.9632093769613475|  2.1960928954935843|
| 69|  Asia| 4.638136444327561|  6.451716796550906|  3.4187665111355834|
| 70|  Asia| 3.174904699322712|  3.791198322755484|  3.0874968772616866|
| 71|  Asia|5.5625890094793995|   3.85918227830529|  3.4332912369748234|
| 72|  Asia| 2.495982365362969|  3.600982311779159|   1.225450436176291|
| 73|  Asia| 2.400928237358435|  4.339591100509332|  1.7292640470886578|
| 74|  Asia| 5.762572033481824|  3.861618665894919|  3.5389407588227852|
| 75|  Asia| 3.608324898675809| 3.1463801139674104|    2.17813021024272|
| 76|  Asia| 2.697825160536849| 1.8921159505446388|   3.429076483513044|
| 77|  Asia| 1.989344142250111|  2.383345405429783|   3.660972954683634|
| 78|  Asia|1.8819773388968666|  3.646687551781822|  3.3714467236813963|
| 79|  Asia|1.7199852927205914| 3.7427485102883393|  1.1839995184491048|
| 80|  Asia|2.3325172432677386| 1.5509649044295162|   2.483960254872863|
| 81|  Asia|3.3178777405281172|  3.070174219400296|  1.8349741020499355|
| 82|  Asia| 4.685885582688538|  4.131419760151927|-0.25254693493518987|
| 83|  Asia|3.5806278179087276|  4.536322396781238|  3.9661610988067504|
| 84|  Asia| 1.685117816669878|  2.549558489607437|   4.623681261529001|
| 85|  Asia| 2.093590641756718|  4.099444775426073|   4.170650095388005|
| 86|  Asia|3.0123432402286854| 2.0718636762399982|    4.01309264342162|
| 87|  Asia|2.2605922481954748| 3.9550444852898767|  5.0687251737079055|
| 88|  Asia| 5.058112895555484| 3.6713441491594643|   3.607109905434706|
| 89|  Asia| 3.890010212009255| 2.9569226909295354|  3.8427319732049328|
| 90|  Asia|3.0231126938205026|  2.701198685566287|   5.446538264629089|
| 91|  Asia| 5.373768022471379| 1.1922653859598078|   4.407538871612573|
| 92|  Asia|1.8858250093006175| 0.9939061947899153|  0.9180504458099601|
| 93|  Asia|3.1985803797840915| 1.5002982049961184|   4.342711401747792|
| 94|  Asia| 4.159178108670287|  3.852581864912148|  1.6810221154876552|
| 95|  Asia| 3.083661944024938| 2.7968914458511276|  3.6884215223827694|
| 96|  Asia|2.6662339847085303| 1.2744828334224234|  1.0726756282830427|
| 97|  Asia|3.3530453490384606| 2.4811202398347265|  2.1610394572609986|
| 98|  Asia|2.3440317406475315| 0.5835564496356631|   4.290184707069996|
| 99|  Asia|2.9888131321615137| 3.1658196106744976|  3.2779254504841533|
|100|  Asia|2.1362574299539587|  4.915812532649392|   4.483981458232519|
+---+------+------------------+-------------------+--------------------+

import org.apache.spark.sql.DataFrame
import org.apache.spark.sql.functions.lit
import org.apache.commons.math3.distribution.NormalDistribution
df: org.apache.spark.sql.DataFrame = [id: int]
r: util.Random.type = scala.util.Random$@1172c043
getOrigin: (i: Integer)String
getDataPoint: (i: Integer)Double
N_europe: org.apache.commons.math3.distribution.NormalDistribution = org.apache.commons.math3.distribution.NormalDistribution@6d8dbd8d
N_africa: org.apache.commons.math3.distribution.NormalDistribution = org.apache.commons.math3.distribution.NormalDistribution@2a240078
N_asia: org.apache.commons.math3.distribution.NormalDistribution = org.apache.commons.math3.distribution.NormalDistribution@3648d171
addColumnsFast: (df: org.apache.spark.sql.DataFrame)org.apache.spark.sql.DataFrame
trainingData: org.apache.spark.sql.DataFrame = [id: int, origin: string ... 3 more fields]
testData: org.apache.spark.sql.DataFrame = [id: int, origin: string ... 3 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Scatter</span> <span class="n">plots</span><span class="o">.</span>  <span class="n">Hopefully</span> <span class="n">showing</span> <span class="n">some</span> <span class="n">clustering</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">origin</span>
<span class="n">display</span><span class="p">(</span><span class="n">trainingData</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">false</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">mergedTrainingData</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">schema</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>res31: org.apache.spark.sql.types.StructType = StructType(StructField(_2,org.apache.spark.mllib.linalg.VectorUDT@f71b0bce,true))
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">mergedTrainingData</span><span class="o">.</span><span class="n">schema</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>res35: org.apache.spark.sql.types.StructType = StructType(StructField(_1,LongType,true), StructField(_2,org.apache.spark.ml.linalg.VectorUDT@3bfc3ba7,true), StructField(genome,StringType,true), StructField(label,StringType,true), StructField(id,LongType,true))
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="p">{</span><span class="n">StringIndexer</span><span class="p">,</span><span class="n">VectorAssembler</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.LabeledPoint</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.RandomForestClassifier</span>

<span class="n">val</span> <span class="n">transformers</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span>
              <span class="n">new</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">),</span>
              <span class="n">new</span> <span class="n">VectorAssembler</span><span class="p">()</span>
                     <span class="o">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span><span class="s2">&quot;topic_1&quot;</span><span class="p">,</span><span class="s2">&quot;topic_2&quot;</span><span class="p">,</span><span class="s2">&quot;topic_3&quot;</span><span class="p">))</span>
                      <span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">))</span>
<span class="n">val</span> <span class="n">assembler</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VectorAssembler</span><span class="p">()</span>
    <span class="o">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="o">//</span> <span class="n">Train</span> <span class="n">a</span> <span class="n">RandomForest</span> <span class="n">model</span><span class="o">.</span>
<span class="n">val</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RandomForestClassifier</span><span class="p">()</span> 
              <span class="o">.</span><span class="n">setLabelCol</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setFeaturesCol</span><span class="p">(</span><span class="s2">&quot;_2&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setNumTrees</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setFeatureSubsetStrategy</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setImpurity</span><span class="p">(</span><span class="s2">&quot;gini&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setMaxDepth</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setMaxBins</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setSeed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">val</span> <span class="n">tm</span> <span class="o">=</span> <span class="n">assembler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">mergedTrainingData</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.ml.feature.{StringIndexer, VectorAssembler}
import org.apache.spark.ml.Pipeline
import org.apache.spark.ml.feature.LabeledPoint
import org.apache.spark.ml.classification.RandomForestClassifier
transformers: Array[org.apache.spark.ml.PipelineStage with org.apache.spark.ml.param.shared.HasOutputCol with org.apache.spark.ml.param.shared.HasHandleInvalid with org.apache.spark.ml.util.DefaultParamsWritable{def copy(extra: org.apache.spark.ml.param.ParamMap): org.apache.spark.ml.PipelineStage with org.apache.spark.ml.param.shared.HasOutputCol with org.apache.spark.ml.param.shared.HasHandleInvalid with org.apache.spark.ml.util.DefaultParamsWritable{def copy(extra: org.apache.spark.ml.param.ParamMap): org.apache.spark.ml.PipelineStage with org.apache.spark.ml.param.shared.HasOutputCol with org.apache.spark.ml.param.shared.HasHandleInvalid with org.apache.spark.ml.util.DefaultParamsWritable}}] = Array(strIdx_424e7f582456, vecAssembler_4f7577042a3a)
assembler: org.apache.spark.ml.feature.VectorAssembler = vecAssembler_7d650978c852
rf: org.apache.spark.ml.classification.RandomForestClassifier = rfc_0a1b095916bc
tm: org.apache.spark.sql.DataFrame = [_1: bigint, _2: vector ... 4 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.</span><span class="p">{</span><span class="n">StringIndexer</span><span class="p">,</span><span class="n">VectorAssembler</span><span class="p">}</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.Pipeline</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.feature.LabeledPoint</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.classification.RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">org.apache.spark.ml.linalg.Vector</span>

<span class="n">val</span> <span class="n">transformers</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span>
              <span class="n">new</span> <span class="n">StringIndexer</span><span class="p">()</span><span class="o">.</span><span class="n">setInputCol</span><span class="p">(</span><span class="s2">&quot;origin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">),</span>
             <span class="o">//</span> <span class="n">new</span> <span class="n">VectorAssembler</span><span class="p">()</span>
             <span class="o">//</span>        <span class="o">.</span><span class="n">setInputCols</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span><span class="s2">&quot;topic_1&quot;</span><span class="p">,</span><span class="s2">&quot;topic_2&quot;</span><span class="p">,</span><span class="s2">&quot;topic_3&quot;</span><span class="p">))</span>
             <span class="o">//</span>         <span class="o">.</span><span class="n">setOutputCol</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">))</span>

<span class="o">//</span> <span class="n">Train</span> <span class="n">a</span> <span class="n">RandomForest</span> <span class="n">model</span><span class="o">.</span>
<span class="n">val</span> <span class="n">rf</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RandomForestClassifier</span><span class="p">()</span> 
              <span class="o">.</span><span class="n">setLabelCol</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setFeaturesCol</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setNumTrees</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setFeatureSubsetStrategy</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setImpurity</span><span class="p">(</span><span class="s2">&quot;gini&quot;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setMaxDepth</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setMaxBins</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
              <span class="o">.</span><span class="n">setSeed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>

<span class="n">val</span> <span class="n">model</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">setStages</span><span class="p">(</span><span class="n">transformers</span> <span class="p">:</span><span class="o">+</span> <span class="n">rf</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">predictionsOnTestData</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>
<span class="n">predictionsOnTestData</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>predictionsOnTestData: org.apache.spark.sql.DataFrame = [id: int, origin: string ... 8 more fields]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">predicitonsAndLabels</span> <span class="o">=</span> <span class="n">predictionsOnTestData</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>predicitonsAndLabels: org.apache.spark.sql.DataFrame = [label: double, prediction: double]
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator</span>

<span class="o">//</span> <span class="n">Select</span> <span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">true</span> <span class="n">label</span><span class="p">)</span> <span class="ow">and</span> <span class="n">compute</span> <span class="n">test</span> <span class="n">error</span><span class="o">.</span>
<span class="n">val</span> <span class="n">evaluator</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">()</span>
  <span class="o">.</span><span class="n">setLabelCol</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">)</span>
  <span class="o">.</span><span class="n">setPredictionCol</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
  <span class="o">.</span><span class="n">setMetricName</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictionsOnTestData</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="n">s</span><span class="s2">&quot;Test Error = ${(1.0 - accuracy)}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Test Error = 0.24
import org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator
evaluator: org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator = MulticlassClassificationEvaluator: uid=mcEval_0fad54a4afcf, metricName=accuracy, metricLabel=0.0, beta=1.0, eps=1.0E-15
accuracy: Double = 0.76
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="n">predictionAndLabelsRdd</span> <span class="o">=</span> <span class="n">predicitonsAndLabels</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">)</span><span class="o">.</span><span class="k">as</span><span class="p">[(</span><span class="n">Double</span><span class="p">,</span><span class="n">Double</span><span class="p">)]</span><span class="o">.</span><span class="n">rdd</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>predictionAndLabelsRdd: org.apache.spark.rdd.RDD[(Double, Double)] = MapPartitionsRDD[371802] at rdd at command-2294440354339436:1
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.apache.spark.mllib.evaluation.MulticlassMetrics</span>

<span class="n">val</span> <span class="n">metricsMulti</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MulticlassMetrics</span><span class="p">(</span><span class="n">predictionAndLabelsRdd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import org.apache.spark.mllib.evaluation.MulticlassMetrics
metricsMulti: org.apache.spark.mllib.evaluation.MulticlassMetrics = org.apache.spark.mllib.evaluation.MulticlassMetrics@653cdd42
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Confusion matrix:&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="n">metricsMulti</span><span class="o">.</span><span class="n">confusionMatrix</span><span class="p">)</span>

<span class="n">val</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="n">metricsMulti</span><span class="o">.</span><span class="n">accuracy</span>

<span class="n">println</span><span class="p">(</span><span class="s2">&quot;Summary Statistics&quot;</span><span class="p">)</span>

<span class="n">println</span><span class="p">(</span><span class="n">s</span><span class="s2">&quot;Accuracy = $accuracy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Confusion matrix:
28.0  11.0  2.0   
7.0   23.0  0.0   
4.0   0.0   25.0  
Summary Statistics
Accuracy = 0.76
accuracy: Double = 0.76
</pre></div>
</div>
</div></blockquote>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./000_0-sds-3-x-projects/student-project-09_group-TopicModeling"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By ScaDaMaLe Team<br/>
        
            &copy; Copyright 2020 Creative Commons Zero v1.0 Universal.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>