
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic Tweet Maps &#8212; Scalable Data Science &amp; Distributed Machine Learning</title>
    
  <link rel="stylesheet" href="../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Scalable Data Science & Distributed Machine Learning</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/000_ScaDaMaLe.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark Core
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/001_whySpark.html">
   Why Apache Spark?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html">
   databricks community edition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#essentials-of-databricks-cloud-dbc-in-a-big-hurry">
   Essentials of Databricks Cloud (DBC) in a Big Hurry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-what-is-databricks-cloud">
   DBC Essentials: What is Databricks Cloud?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-shard-cluster-notebook-and-dashboard">
   DBC Essentials: Shard, Cluster, Notebook and Dashboard
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#dbc-essentials-team-state-collaboration-elastic-resources">
   DBC Essentials: Team, State, Collaboration, Elastic Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#you-should-all-have-databricks-community-edition-account-by-now">
   You Should All Have databricks community edition account by now!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#import-course-content-now">
   Import Course Content Now!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_00_loginToDatabricks.html#cloud-free-computing-environment-optional-but-recommended">
   Cloud-free Computing Environment (Optional but recommended)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html">
   Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/002_01_multiLingualNotebooks.html#further-reference-homework-recurrrent-points-of-reference">
   Further Reference / Homework / Recurrrent Points of Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html">
   Introduction to Scala through Scala Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-in-your-own-computer">
   Scala in your own computer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-resources">
   Scala Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#introduction-to-scala">
   Introduction to Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#let-s-get-our-hands-dirty-in-scala">
   Let’s get our hands dirty in Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#scala-types">
   Scala Types
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#expressions">
   Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#blocks">
   Blocks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#functions">
   Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#methods">
   Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#classes">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#case-classes">
   Case Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#objects">
   Objects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#traits">
   Traits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#main-method">
   Main Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_00_scalaCrashCourse.html#what-i-try-not-do-while-learning-a-new-language">
   What I try not do while learning a new language?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html">
   Scala Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#let-s-continue-to-get-our-hands-dirty-in-scala">
   Let’s continue to get our hands dirty in Scala
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#scala-type-hierarchy">
   Scala Type Hierarchy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#scala-collections">
   Scala Collections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#exercise-in-functional-programming">
   Exercise in Functional Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#lazy-evaluation">
   Lazy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/003_01_scalaCrashCourse.html#recursions">
   Recursions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html">
   Introduction to Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/004_RDDsTransformationsActions.html#spark-cluster-overview">
   Spark Cluster Overview:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/005_RDDsTransformationsActionsHOMEWORK.html">
   HOMEWORK notebook - RDDs Transformations and Actions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html">
   Piped RDDs and Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#from-a-local-collection">
   From a Local Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#glom">
   glom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#checkpointing">
   Checkpointing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#pipe-rdds-to-system-commands">
   Pipe RDDs to System Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#mappartitions">
   mapPartitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#foreachpartition">
   foreachPartition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#numerically-rigorous-bayesian-ab-testing">
   Numerically Rigorous Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006a_PipedRDD.html#usage-instructions-for-isit1or2coins">
   Usage instructions for IsIt1or2Coins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/006_WordCount.html">
   Word Count on US State of the Union (SoU) Addresses
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Introduction to Apache Spark SQL
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html">
   Introduction to Spark SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#overview">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#datasets-and-dataframes">
   Datasets and DataFrames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007_SparkSQLIntroBasics.html#getting-started-in-spark-2-x">
   Getting Started in Spark 2.x
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007a_SparkSQLProgGuide_HW.html">
   Spark Sql Programming Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007b_SparkSQLProgGuide_HW.html#id1">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007c_SparkSQLProgGuide_HW.html">
   Getting Started - Exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html">
   Data Sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007d_SparkSQLProgGuide_HW.html#id1">
   Data Sources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007e_SparkSQLProgGuide_HW.html">
   Performance Tuning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html">
   Distributed SQL Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007f_SparkSQLProgGuide_HW.html#id1">
   Distributed SQL Engine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html">
   ScaDaMaLe, Scalable Data Science and Distributed Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#sql-pivoting-since-spark-2-4">
   SQL Pivoting since Spark 2.4
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#load-data">
   Load Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-in-sql">
   Pivoting in SQL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-aggregate-expressions">
   Pivoting with Multiple Aggregate Expressions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-grouping-columns">
   Pivoting with Multiple Grouping Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/007g_PivotInSQL.html#pivoting-with-multiple-pivot-columns">
   Pivoting with Multiple Pivot Columns
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html">
   Diamonds ML Pipeline Workflow - DataFrame ETL and EDA Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-1-load-data-as-dataframe">
   Step 1. Load data as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#step-2-understand-the-data">
   Step 2. Understand the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#let-us-run-through-some-basic-inteactive-sql-queries-next">
   Let us run through some basic inteactive SQL queries next
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#why-do-we-need-to-know-these-interactive-sql-queries">
   Why do we need to know these interactive SQL queries?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/008_DiamondsPipeline_01ETLEDA.html#we-will-continue-later-with-ml-pipelines-to-do-prediction-with-a-fitted-model-from-this-dataset">
   We will continue later with ML pipelines to do prediction with a fitted model from this dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html">
   Power Plant ML Pipeline Application - DataFrame Part
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-1-business-understanding">
   Step 1: Business Understanding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-2-load-your-data">
   Step 2: Load Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#use-this-for-other-smallish-datasets-you-want-to-import-to-your-ce">
   USE THIS FOR OTHER SMALLish DataSets you want to import to your CE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-3-explore-your-data">
   Step 3: Explore Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/009_PowerPlantPipeline_01ETLEDA.html#step-4-visualize-your-data">
   Step 4: Visualize Your Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html">
   Wiki Clickstream Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/010_wikipediaClickStream_01ETLEDA.html#wikipedia-logo">
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html">
   Old Bailey Online Data Analysis in Apache Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_LoadExtract.html#analysing-the-full-old-bailey-online-sessions-papers-dataset">
   Analysing the Full Old Bailey Online Sessions Papers Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html">
   Piped RDDs and Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#from-a-local-collection">
   From a Local Collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#glom">
   glom
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#checkpointing">
   Checkpointing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#pipe-rdds-to-system-commands">
   Pipe RDDs to System Commands
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#mappartitions">
   mapPartitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#foreachpartition">
   foreachPartition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#numerically-rigorous-bayesian-ab-testing">
   Numerically Rigorous Bayesian AB Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#usage-instructions-for-isit1or2coins">
   Usage instructions for IsIt1or2Coins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#parsing-the-output-from-isit1or2coins">
   Parsing the output from
   <code class="docutils literal notranslate">
    <span class="pre">
     IsIt1or2Coins
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/033_OBO_PipedRDD_RigorousBayesianABTesting.html#providing-case-classes-for-input-and-output-for-easy-spark-communication">
   Providing case classes for input and output for easy spark communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Distribute Deep Learning with Horovod
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/00_DDL_Introduction.html">
   Introduction to Distributed Deep Learning (DDL) with Horovod over Tensorflow/keras and Pytorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/0x_mnist-tensorflow-keras.html">
   Distributed deep learning training using TensorFlow and Keras with HorovodRunner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_7-sds-3-x-ddl/0y_mnist-pytorch.html">
   Distributed deep learning training using PyTorch with HorovodRunner for MNIST
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  WASP AI-Track Student Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/035_LDA_CornellMovieDialogs.html">
   Topic Modeling of Movie Dialogs with Latent Dirichlet Allocation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Voluntary Student Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html">
   Plugging into GDELT Streams - TODO - IN PROGRESS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html#this-is-just-dipping-our-pinky-toe-in-this-ocean-of-information">
   This is just dipping our pinky toe in this ocean of information!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../000_1-sds-3-x/030_Spark_GDELT_project.html#download-from-gdelt-project">
   Download from gdelt-project
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/000_0-sds-3-x-projects/student-project-10_group-Geosmus/03_Dynamic_Tweet_Maps_rasmus_draft.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://lamastex.github.io/ScaDaMaLe/index.html/issues/new?title=Issue%20on%20page%20%2F000_0-sds-3-x-projects/student-project-10_group-Geosmus/03_Dynamic_Tweet_Maps_rasmus_draft.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependencies">
   Dependencies:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-some-functions">
   Defining some functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-processing-of-dataframe">
   Initial processing of dataframe
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quick-data-exploration">
     Quick data exploration
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting">
     Plotting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choropleth">
       Choropleth
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cartogram">
       Cartogram
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#animating-the-time-evolution-of-tweets">
     Animating the time evolution of tweets
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#save-reduced-df-for-use-in-r">
       Save reduced df for use in r
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#r-based-plotting">
     R based plotting
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#installing-dependencies">
       Installing dependencies
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#loading-data">
       Loading data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#todo-z-axis">
       TODO: z-axis
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#alternative-r-approach">
     Alternative R approach
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dynamic-tweet-maps">
<h1>Dynamic Tweet Maps<a class="headerlink" href="#dynamic-tweet-maps" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we are going to make some maps depicting when and where
tweets are sent.</p>
<p>We will also use the sentiment classes from the previous notebooks to
illustrate which type of tweets are frequent at different times in
differetn countries.</p>
<div class="section" id="dependencies">
<h2>Dependencies:<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>In order to run this notebook you need to install some dependencies, via
apt, pip and git. To install the dependencies run the following three
cells.</p>
<p>(We have used the cluster “small-2-8Ws-class-01-sp3-sc2-12” for our
experiments.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">libproj</span><span class="o">-</span><span class="n">dev</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">libgeos</span><span class="o">++-</span><span class="n">dev</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Reading package lists...
Building dependency tree...
Reading state information...
libproj-dev is already the newest version (4.9.3-2).
The following packages were automatically installed and are no longer required:
  libcap2-bin libpam-cap zulu-repo
Use &#39;sudo apt autoremove&#39; to remove them.
0 upgraded, 0 newly installed, 0 to remove and 18 not upgraded.
Reading package lists...
Building dependency tree...
Reading state information...
libgeos++-dev is already the newest version (3.6.2-1build2).
The following packages were automatically installed and are no longer required:
  libcap2-bin libpam-cap zulu-repo
Use &#39;sudo apt autoremove&#39; to remove them.
0 upgraded, 0 newly installed, 0 to remove and 18 not upgraded.
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">plotly</span>
<span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pycountry</span>
<span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">geopandas</span>
<span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">geoplot</span>
<span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">imageio</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Python interpreter will be restarted.
Requirement already satisfied: plotly in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (4.14.1)
Requirement already satisfied: six in /databricks/python3/lib/python3.7/site-packages (from plotly) (1.14.0)
Requirement already satisfied: retrying&gt;=1.3.3 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from plotly) (1.3.3)
Python interpreter will be restarted.
Python interpreter will be restarted.
Requirement already satisfied: pycountry in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (20.7.3)
Python interpreter will be restarted.
Python interpreter will be restarted.
Requirement already satisfied: geopandas in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (0.8.1)
Requirement already satisfied: pandas&gt;=0.23.0 in /databricks/python3/lib/python3.7/site-packages (from geopandas) (1.0.1)
Requirement already satisfied: pyproj&gt;=2.2.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geopandas) (3.0.0.post1)
Requirement already satisfied: fiona in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geopandas) (1.8.18)
Requirement already satisfied: shapely in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geopandas) (1.7.1)
Requirement already satisfied: python-dateutil&gt;=2.6.1 in /databricks/python3/lib/python3.7/site-packages (from pandas&gt;=0.23.0-&gt;geopandas) (2.8.1)
Requirement already satisfied: numpy&gt;=1.13.3 in /databricks/python3/lib/python3.7/site-packages (from pandas&gt;=0.23.0-&gt;geopandas) (1.18.1)
Requirement already satisfied: pytz&gt;=2017.2 in /databricks/python3/lib/python3.7/site-packages (from pandas&gt;=0.23.0-&gt;geopandas) (2019.3)
Requirement already satisfied: certifi in /databricks/python3/lib/python3.7/site-packages (from pyproj&gt;=2.2.0-&gt;geopandas) (2020.6.20)
Requirement already satisfied: six&gt;=1.5 in /databricks/python3/lib/python3.7/site-packages (from python-dateutil&gt;=2.6.1-&gt;pandas&gt;=0.23.0-&gt;geopandas) (1.14.0)
Requirement already satisfied: munch in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas) (2.5.0)
Requirement already satisfied: click-plugins&gt;=1.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas) (1.1.1)
Requirement already satisfied: attrs&gt;=17 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas) (20.3.0)
Requirement already satisfied: cligj&gt;=0.5 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas) (0.7.1)
Requirement already satisfied: click&lt;8,&gt;=4.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas) (7.1.2)
Python interpreter will be restarted.
Python interpreter will be restarted.
Requirement already satisfied: geoplot in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (0.4.1)
Requirement already satisfied: seaborn in /databricks/python3/lib/python3.7/site-packages (from geoplot) (0.10.0)
Requirement already satisfied: matplotlib in /databricks/python3/lib/python3.7/site-packages (from geoplot) (3.1.3)
Requirement already satisfied: mapclassify&gt;=2.1 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geoplot) (2.4.2)
Requirement already satisfied: contextily&gt;=1.0.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geoplot) (1.0.1)
Requirement already satisfied: cartopy in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geoplot) (0.18.0)
Requirement already satisfied: pandas in /databricks/python3/lib/python3.7/site-packages (from geoplot) (1.0.1)
Requirement already satisfied: geopandas in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geoplot) (0.8.1)
Requirement already satisfied: descartes in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geoplot) (1.1.0)
Requirement already satisfied: mercantile in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from contextily&gt;=1.0.0-&gt;geoplot) (1.1.6)
Requirement already satisfied: pillow in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from contextily&gt;=1.0.0-&gt;geoplot) (8.1.0)
Requirement already satisfied: geopy in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from contextily&gt;=1.0.0-&gt;geoplot) (2.1.0)
Requirement already satisfied: joblib in /databricks/python3/lib/python3.7/site-packages (from contextily&gt;=1.0.0-&gt;geoplot) (0.14.1)
Requirement already satisfied: rasterio in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from contextily&gt;=1.0.0-&gt;geoplot) (1.1.8)
Requirement already satisfied: requests in /databricks/python3/lib/python3.7/site-packages (from contextily&gt;=1.0.0-&gt;geoplot) (2.22.0)
Requirement already satisfied: scipy&gt;=1.0 in /databricks/python3/lib/python3.7/site-packages (from mapclassify&gt;=2.1-&gt;geoplot) (1.4.1)
Requirement already satisfied: numpy&gt;=1.3 in /databricks/python3/lib/python3.7/site-packages (from mapclassify&gt;=2.1-&gt;geoplot) (1.18.1)
Requirement already satisfied: scikit-learn in /databricks/python3/lib/python3.7/site-packages (from mapclassify&gt;=2.1-&gt;geoplot) (0.22.1)
Requirement already satisfied: networkx in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from mapclassify&gt;=2.1-&gt;geoplot) (2.5)
Requirement already satisfied: python-dateutil&gt;=2.6.1 in /databricks/python3/lib/python3.7/site-packages (from pandas-&gt;geoplot) (2.8.1)
Requirement already satisfied: pytz&gt;=2017.2 in /databricks/python3/lib/python3.7/site-packages (from pandas-&gt;geoplot) (2019.3)
Requirement already satisfied: six&gt;=1.5 in /databricks/python3/lib/python3.7/site-packages (from python-dateutil&gt;=2.6.1-&gt;pandas-&gt;geoplot) (1.14.0)
Requirement already satisfied: pyshp&gt;=1.1.4 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from cartopy-&gt;geoplot) (2.1.2)
Requirement already satisfied: setuptools&gt;=0.7.2 in /usr/local/lib/python3.7/dist-packages (from cartopy-&gt;geoplot) (45.2.0)
Requirement already satisfied: shapely&gt;=1.5.6 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from cartopy-&gt;geoplot) (1.7.1)
Requirement already satisfied: pyproj&gt;=2.2.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geopandas-&gt;geoplot) (3.0.0.post1)
Requirement already satisfied: fiona in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geopandas-&gt;geoplot) (1.8.18)
Requirement already satisfied: certifi in /databricks/python3/lib/python3.7/site-packages (from pyproj&gt;=2.2.0-&gt;geopandas-&gt;geoplot) (2020.6.20)
Requirement already satisfied: munch in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas-&gt;geoplot) (2.5.0)
Requirement already satisfied: click-plugins&gt;=1.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas-&gt;geoplot) (1.1.1)
Requirement already satisfied: attrs&gt;=17 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas-&gt;geoplot) (20.3.0)
Requirement already satisfied: cligj&gt;=0.5 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas-&gt;geoplot) (0.7.1)
Requirement already satisfied: click&lt;8,&gt;=4.0 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from fiona-&gt;geopandas-&gt;geoplot) (7.1.2)
Requirement already satisfied: geographiclib&lt;2,&gt;=1.49 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from geopy-&gt;contextily&gt;=1.0.0-&gt;geoplot) (1.50)
Requirement already satisfied: cycler&gt;=0.10 in /databricks/python3/lib/python3.7/site-packages (from matplotlib-&gt;geoplot) (0.10.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /databricks/python3/lib/python3.7/site-packages (from matplotlib-&gt;geoplot) (2.4.6)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /databricks/python3/lib/python3.7/site-packages (from matplotlib-&gt;geoplot) (1.1.0)
Requirement already satisfied: decorator&gt;=4.3.0 in /databricks/python3/lib/python3.7/site-packages (from networkx-&gt;mapclassify&gt;=2.1-&gt;geoplot) (4.4.1)
Requirement already satisfied: affine in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from rasterio-&gt;contextily&gt;=1.0.0-&gt;geoplot) (2.3.0)
Requirement already satisfied: snuggs&gt;=1.4.1 in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from rasterio-&gt;contextily&gt;=1.0.0-&gt;geoplot) (1.4.7)
Requirement already satisfied: idna&lt;2.9,&gt;=2.5 in /databricks/python3/lib/python3.7/site-packages (from requests-&gt;contextily&gt;=1.0.0-&gt;geoplot) (2.8)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /databricks/python3/lib/python3.7/site-packages (from requests-&gt;contextily&gt;=1.0.0-&gt;geoplot) (1.25.8)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in /usr/lib/python3/dist-packages (from requests-&gt;contextily&gt;=1.0.0-&gt;geoplot) (3.0.4)
Python interpreter will be restarted.
Python interpreter will be restarted.
Requirement already satisfied: imageio in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (2.9.0)
Requirement already satisfied: numpy in /databricks/python3/lib/python3.7/site-packages (from imageio) (1.18.1)
Requirement already satisfied: pillow in /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages (from imageio) (8.1.0)
Python interpreter will be restarted.
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">mthh</span><span class="o">/</span><span class="n">cartogram_geopandas</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">cartogram_geopandas</span><span class="o">/</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fatal: destination path &#39;cartogram_geopandas&#39; already exists and is not an empty directory.
running install
running build
running build_py
running build_ext
running install_lib
running install_egg_info
Removing /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas-0.0.0c.egg-info
Writing /local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas-0.0.0c.egg-info
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="defining-some-functions">
<h2>Defining some functions<a class="headerlink" href="#defining-some-functions" title="Permalink to this headline">¶</a></h2>
<p>We will process the collected data a bit before making any plots. *
<strong>load<em>twitter</em>geo*data(path)</strong> * <strong>country<em>code</em>grouping(df)</strong> *
<strong>add<em>iso</em>a3<em>col(df</em>cc)</strong> Takes the df generated by
load<em>twitter</em>geo<em>data() and maps the two letter country code to the
three letter ISO</em>a3 format. * <strong>create<em>geo</em>df(df*cc)</strong> Takes the df
generated by add<em>iso</em>a3_col() and merges it with a geopandas dataframe,
which contains shape information of the worlds countries. *
__animate<em>cartogram(df, filterKey, filterList, out</em>path,
cartogram_key, legend)__</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;./tweet_carto_functions&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="initial-processing-of-dataframe">
<h2>Initial processing of dataframe<a class="headerlink" href="#initial-processing-of-dataframe" title="Permalink to this headline">¶</a></h2>
<p>This step only needs to be run if you want to overwrite the existing
preprocessed dataframea “processedDF.csv”. Otherwise you can just skip
to the next cell and load the already generated dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># path = &quot;/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/*/*/*/*/*/*&quot;</span>
<span class="c1"># df = load_twitter_geo_data(path)</span>
<span class="c1"># #Data collection was continuous during the 22nd December whereas for the remaining days we only streamed for 3 minutes per hour.</span>
<span class="c1"># df = df[(df[&#39;day&#39;] != 22) &amp; (df[&#39;day&#39;] != 2 )].reset_index() #Data collection was continuous during the 22nd December whereas for the remaining days we only streamed for 3 minutes per hour. Data collection ended in the middle of Jan second so to only have full day we disregard Jan 2.</span>
<span class="c1"># pre_proc_path = &quot;/dbfs/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/tmp/processedDF.csv&quot;</span>
<span class="c1"># df.to_csv(pre_proc_path)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="quick-data-exploration">
<h3>Quick data exploration<a class="headerlink" href="#quick-data-exploration" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by having a look at the first 5 elements.</p>
<p>For now we are only looking at country of origin and timestamp, so we
have neither loaded the tweets or the derived sentiment classes from
before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the data</span>
<span class="n">pre_proc_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/tmp/processedDF.csv&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pre_proc_path</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>The tweets we have loaded were sent between Dec 23 and Jan 1, and the
timestamps are given in Greenwich Mean Time (GMT). We can use the
display function again to have a look at how tweets are distributed as a
function of time of day. To get tweets from a single timezone we just
have a look at tweets from the United Kingdom (which has the country
code <em>GB</em>).</p>
<p>The below histograms show a clear dip in twitter activity from around
eleven at night untill around eight in the morning. The night between
the 24th and 25th of December shows a small spike right after midnight
and new years shows a large spike after midnight. It seems that people
like people like to celebrate by tweeting!</p>
<p>There is an abnormal peak on December 27th at 21. We have not been able
to determine what this is due to.</p>
<p>NOTE: The cell below has been configured (via the display user
interface) to show histograms using dates as key and hour as values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;countryCode==&#39;GB&#39;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>If we look at Saudi Arabia it seems that something is happening on
December 31rst and December 28th.</p>
<ul class="simple">
<li><p>The timestamps are in GMT, so the smalller peak at 21:00 on December
31rst is actually located at midnight, and most likely due to new
years. The larger peak roughly coincides with the time of the Isha
prayer (last prayer of the day), so perhaps people like to tweet
right before and after the last prayer of the year.</p></li>
<li><p>The largest spike is located on December 28th. It covers tweets send
between 12:00 and 16:00 GMT, which would correspond to 15:00-18:00
local time. We have tried to find the cause of this peak, and we
think it might be due to the conviction of female rights activist
Loujain al-Hathloul who was sentenced to five years and 8 months of
prison on this date. We could not find an exact timestamp for this
event, but the report from france24 is timestamped to 12:20
(presumably Western European time), which corresponds to 14:20 in
Saudi Arabia. It might be that there was a bit of lag time between
media starting to report on the events and the case gaining traction
on social media. Of course the spike could also be due to something
else, but this sentence seems like a likely cause.</p></li>
</ul>
<p>Links: *
https://www.thehindu.com/news/international/saudi-activist-loujain-al-hathloul-sentenced-to-5-years-8-months-in-prison/article33437467.ece
Timestamp: 17:30 IST corresponding to 15:00 in Saudi Arabia *
https://www.aljazeera.com/news/2020/12/28/saudi-court-hands-jail-sentence-to-womens-rights-activist
No timestamp *
https://www.france24.com/en/live-news/20201228-saudi-activist-loujain-al-hathloul-jailed-for-5-years-8-months
Timestamp: 12:20 CET corresponding to 14:20 in Saudi Arabia</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;countryCode==&#39;SA&#39;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>To create maps using the tweets we will first group the tweets by
country codes, producing a new dataframe with one row per country.</p>
<p>The map below is generated by selecting the map option in the display
UI. This view only offers a simple discrete colorbar, but we can see
that the most tweet producing countries are the United States and
Brazil. Hovering above countries gives more detailed information, and
shows that the Japan, the UK and India also produce a lot of tweets.</p>
<p>We also get tweets from a number of countries which have blocked access
to twitter (China: 1825, North Korea: 5, Iran: 1590 and Turkmenistan:
7).
https://en.wikipedia.org/wiki/Censorship<em>of</em>Twitter#Government<em>blocking</em>of<em>Twitter</em>access</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group by country code</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">country_code_grouping</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">add_iso_a3_col</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">df_cc</span><span class="p">[[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">]]</span> <span class="c1">#reorder to have iso_a3 as first column (required in order to use the map view in display). Also we don&#39;t need countryCode and index columns.</span>

<span class="c1"># Inspect result</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>[TABLE]</p>
<p>Truncated to 30 rows</p>
<p>Right now we are dealing with a regular dataframe. But to make some more
advanced plots we will need information about the shapes of the
countries (in the form of polygons). We get the shapes via the function
create<em>geo</em>df(), which relies on the geopandas library. When calling
display on a geopandas dataframe we just get the raw table, and none of
the premade visualizations we get when displaying pandas dataframes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the geopandas dataframe</span>
<span class="n">df_world</span> <span class="o">=</span> <span class="n">create_geo_df</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>
<span class="c1"># Inspect result</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_world</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># if you want to work with this file localy you need to do the following:</span>
<span class="c1"># Save to filestore: df_world.to_csv(&quot;/dbfs/FileStore/group10/world_tweet.csv&quot;)</span>
<span class="c1"># Download to local by pasting the following into your browser: https://dbc-635ca498-e5f1.cloud.databricks.com/files/group10/world_tweet.csv?o=445287446643905 </span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plotting">
<h3>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">¶</a></h3>
<div class="section" id="choropleth">
<h4>Choropleth<a class="headerlink" href="#choropleth" title="Permalink to this headline">¶</a></h4>
<p>A choropleth map is a map in which regions are assigned a color based on
a numerical attribute. This could for example be each regions
population, average life expectancy, or number of geo tagged tweets.</p>
</div>
<div class="section" id="cartogram">
<h4>Cartogram<a class="headerlink" href="#cartogram" title="Permalink to this headline">¶</a></h4>
<p>A cartogram is a way to represent geograpic differences in some
variable, by altering the size of regions. The areas and shapes of
regions are distorted in order to create an approximately equal density
of the selected variable across all regions. In our case there are a lot
of tweets coming from brazil and the US so these regions grow resulting
in lower tweet density.</p>
<p>The available python cartogram package cartogram_geopandas is based on
Dougenik, J. A, N. R. Chrisman, and D. R. Niemeyer: 1985. “An algorithm
to construct continuous cartograms”. It is very sparselu documented and
does not report error scores and tends to diverge if allowed to run for
too many iterations.</p>
<p>We found the Gui program Scapetoad to offer superior performance.
Scapetoad is based on Mark Newman’s C-code “Cart”, which is based on his
and Michael T. Gastner’s paper “Diffusion-based method for
producingdensity-equalizing maps” from 2004. Scapetoad is working on a
Python API, but it has not been released yet.</p>
<p>Inspite of its shortcomings we will be using cartogram_geopandas, since
Scapetoad can not be called from a notebook.</p>
<p>To begin with we will plot all the tweets collected between 23:00:00 and
23:59:59 (GMT) on December 31rst. On the left side a world map with
colors indicating number of tweets is shown, and on the right side a
cartogram. It seems United kingdom is tweeting a lot at this moment,
which makes sense as they are about to enter 2021. Goodbye 2020!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pre_proc_path</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;(day==31) and (hour==23)&quot;</span><span class="p">)</span>
<span class="c1"># Group by country code</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">country_code_grouping</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">add_iso_a3_col</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">df_cc</span><span class="p">[[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">]]</span> <span class="c1">#reorder to have iso_a3 as first column (required in order to use the map view in display). Also we don&#39;t need countryCode and index columns.</span>
<span class="c1"># Create the geopandas dataframe</span>
<span class="n">df_world</span> <span class="o">=</span> <span class="n">create_geo_df</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># Make a choropleth plot</span>
<span class="n">df_world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;numTweets&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># The make_cartogram function can not handle a tweetcount of zero, so a not so elegant solution is to clip the tweet count at 1.</span>
<span class="c1"># The alternative (to remove countries without tweets) is not elegant either (and causes problems when we look at the time evolution, since countries will be popping in and out of existence).</span>
<span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]))</span> 

<span class="n">df_cartogram</span> <span class="o">=</span> <span class="n">make_cartogram</span><span class="p">(</span><span class="n">df_world</span><span class="p">,</span> <span class="s1">&#39;numTweets&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_cartogram</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;numTweets&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="animating-the-time-evolution-of-tweets">
<h3>Animating the time evolution of tweets<a class="headerlink" href="#animating-the-time-evolution-of-tweets" title="Permalink to this headline">¶</a></h3>
<p>Rather than looking at a snapshot of the worlds twitter activity it
would be interesting to look at how twitter activity looks across hours
and days.</p>
<p>The following cell generates a number of png cartograms. One for every
hour between December 23rd 2020 and January 2nd 2021.</p>
<p>It takes quite long to generate them all (around eight minutes) so you
might want to just load the pregenerated pngs in the cell below.</p>
<p>NOTE: Geopandas prints some warnings related to using unprojected
geometries (We work in longitude and latitude rather than some standard
2D map projection). This is not an issue since we are not using the area
function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># pre_proc_path = &quot;/dbfs/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/tmp/processedDF.csv&quot;</span>
<span class="c1"># df = pd.read_csv(pre_proc_path)</span>
<span class="c1"># key = &quot;hour&quot;</span>
<span class="c1"># timeOfDayList = list(range(0, 24))</span>
<span class="c1"># nIter = 5</span>
<span class="c1"># cartogram_key = &quot;numTweets&quot;</span>
<span class="c1"># for day in range(23,32):</span>
<span class="c1">#   out_path = &quot;/dbfs/FileStore/group10/cartogram/2020_Dec_%d_hour_&quot;%day</span>
<span class="c1">#   legend = &quot;2020 December %d: &quot;%day</span>
<span class="c1">#   animate_cartogram(df.query(&quot;(day==%d) and (year==2020)&quot;%day), key, timeOfDayList, out_path, nIter, cartogram_key, legend)</span>
<span class="c1"># for day in range(1,2):</span>
<span class="c1">#   out_path = &quot;/dbfs/FileStore/group10/cartogram/2021_Jan_%d_hour_&quot;%day</span>
<span class="c1">#   legend = &quot;2021 January %d: &quot;%day</span>
<span class="c1">#   animate_cartogram(df.query(&quot;(day==%d) and (year==2021)&quot;%day), key, timeOfDayList, out_path, nIter, cartogram_key, legend)</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have generated the PNGs we can go ahead and combine them
into a gif using the python imageIO library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">images</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># array for storing the png frames for the gif</span>
<span class="n">timeOfDayList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="c1">#Append images to image list</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">32</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">timeOfDayList</span><span class="p">:</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram_2020_Dec_</span><span class="si">%d</span><span class="s2">_hour_</span><span class="si">%d</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">timeOfDayList</span><span class="p">:</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram_2021_Jan_</span><span class="si">%d</span><span class="s2">_hour_</span><span class="si">%d</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
<span class="c1">#create gif from the image list</span>
<span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="s2">&quot;/dbfs/FileStore/group10/cartogram/many_days_cartogram.gif&quot;</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is the following animation. The vertical bar indicates where
in the world it is midnight and the time shown at the top is the current
GMT time. The color/z-axis denotes the number of tweets produced in the
given hour. &lt;img
src=’/files/group10/cartogram/many<em>days</em>cartogram.gif’&gt;</p>
<p>This cartogram animation expresses the amount of tweets both through the
size distortions and the z-axis (the color). In a way it is a bit
redundant to illustrate the same things in two ways. The plot would be
more informative if instead the z-axis is used to express some measure
of sentiment.</p>
<p>We can load a dataframe containing sentiment cluster information
extracted in the previous notebook. The dataframe has boolean columns
indicating if an emoji from a certain cluster is present.</p>
<p>An obvious candidate would be to use the happy and not happy clusters
found in the previous notebooks to express a single sentiment score:</p>
<blockquote>
<div><p>df[“sentiment”] = (1 + df[“happy”] - df[“notHappy”])/2</p>
</div></blockquote>
<p>Expressed in this way a sentiment value of zero means that the tweet
contains unhappy emojis and no happy emojis.</p>
<p>A sentiment value of 0.5 means that the tweet either contain both happy
and unhappy emojis or that it contains neither happy or unhappy emojis.</p>
<p>A sentiment value of 1 means that the tweet did not contain unhappy
emojis but did contain happy emojis.</p>
<p>A pie chart reveals that unhappy tweets are significantly more common
than happy ones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/processedEmoticonClusterParquets/emoticonCluster.parquet&quot;</span>
<span class="n">cluster_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;happy&quot;</span><span class="p">,</span> <span class="s2">&quot;notHappy&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;monkey&quot;</span><span class="p">,</span> <span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="s2">&quot;prayer&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">load_twitter_geo_data_test</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1"># Let&#39;s try combining the happy and sad columns to one &quot;sentiment&quot; column. </span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;happy&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notHappy&quot;</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;happy&quot;</span><span class="p">,</span> <span class="s2">&quot;notHappy&quot;</span><span class="p">,</span> <span class="s2">&quot;sentiment&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_twitter_geo_data_test</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;countryCode&#39;</span><span class="p">,</span> <span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">,</span> <span class="s2">&quot;prayer&quot;</span><span class="p">,</span> <span class="s2">&quot;monkey&quot;</span><span class="p">,</span> <span class="s2">&quot;happy&quot;</span><span class="p">,</span> <span class="s2">&quot;SK&quot;</span><span class="p">,</span> <span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="s2">&quot;notHappy&quot;</span><span class="p">)</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
  
  <span class="c1"># Add some new datetime derived columns.</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;dayofweek&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;minute&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;second&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;CurrentTweetDate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span>
  <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">country_code_grouping_test</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;countryCode&#39;</span><span class="p">,</span> <span class="s1">&#39;sentiment&#39;</span><span class="p">])[</span><span class="s1">&#39;countryCode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span> <span class="c1">#The count inside the transform function calls pandas count function</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;countryCode&#39;</span><span class="p">])[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;countryCode&quot;</span><span class="p">)</span>
  <span class="n">df_cc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">([</span><span class="s1">&#39;countryCode&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s2">&quot;sentiment&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">df_cc</span>

<span class="k">def</span> <span class="nf">create_geo_df_test</span><span class="p">(</span><span class="n">df_cc</span><span class="p">):</span>
  <span class="n">df_world</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geopandas</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span>
  <span class="c1"># natural earth has missing iso_a3 names for France, Norway, Somalia, Kosovo and Northen Cypruys..</span>
  <span class="c1"># See the following issue: https://github.com/geopandas/geopandas/issues/1041</span>
  <span class="c1"># The following lines manually fixes it for all but Northern Cyprus, which does not have an iso_a3 code.</span>
  <span class="n">df_world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_world</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;France&#39;</span><span class="p">,</span> <span class="s1">&#39;iso_a3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FRA&#39;</span>
  <span class="n">df_world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_world</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Norway&#39;</span><span class="p">,</span> <span class="s1">&#39;iso_a3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NOR&#39;</span>
  <span class="n">df_world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_world</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Somaliland&#39;</span><span class="p">,</span> <span class="s1">&#39;iso_a3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SOM&#39;</span>
  <span class="n">df_world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_world</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Kosovo&#39;</span><span class="p">,</span> <span class="s1">&#39;iso_a3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RKS&#39;</span>

  <span class="n">numTweetDict</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="n">countryCode</span> <span class="ow">in</span> <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">]:</span>
      <span class="n">numTweetDict</span><span class="p">[</span><span class="n">countryCode</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_cc</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
      <span class="n">numTweetDict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
  <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">numTweetDict</span><span class="p">)</span>

  <span class="n">sentimentDict</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="n">countryCode</span> <span class="ow">in</span> <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">]:</span>
      <span class="n">sentimentDict</span><span class="p">[</span><span class="n">countryCode</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_cc</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
      <span class="n">sentimentDict</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">]</span>
  <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sentimentDict</span><span class="p">)</span>
  
  <span class="c1"># Could be useful to throw away antarctica and antarctic isles.</span>
  <span class="c1"># df_world = df_world.query(&quot;(continent != &#39;Antarctica&#39;) or (continent != &#39;Seven seas (open ocean)&#39;)&quot;) </span>

  <span class="c1"># Redundant</span>
  <span class="c1"># df_world_proj = df_world.to_crs({&#39;init&#39;: &#39;EPSG:4326&#39;})</span>
  <span class="c1"># df_world[&quot;area&quot;] = df_world_proj[&#39;geometry&#39;].area</span>
  <span class="c1"># df_world[&quot;tweetDensity&quot;] = df_world[&quot;numTweets&quot;]/df_world[&quot;area&quot;]</span>
  <span class="c1"># df_world[&quot;tweetPerCapita&quot;] = df_world[&quot;numTweets&quot;]/df_world[&quot;pop_est&quot;]</span>
  <span class="k">return</span> <span class="n">df_world</span>

<span class="k">def</span> <span class="nf">animate_cartogram_test</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">filterKey</span><span class="p">,</span> <span class="n">filterList</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">nIter</span><span class="p">,</span> <span class="n">cartogram_key</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
  <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">filterKey</span><span class="p">,</span> <span class="s2">&quot;countryCode&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span> <span class="c1"># Get maximum count within a single country in a single hour. We will use this to fix the colorbar.</span>
  <span class="n">images</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># array for storing the png frames for the gif</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filterList</span><span class="p">:</span>
    <span class="c1"># Load the data and add ISOa3 codes.</span>
    <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">==</span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">filterKey</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_cc</span> <span class="o">=</span> <span class="n">country_code_grouping_test</span><span class="p">(</span><span class="n">df_filtered</span><span class="p">)</span>
    <span class="n">df_cc</span> <span class="o">=</span> <span class="n">add_iso_a3_col</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>

    <span class="c1"># Create the geopandas dataframe</span>
    <span class="n">df_world</span> <span class="o">=</span> <span class="n">create_geo_df_test</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>
    <span class="c1">#Create cartogram</span>
    <span class="c1"># The make_cartogram function can not handle a tweetcount of zero, so a not so elegant solution is to clip the tweet count at 1.</span>
    <span class="c1"># The alternative (to remove countries without tweets) is not elegant either, and causes problems when we look at the time evolution, since countries will be popping in and out of existence.</span>
    <span class="n">df_world2</span> <span class="o">=</span> <span class="n">df_world</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_world2</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_world2</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_cartogram</span> <span class="o">=</span> <span class="n">make_cartogram</span><span class="p">(</span><span class="n">df_world2</span><span class="p">,</span> <span class="n">cartogram_key</span><span class="p">,</span> <span class="n">nIter</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">])</span>
    <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">df_cartogram</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;sentiment&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 

    <span class="c1"># Plot a vertical line indicating midnight. 360degrees/24hours = 15 degrees/hour</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">12</span><span class="p">:</span>
      <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span><span class="o">*</span><span class="n">i</span> <span class="c1">#15deg per hour</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">t</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span><span class="o">*</span><span class="mi">15</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">legend</span> <span class="o">+</span> <span class="s2">&quot;Time of day (GMT): </span><span class="si">%02d</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude $^\circ$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude $^\circ$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>

    <span class="c1">#Save cartogram as a png</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="c1">#Append images to image list</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">))</span>
  <span class="c1">#create gif from the image list</span>
  <span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="n">out_path</span> <span class="o">+</span> <span class="s2">&quot;.gif&quot;</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>




<span class="n">df_cc</span> <span class="o">=</span> <span class="n">country_code_grouping_test</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">add_iso_a3_col</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>
<span class="n">df_cc</span> <span class="o">=</span> <span class="n">df_cc</span><span class="p">[[</span><span class="s2">&quot;iso_a3&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;sentiment&quot;</span><span class="p">]]</span> <span class="c1">#reorder to have iso_a3 as first column (required in order to use the map view in display). Also we don&#39;t need countryCode and index columns.</span>
<span class="c1"># Create the geopandas dataframe</span>
<span class="n">df_world</span> <span class="o">=</span> <span class="n">create_geo_df_test</span><span class="p">(</span><span class="n">df_cc</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">df_world</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;numTweets&gt;=20&quot;</span><span class="p">)[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">])</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_world</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;numTweets&gt;=20&quot;</span><span class="p">)[</span><span class="s2">&quot;sentiment&quot;</span><span class="p">])</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">])</span>
<span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1">#We filter out countries with very few emojii tweets</span>
<span class="n">df_world</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_world</span><span class="p">[</span><span class="s2">&quot;numTweets&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmin</span> <span class="o">-</span><span class="mi">1</span>
<span class="c1"># df_world = df_world.query(&quot;numTweets&gt;10&quot;).reset_index()</span>

<span class="c1"># Make a choropleth plot</span>
<span class="n">df_world</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sentiment&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sentiment by country&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude $^\circ$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude $^\circ$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_world</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;sentiment&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># We use negative values to indicate that there was too few tweets to evaluate sentiment, so here we filter these out.</span>
<span class="n">df_world</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;sentiment&gt;=0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;sentiment&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;hour&quot;</span>
<span class="n">timeOfDayList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">nIter</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">cartogram_key</span> <span class="o">=</span> <span class="s2">&quot;numTweets&quot;</span>

<span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram/sentiment_2020_Dec_hour_&quot;</span>
<span class="n">legend</span> <span class="o">=</span> <span class="s2">&quot;2020 December </span><span class="si">%d</span><span class="s2">: &quot;</span><span class="o">%</span><span class="n">day</span>
<span class="n">animate_cartogram_test</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">key</span><span class="p">,</span> <span class="n">timeOfDayList</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">nIter</span><span class="p">,</span> <span class="n">cartogram_key</span><span class="p">)</span>

<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">32</span><span class="p">):</span>
  <span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram/sentiment_2020_Dec_</span><span class="si">%d</span><span class="s2">_hour_&quot;</span><span class="o">%</span><span class="n">day</span>
  <span class="n">legend</span> <span class="o">=</span> <span class="s2">&quot;2020 December </span><span class="si">%d</span><span class="s2">: &quot;</span><span class="o">%</span><span class="n">day</span>
  <span class="n">animate_cartogram_test</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;(day==</span><span class="si">%d</span><span class="s2">) and (year==2020)&quot;</span><span class="o">%</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">key</span><span class="p">,</span> <span class="n">timeOfDayList</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">nIter</span><span class="p">,</span> <span class="n">cartogram_key</span><span class="p">)</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
  <span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram/sentiment_2021_Jan_</span><span class="si">%d</span><span class="s2">_hour_&quot;</span><span class="o">%</span><span class="n">day</span>
  <span class="n">legend</span> <span class="o">=</span> <span class="s2">&quot;2021 January </span><span class="si">%d</span><span class="s2">: &quot;</span><span class="o">%</span><span class="n">day</span>
  <span class="n">animate_cartogram_test</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;(day==</span><span class="si">%d</span><span class="s2">) and (year==2021)&quot;</span><span class="o">%</span><span class="n">day</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">key</span><span class="p">,</span> <span class="n">timeOfDayList</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">nIter</span><span class="p">,</span> <span class="n">cartogram_key</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
/local_disk0/.ephemeral_nfs/envs/pythonEnv-fe560180-9d54-4cf6-acb8-113d30c1807d/lib/python3.7/site-packages/cartogram_geopandas.py:48: UserWarning: Geometry is in a geographic CRS. Results from &#39;area&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  return crtgm.make()
</pre></div>
</div>
</div></blockquote>
<p>&lt;img src=’files/group10/cartogram/sentiment<em>2020</em>Dec<em>hour</em>.gif’&gt;</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">images</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># array for storing the png frames for the gif</span>
<span class="c1">#Append images to image list</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="mi">32</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">timeOfDayList</span><span class="p">:</span>
                <span class="o">/</span><span class="n">dbfs</span><span class="o">/</span><span class="n">FileStore</span><span class="o">/</span><span class="n">group10</span><span class="o">/</span><span class="n">cartogram</span><span class="o">/</span><span class="n">sentiment_2020_Dec_</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram/sentiment_2020_Dec_</span><span class="si">%d</span><span class="s2">_hour_</span><span class="si">%d</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
<span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">timeOfDayList</span><span class="p">:</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/FileStore/group10/cartogram/sentiment_2021_Jan_</span><span class="si">%d</span><span class="s2">_hour_</span><span class="si">%d</span><span class="s2">.png&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span>
<span class="c1">#create gif from the image list</span>
<span class="n">imageio</span><span class="o">.</span><span class="n">mimsave</span><span class="p">(</span><span class="s2">&quot;/dbfs/FileStore/group10/cartogram/many_days_cartogram_sentiment.gif&quot;</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">displayHTML</span><span class="p">(</span><span class="s2">&quot;&lt;img src=&#39;/files/group10/cartogram/many_days_cartogram_sentiment.gif&#39;&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="save-reduced-df-for-use-in-r">
<h4>Save reduced df for use in r<a class="headerlink" href="#save-reduced-df-for-use-in-r" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tmp_path</span> <span class="o">=</span> <span class="s2">&quot;/dbfs/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/tmp/tmp.csv&quot;</span>
<span class="n">df_cc</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="r-based-plotting">
<h3>R based plotting<a class="headerlink" href="#r-based-plotting" title="Permalink to this headline">¶</a></h3>
<p>I think this section might become redundant. Python is starting to work
for cartograms.</p>
<div class="section" id="installing-dependencies">
<h4>Installing dependencies<a class="headerlink" href="#installing-dependencies" title="Permalink to this headline">¶</a></h4>
<p>The following two cells need to be uncommented and run if running on a
new cluster.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># %sh </span>
<span class="c1"># sudo apt-get update</span>
<span class="c1"># sudo apt-get install libudunits2-dev -y</span>
<span class="c1"># sudo apt-get install libgdal-dev -y</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Ign:1 http://repos.azulsystems.com/ubuntu stable InRelease
Hit:2 http://repos.azulsystems.com/ubuntu stable Release
Hit:3 https://repos.azul.com/zulu/deb stable InRelease
Get:5 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Hit:6 http://archive.ubuntu.com/ubuntu bionic InRelease
Get:7 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:8 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,372 kB]
Get:9 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:10 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [15.3 kB]
Get:11 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [1,816 kB]
Get:12 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [266 kB]
Get:13 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [237 kB]
Get:14 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [53.8 kB]
Get:15 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,136 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [2,244 kB]
Fetched 8,392 kB in 5s (1,571 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following packages were automatically installed and are no longer required:
  libcap2-bin libpam-cap zulu-repo
Use &#39;sudo apt autoremove&#39; to remove them.
The following additional packages will be installed:
  libudunits2-0 libudunits2-data
The following NEW packages will be installed:
  libudunits2-0 libudunits2-data libudunits2-dev
0 upgraded, 3 newly installed, 0 to remove and 47 not upgraded.
Need to get 435 kB of archives.
After this operation, 1,034 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libudunits2-data all 2.2.26-1 [18.7 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libudunits2-0 amd64 2.2.26-1 [54.3 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libudunits2-dev amd64 2.2.26-1 [362 kB]
debconf: delaying package configuration, since apt-utils is not installed
Fetched 435 kB in 2s (280 kB/s)
Selecting previously unselected package libudunits2-data.
(Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 91333 files and directories currently installed.)
Preparing to unpack .../libudunits2-data_2.2.26-1_all.deb ...
Unpacking libudunits2-data (2.2.26-1) ...
Selecting previously unselected package libudunits2-0:amd64.
Preparing to unpack .../libudunits2-0_2.2.26-1_amd64.deb ...
Unpacking libudunits2-0:amd64 (2.2.26-1) ...
Selecting previously unselected package libudunits2-dev.
Preparing to unpack .../libudunits2-dev_2.2.26-1_amd64.deb ...
Unpacking libudunits2-dev (2.2.26-1) ...
Setting up libudunits2-data (2.2.26-1) ...
Setting up libudunits2-0:amd64 (2.2.26-1) ...
Setting up libudunits2-dev (2.2.26-1) ...
Processing triggers for libc-bin (2.27-3ubuntu1.3) ...
Processing triggers for install-info (6.5.0.dfsg.1-2) ...
Reading package lists...
Building dependency tree...
Reading state information...
The following packages were automatically installed and are no longer required:
  libcap2-bin libpam-cap zulu-repo
Use &#39;sudo apt autoremove&#39; to remove them.
The following additional packages will be installed:
  default-libmysqlclient-dev gdal-data hdf5-helpers libaec-dev libaec0
  libarmadillo-dev libarmadillo8 libarpack2 libarpack2-dev libboost-dev
  libboost1.65-dev libdap-dev libdap25 libdapclient6v5 libdapserver7v5
  libepsilon-dev libepsilon1 libfreexl-dev libfreexl1 libfyba-dev libfyba0
  libgdal20 libgeos-3.6.2 libgeos-c1v5 libgeos-dev libgeotiff-dev libgeotiff2
  libgif-dev libhdf4-0-alt libhdf4-alt-dev libhdf5-100 libhdf5-cpp-100
  libhdf5-dev libjbig-dev libjson-c-dev libkml-dev libkmlbase1
  libkmlconvenience1 libkmldom1 libkmlengine1 libkmlregionator1 libkmlxsd1
  libminizip-dev libminizip1 libmysqlclient-dev libmysqlclient20 libnetcdf-dev
  libnetcdf13 libogdi3.2 libogdi3.2-dev libopenjp2-7 libopenjp2-7-dev
  libpoppler-dev libpoppler-private-dev libpoppler73 libproj-dev libproj12
  libqhull-dev libqhull-r7 libqhull7 libspatialite-dev libspatialite7
  libsqlite3-dev libsuperlu-dev libsuperlu5 libsz2 libtiff-dev libtiff5-dev
  libtiffxx5 liburiparser-dev liburiparser1 libwebp-dev libwebpdemux2
  libwebpmux3 libxerces-c-dev libxerces-c3.2 proj-bin proj-data uuid-dev
Suggested packages:
  libitpp-dev libboost-doc libboost1.65-doc libboost-atomic1.65-dev
  libboost-chrono1.65-dev libboost-container1.65-dev libboost-context1.65-dev
  libboost-coroutine1.65-dev libboost-date-time1.65-dev
  libboost-exception1.65-dev libboost-fiber1.65-dev
  libboost-filesystem1.65-dev libboost-graph1.65-dev
  libboost-graph-parallel1.65-dev libboost-iostreams1.65-dev
  libboost-locale1.65-dev libboost-log1.65-dev libboost-math1.65-dev
  libboost-mpi1.65-dev libboost-mpi-python1.65-dev libboost-numpy1.65-dev
  libboost-program-options1.65-dev libboost-python1.65-dev
  libboost-random1.65-dev libboost-regex1.65-dev
  libboost-serialization1.65-dev libboost-signals1.65-dev
  libboost-stacktrace1.65-dev libboost-system1.65-dev libboost-test1.65-dev
  libboost-thread1.65-dev libboost-timer1.65-dev libboost-type-erasure1.65-dev
  libboost-wave1.65-dev libboost1.65-tools-dev libmpfrc++-dev libntl-dev
  libgdal-doc libgeotiff-epsg geotiff-bin gdal-bin libhdf4-doc hdf4-tools
  libhdf5-doc netcdf-bin netcdf-doc ogdi-bin sqlite3-doc libsuperlu-doc
  libxerces-c-doc
The following NEW packages will be installed:
  default-libmysqlclient-dev gdal-data hdf5-helpers libaec-dev libaec0
  libarmadillo-dev libarmadillo8 libarpack2 libarpack2-dev libboost-dev
  libboost1.65-dev libdap-dev libdap25 libdapclient6v5 libdapserver7v5
  libepsilon-dev libepsilon1 libfreexl-dev libfreexl1 libfyba-dev libfyba0
  libgdal-dev libgdal20 libgeos-3.6.2 libgeos-c1v5 libgeos-dev libgeotiff-dev
  libgeotiff2 libgif-dev libhdf4-0-alt libhdf4-alt-dev libhdf5-100
  libhdf5-cpp-100 libhdf5-dev libjbig-dev libjson-c-dev libkml-dev libkmlbase1
  libkmlconvenience1 libkmldom1 libkmlengine1 libkmlregionator1 libkmlxsd1
  libminizip-dev libminizip1 libmysqlclient-dev libmysqlclient20 libnetcdf-dev
  libnetcdf13 libogdi3.2 libogdi3.2-dev libopenjp2-7 libopenjp2-7-dev
  libpoppler-dev libpoppler-private-dev libpoppler73 libproj-dev libproj12
  libqhull-dev libqhull-r7 libqhull7 libspatialite-dev libspatialite7
  libsqlite3-dev libsuperlu-dev libsuperlu5 libsz2 libtiff-dev libtiff5-dev
  libtiffxx5 liburiparser-dev liburiparser1 libwebp-dev libwebpdemux2
  libwebpmux3 libxerces-c-dev libxerces-c3.2 proj-bin proj-data uuid-dev
0 upgraded, 80 newly installed, 0 to remove and 47 not upgraded.
Need to get 43.3 MB of archives.
After this operation, 306 MB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libmysqlclient20 amd64 5.7.32-0ubuntu0.18.04.1 [690 kB]
Get:2 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libmysqlclient-dev amd64 5.7.32-0ubuntu0.18.04.1 [988 kB]
Get:3 http://archive.ubuntu.com/ubuntu bionic/main amd64 default-libmysqlclient-dev amd64 1.0.4 [3,736 B]
Get:4 http://archive.ubuntu.com/ubuntu bionic/universe amd64 gdal-data all 2.2.3+dfsg-2 [363 kB]
Get:5 http://archive.ubuntu.com/ubuntu bionic/universe amd64 hdf5-helpers amd64 1.10.0-patch1+docs-4 [12.3 kB]
Get:6 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libaec0 amd64 0.3.2-2 [18.1 kB]
Get:7 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libarpack2 amd64 3.5.0+real-2 [89.7 kB]
Get:8 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libsuperlu5 amd64 5.2.1+dfsg1-3 [161 kB]
Get:9 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libarmadillo8 amd64 1:8.400.0+dfsg-2 [81.9 kB]
Get:10 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libarpack2-dev amd64 3.5.0+real-2 [97.3 kB]
Get:11 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libsz2 amd64 0.3.2-2 [5,114 B]
Get:12 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libhdf5-100 amd64 1.10.0-patch1+docs-4 [1,256 kB]
Get:13 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libaec-dev amd64 0.3.2-2 [16.4 kB]
Get:14 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libhdf5-cpp-100 amd64 1.10.0-patch1+docs-4 [104 kB]
Get:15 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libhdf5-dev amd64 1.10.0-patch1+docs-4 [2,461 kB]
Get:16 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libsuperlu-dev amd64 5.2.1+dfsg1-3 [16.3 kB]
Get:17 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libarmadillo-dev amd64 1:8.400.0+dfsg-2 [340 kB]
Get:18 http://archive.ubuntu.com/ubuntu bionic/main amd64 libboost1.65-dev amd64 1.65.1+dfsg-0ubuntu5 [7,218 kB]
Get:19 http://archive.ubuntu.com/ubuntu bionic/main amd64 libboost-dev amd64 1.65.1.0ubuntu1 [3,128 B]
Get:20 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libdap25 amd64 3.19.1-2build1 [426 kB]
Get:21 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libdapserver7v5 amd64 3.19.1-2build1 [22.2 kB]
Get:22 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libdapclient6v5 amd64 3.19.1-2build1 [88.9 kB]
Get:23 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 uuid-dev amd64 2.31.1-0.4ubuntu3.7 [33.2 kB]
Get:24 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libdap-dev amd64 3.19.1-2build1 [710 kB]
Get:25 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libepsilon1 amd64 0.9.2+dfsg-2 [41.2 kB]
Get:26 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfyba0 amd64 4.1.1-3 [110 kB]
Get:27 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfyba-dev amd64 4.1.1-3 [436 kB]
Get:28 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfreexl1 amd64 1.0.5-1 [33.4 kB]
Get:29 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgeos-3.6.2 amd64 3.6.2-1build2 [476 kB]
Get:30 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgeos-c1v5 amd64 3.6.2-1build2 [54.9 kB]
Get:31 http://archive.ubuntu.com/ubuntu bionic/universe amd64 proj-data all 4.9.3-2 [4,020 kB]
Get:32 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libproj12 amd64 4.9.3-2 [159 kB]
Get:33 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgeotiff2 amd64 1.4.2-2build1 [58.5 kB]
Get:34 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libhdf4-0-alt amd64 4.2.13-2 [267 kB]
Get:35 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libminizip1 amd64 1.1-8build1 [20.2 kB]
Get:36 http://archive.ubuntu.com/ubuntu bionic/universe amd64 liburiparser1 amd64 0.8.4-1 [38.0 kB]
Get:37 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkmlbase1 amd64 1.3.0-5 [44.9 kB]
Get:38 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkmldom1 amd64 1.3.0-5 [165 kB]
Get:39 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkmlengine1 amd64 1.3.0-5 [73.7 kB]
Get:40 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libnetcdf13 amd64 1:4.6.0-2build1 [333 kB]
Get:41 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libogdi3.2 amd64 3.2.0+ds-2 [213 kB]
Get:42 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 libopenjp2-7 amd64 2.3.0-2build0.18.04.1 [145 kB]
Get:43 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libpoppler73 amd64 0.62.0-2ubuntu2.12 [800 kB]
Get:44 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libqhull7 amd64 2015.2-4 [152 kB]
Get:45 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libspatialite7 amd64 4.3.0a-5build1 [1,224 kB]
Get:46 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libxerces-c3.2 amd64 3.2.0+debian-2 [851 kB]
Get:47 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgdal20 amd64 2.2.3+dfsg-2 [5,099 kB]
Get:48 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgeos-dev amd64 3.6.2-1build2 [73.1 kB]
Get:49 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libgif-dev amd64 5.1.4-2ubuntu0.1 [20.6 kB]
Get:50 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkmlconvenience1 amd64 1.3.0-5 [43.1 kB]
Get:51 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkmlregionator1 amd64 1.3.0-5 [19.0 kB]
Get:52 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkmlxsd1 amd64 1.3.0-5 [29.5 kB]
Get:53 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libminizip-dev amd64 1.1-8build1 [26.7 kB]
Get:54 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libnetcdf-dev amd64 1:4.6.0-2build1 [37.6 kB]
Get:55 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libpoppler-dev amd64 0.62.0-2ubuntu2.12 [4,620 B]
Get:56 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libpoppler-private-dev amd64 0.62.0-2ubuntu2.12 [169 kB]
Get:57 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libqhull-r7 amd64 2015.2-4 [149 kB]
Get:58 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libqhull-dev amd64 2015.2-4 [357 kB]
Get:59 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libsqlite3-dev amd64 3.22.0-1ubuntu0.4 [633 kB]
Get:60 http://archive.ubuntu.com/ubuntu bionic/main amd64 libjbig-dev amd64 2.1-3.1build1 [25.2 kB]
Get:61 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libtiffxx5 amd64 4.0.9-5ubuntu0.3 [5,800 B]
Get:62 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libtiff5-dev amd64 4.0.9-5ubuntu0.3 [274 kB]
Get:63 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libtiff-dev amd64 4.0.9-5ubuntu0.3 [2,260 B]
Get:64 http://archive.ubuntu.com/ubuntu bionic/universe amd64 liburiparser-dev amd64 0.8.4-1 [10.0 kB]
Get:65 http://archive.ubuntu.com/ubuntu bionic/main amd64 libwebpdemux2 amd64 0.6.1-2 [9,472 B]
Get:66 http://archive.ubuntu.com/ubuntu bionic/main amd64 libwebpmux3 amd64 0.6.1-2 [19.6 kB]
Get:67 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libxerces-c-dev amd64 3.2.0+debian-2 [1,627 kB]
Get:68 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libepsilon-dev amd64 0.9.2+dfsg-2 [49.3 kB]
Get:69 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfreexl-dev amd64 1.0.5-1 [30.9 kB]
Get:70 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgeotiff-dev amd64 1.4.2-2build1 [82.6 kB]
Get:71 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libhdf4-alt-dev amd64 4.2.13-2 [368 kB]
Get:72 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libjson-c-dev amd64 0.12.1-1.3ubuntu0.3 [31.9 kB]
Get:73 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libkml-dev amd64 1.3.0-5 [933 kB]
Get:74 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libproj-dev amd64 4.9.3-2 [199 kB]
Get:75 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libogdi3.2-dev amd64 3.2.0+ds-2 [23.6 kB]
Get:76 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 libopenjp2-7-dev amd64 2.3.0-2build0.18.04.1 [26.6 kB]
Get:77 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libspatialite-dev amd64 4.3.0a-5build1 [1,323 kB]
Get:78 http://archive.ubuntu.com/ubuntu bionic/main amd64 libwebp-dev amd64 0.6.1-2 [267 kB]
Get:79 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libgdal-dev amd64 2.2.3+dfsg-2 [6,369 kB]
Get:80 http://archive.ubuntu.com/ubuntu bionic/universe amd64 proj-bin amd64 4.9.3-2 [32.3 kB]
debconf: delaying package configuration, since apt-utils is not installed
Fetched 43.3 MB in 24s (1,820 kB/s)
Selecting previously unselected package libmysqlclient20:amd64.
(Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 91363 files and directories currently installed.)
Preparing to unpack .../00-libmysqlclient20_5.7.32-0ubuntu0.18.04.1_amd64.deb ...
Unpacking libmysqlclient20:amd64 (5.7.32-0ubuntu0.18.04.1) ...
Selecting previously unselected package libmysqlclient-dev.
Preparing to unpack .../01-libmysqlclient-dev_5.7.32-0ubuntu0.18.04.1_amd64.deb ...
Unpacking libmysqlclient-dev (5.7.32-0ubuntu0.18.04.1) ...
Selecting previously unselected package default-libmysqlclient-dev:amd64.
Preparing to unpack .../02-default-libmysqlclient-dev_1.0.4_amd64.deb ...
Unpacking default-libmysqlclient-dev:amd64 (1.0.4) ...
Selecting previously unselected package gdal-data.
Preparing to unpack .../03-gdal-data_2.2.3+dfsg-2_all.deb ...
Unpacking gdal-data (2.2.3+dfsg-2) ...
Selecting previously unselected package hdf5-helpers.
Preparing to unpack .../04-hdf5-helpers_1.10.0-patch1+docs-4_amd64.deb ...
Unpacking hdf5-helpers (1.10.0-patch1+docs-4) ...
Selecting previously unselected package libaec0:amd64.
Preparing to unpack .../05-libaec0_0.3.2-2_amd64.deb ...
Unpacking libaec0:amd64 (0.3.2-2) ...
Selecting previously unselected package libarpack2:amd64.
Preparing to unpack .../06-libarpack2_3.5.0+real-2_amd64.deb ...
Unpacking libarpack2:amd64 (3.5.0+real-2) ...
Selecting previously unselected package libsuperlu5:amd64.
Preparing to unpack .../07-libsuperlu5_5.2.1+dfsg1-3_amd64.deb ...
Unpacking libsuperlu5:amd64 (5.2.1+dfsg1-3) ...
Selecting previously unselected package libarmadillo8.
Preparing to unpack .../08-libarmadillo8_1%3a8.400.0+dfsg-2_amd64.deb ...
Unpacking libarmadillo8 (1:8.400.0+dfsg-2) ...
Selecting previously unselected package libarpack2-dev:amd64.
Preparing to unpack .../09-libarpack2-dev_3.5.0+real-2_amd64.deb ...
Unpacking libarpack2-dev:amd64 (3.5.0+real-2) ...
Selecting previously unselected package libsz2:amd64.
Preparing to unpack .../10-libsz2_0.3.2-2_amd64.deb ...
Unpacking libsz2:amd64 (0.3.2-2) ...
Selecting previously unselected package libhdf5-100:amd64.
Preparing to unpack .../11-libhdf5-100_1.10.0-patch1+docs-4_amd64.deb ...
Unpacking libhdf5-100:amd64 (1.10.0-patch1+docs-4) ...
Selecting previously unselected package libaec-dev:amd64.
Preparing to unpack .../12-libaec-dev_0.3.2-2_amd64.deb ...
Unpacking libaec-dev:amd64 (0.3.2-2) ...
Selecting previously unselected package libhdf5-cpp-100:amd64.
Preparing to unpack .../13-libhdf5-cpp-100_1.10.0-patch1+docs-4_amd64.deb ...
Unpacking libhdf5-cpp-100:amd64 (1.10.0-patch1+docs-4) ...
Selecting previously unselected package libhdf5-dev.
Preparing to unpack .../14-libhdf5-dev_1.10.0-patch1+docs-4_amd64.deb ...
Unpacking libhdf5-dev (1.10.0-patch1+docs-4) ...
Selecting previously unselected package libsuperlu-dev:amd64.
Preparing to unpack .../15-libsuperlu-dev_5.2.1+dfsg1-3_amd64.deb ...
Unpacking libsuperlu-dev:amd64 (5.2.1+dfsg1-3) ...
Selecting previously unselected package libarmadillo-dev.
Preparing to unpack .../16-libarmadillo-dev_1%3a8.400.0+dfsg-2_amd64.deb ...
Unpacking libarmadillo-dev (1:8.400.0+dfsg-2) ...
Selecting previously unselected package libboost1.65-dev:amd64.
Preparing to unpack .../17-libboost1.65-dev_1.65.1+dfsg-0ubuntu5_amd64.deb ...
Unpacking libboost1.65-dev:amd64 (1.65.1+dfsg-0ubuntu5) ...
Selecting previously unselected package libboost-dev:amd64.
Preparing to unpack .../18-libboost-dev_1.65.1.0ubuntu1_amd64.deb ...
Unpacking libboost-dev:amd64 (1.65.1.0ubuntu1) ...
Selecting previously unselected package libdap25:amd64.
Preparing to unpack .../19-libdap25_3.19.1-2build1_amd64.deb ...
Unpacking libdap25:amd64 (3.19.1-2build1) ...
Selecting previously unselected package libdapserver7v5:amd64.
Preparing to unpack .../20-libdapserver7v5_3.19.1-2build1_amd64.deb ...
Unpacking libdapserver7v5:amd64 (3.19.1-2build1) ...
Selecting previously unselected package libdapclient6v5:amd64.
Preparing to unpack .../21-libdapclient6v5_3.19.1-2build1_amd64.deb ...
Unpacking libdapclient6v5:amd64 (3.19.1-2build1) ...
Selecting previously unselected package uuid-dev:amd64.
Preparing to unpack .../22-uuid-dev_2.31.1-0.4ubuntu3.7_amd64.deb ...
Unpacking uuid-dev:amd64 (2.31.1-0.4ubuntu3.7) ...
Selecting previously unselected package libdap-dev:amd64.
Preparing to unpack .../23-libdap-dev_3.19.1-2build1_amd64.deb ...
Unpacking libdap-dev:amd64 (3.19.1-2build1) ...
Selecting previously unselected package libepsilon1:amd64.
Preparing to unpack .../24-libepsilon1_0.9.2+dfsg-2_amd64.deb ...
Unpacking libepsilon1:amd64 (0.9.2+dfsg-2) ...
Selecting previously unselected package libfyba0:amd64.
Preparing to unpack .../25-libfyba0_4.1.1-3_amd64.deb ...
Unpacking libfyba0:amd64 (4.1.1-3) ...
Selecting previously unselected package libfyba-dev:amd64.
Preparing to unpack .../26-libfyba-dev_4.1.1-3_amd64.deb ...
Unpacking libfyba-dev:amd64 (4.1.1-3) ...
Selecting previously unselected package libfreexl1:amd64.
Preparing to unpack .../27-libfreexl1_1.0.5-1_amd64.deb ...
Unpacking libfreexl1:amd64 (1.0.5-1) ...
Selecting previously unselected package libgeos-3.6.2:amd64.
Preparing to unpack .../28-libgeos-3.6.2_3.6.2-1build2_amd64.deb ...
Unpacking libgeos-3.6.2:amd64 (3.6.2-1build2) ...
Selecting previously unselected package libgeos-c1v5:amd64.
Preparing to unpack .../29-libgeos-c1v5_3.6.2-1build2_amd64.deb ...
Unpacking libgeos-c1v5:amd64 (3.6.2-1build2) ...
Selecting previously unselected package proj-data.
Preparing to unpack .../30-proj-data_4.9.3-2_all.deb ...
Unpacking proj-data (4.9.3-2) ...
Selecting previously unselected package libproj12:amd64.
Preparing to unpack .../31-libproj12_4.9.3-2_amd64.deb ...
Unpacking libproj12:amd64 (4.9.3-2) ...
Selecting previously unselected package libgeotiff2:amd64.
Preparing to unpack .../32-libgeotiff2_1.4.2-2build1_amd64.deb ...
Unpacking libgeotiff2:amd64 (1.4.2-2build1) ...
Selecting previously unselected package libhdf4-0-alt.
Preparing to unpack .../33-libhdf4-0-alt_4.2.13-2_amd64.deb ...
Unpacking libhdf4-0-alt (4.2.13-2) ...
Selecting previously unselected package libminizip1:amd64.
Preparing to unpack .../34-libminizip1_1.1-8build1_amd64.deb ...
Unpacking libminizip1:amd64 (1.1-8build1) ...
Selecting previously unselected package liburiparser1:amd64.
Preparing to unpack .../35-liburiparser1_0.8.4-1_amd64.deb ...
Unpacking liburiparser1:amd64 (0.8.4-1) ...
Selecting previously unselected package libkmlbase1:amd64.
Preparing to unpack .../36-libkmlbase1_1.3.0-5_amd64.deb ...
Unpacking libkmlbase1:amd64 (1.3.0-5) ...
Selecting previously unselected package libkmldom1:amd64.
Preparing to unpack .../37-libkmldom1_1.3.0-5_amd64.deb ...
Unpacking libkmldom1:amd64 (1.3.0-5) ...
Selecting previously unselected package libkmlengine1:amd64.
Preparing to unpack .../38-libkmlengine1_1.3.0-5_amd64.deb ...
Unpacking libkmlengine1:amd64 (1.3.0-5) ...
Selecting previously unselected package libnetcdf13:amd64.
Preparing to unpack .../39-libnetcdf13_1%3a4.6.0-2build1_amd64.deb ...
Unpacking libnetcdf13:amd64 (1:4.6.0-2build1) ...
Selecting previously unselected package libogdi3.2.
Preparing to unpack .../40-libogdi3.2_3.2.0+ds-2_amd64.deb ...
Unpacking libogdi3.2 (3.2.0+ds-2) ...
Selecting previously unselected package libopenjp2-7:amd64.
Preparing to unpack .../41-libopenjp2-7_2.3.0-2build0.18.04.1_amd64.deb ...
Unpacking libopenjp2-7:amd64 (2.3.0-2build0.18.04.1) ...
Selecting previously unselected package libpoppler73:amd64.
Preparing to unpack .../42-libpoppler73_0.62.0-2ubuntu2.12_amd64.deb ...
Unpacking libpoppler73:amd64 (0.62.0-2ubuntu2.12) ...
Selecting previously unselected package libqhull7:amd64.
Preparing to unpack .../43-libqhull7_2015.2-4_amd64.deb ...
Unpacking libqhull7:amd64 (2015.2-4) ...
Selecting previously unselected package libspatialite7:amd64.
Preparing to unpack .../44-libspatialite7_4.3.0a-5build1_amd64.deb ...
Unpacking libspatialite7:amd64 (4.3.0a-5build1) ...
Selecting previously unselected package libxerces-c3.2:amd64.
Preparing to unpack .../45-libxerces-c3.2_3.2.0+debian-2_amd64.deb ...
Unpacking libxerces-c3.2:amd64 (3.2.0+debian-2) ...
Selecting previously unselected package libgdal20.
Preparing to unpack .../46-libgdal20_2.2.3+dfsg-2_amd64.deb ...
Unpacking libgdal20 (2.2.3+dfsg-2) ...
Selecting previously unselected package libgeos-dev.
Preparing to unpack .../47-libgeos-dev_3.6.2-1build2_amd64.deb ...
Unpacking libgeos-dev (3.6.2-1build2) ...
Selecting previously unselected package libgif-dev.
Preparing to unpack .../48-libgif-dev_5.1.4-2ubuntu0.1_amd64.deb ...
Unpacking libgif-dev (5.1.4-2ubuntu0.1) ...
Selecting previously unselected package libkmlconvenience1:amd64.
Preparing to unpack .../49-libkmlconvenience1_1.3.0-5_amd64.deb ...
Unpacking libkmlconvenience1:amd64 (1.3.0-5) ...
Selecting previously unselected package libkmlregionator1:amd64.
Preparing to unpack .../50-libkmlregionator1_1.3.0-5_amd64.deb ...
Unpacking libkmlregionator1:amd64 (1.3.0-5) ...
Selecting previously unselected package libkmlxsd1:amd64.
Preparing to unpack .../51-libkmlxsd1_1.3.0-5_amd64.deb ...
Unpacking libkmlxsd1:amd64 (1.3.0-5) ...
Selecting previously unselected package libminizip-dev:amd64.
Preparing to unpack .../52-libminizip-dev_1.1-8build1_amd64.deb ...
Unpacking libminizip-dev:amd64 (1.1-8build1) ...
Selecting previously unselected package libnetcdf-dev.
Preparing to unpack .../53-libnetcdf-dev_1%3a4.6.0-2build1_amd64.deb ...
Unpacking libnetcdf-dev (1:4.6.0-2build1) ...
Selecting previously unselected package libpoppler-dev:amd64.
Preparing to unpack .../54-libpoppler-dev_0.62.0-2ubuntu2.12_amd64.deb ...
Unpacking libpoppler-dev:amd64 (0.62.0-2ubuntu2.12) ...
Selecting previously unselected package libpoppler-private-dev:amd64.
Preparing to unpack .../55-libpoppler-private-dev_0.62.0-2ubuntu2.12_amd64.deb ...
Unpacking libpoppler-private-dev:amd64 (0.62.0-2ubuntu2.12) ...
Selecting previously unselected package libqhull-r7:amd64.
Preparing to unpack .../56-libqhull-r7_2015.2-4_amd64.deb ...
Unpacking libqhull-r7:amd64 (2015.2-4) ...
Selecting previously unselected package libqhull-dev:amd64.
Preparing to unpack .../57-libqhull-dev_2015.2-4_amd64.deb ...
Unpacking libqhull-dev:amd64 (2015.2-4) ...
Selecting previously unselected package libsqlite3-dev:amd64.
Preparing to unpack .../58-libsqlite3-dev_3.22.0-1ubuntu0.4_amd64.deb ...
Unpacking libsqlite3-dev:amd64 (3.22.0-1ubuntu0.4) ...
Selecting previously unselected package libjbig-dev:amd64.
Preparing to unpack .../59-libjbig-dev_2.1-3.1build1_amd64.deb ...
Unpacking libjbig-dev:amd64 (2.1-3.1build1) ...
Selecting previously unselected package libtiffxx5:amd64.
Preparing to unpack .../60-libtiffxx5_4.0.9-5ubuntu0.3_amd64.deb ...
Unpacking libtiffxx5:amd64 (4.0.9-5ubuntu0.3) ...
Selecting previously unselected package libtiff5-dev:amd64.
Preparing to unpack .../61-libtiff5-dev_4.0.9-5ubuntu0.3_amd64.deb ...
Unpacking libtiff5-dev:amd64 (4.0.9-5ubuntu0.3) ...
Selecting previously unselected package libtiff-dev.
Preparing to unpack .../62-libtiff-dev_4.0.9-5ubuntu0.3_amd64.deb ...
Unpacking libtiff-dev (4.0.9-5ubuntu0.3) ...
Selecting previously unselected package liburiparser-dev.
Preparing to unpack .../63-liburiparser-dev_0.8.4-1_amd64.deb ...
Unpacking liburiparser-dev (0.8.4-1) ...
Selecting previously unselected package libwebpdemux2:amd64.
Preparing to unpack .../64-libwebpdemux2_0.6.1-2_amd64.deb ...
Unpacking libwebpdemux2:amd64 (0.6.1-2) ...
Selecting previously unselected package libwebpmux3:amd64.
Preparing to unpack .../65-libwebpmux3_0.6.1-2_amd64.deb ...
Unpacking libwebpmux3:amd64 (0.6.1-2) ...
Selecting previously unselected package libxerces-c-dev.
Preparing to unpack .../66-libxerces-c-dev_3.2.0+debian-2_amd64.deb ...
Unpacking libxerces-c-dev (3.2.0+debian-2) ...
Selecting previously unselected package libepsilon-dev:amd64.
Preparing to unpack .../67-libepsilon-dev_0.9.2+dfsg-2_amd64.deb ...
Unpacking libepsilon-dev:amd64 (0.9.2+dfsg-2) ...
Selecting previously unselected package libfreexl-dev:amd64.
Preparing to unpack .../68-libfreexl-dev_1.0.5-1_amd64.deb ...
Unpacking libfreexl-dev:amd64 (1.0.5-1) ...
Selecting previously unselected package libgeotiff-dev:amd64.
Preparing to unpack .../69-libgeotiff-dev_1.4.2-2build1_amd64.deb ...
Unpacking libgeotiff-dev:amd64 (1.4.2-2build1) ...
Selecting previously unselected package libhdf4-alt-dev.
Preparing to unpack .../70-libhdf4-alt-dev_4.2.13-2_amd64.deb ...
Unpacking libhdf4-alt-dev (4.2.13-2) ...
Selecting previously unselected package libjson-c-dev:amd64.
Preparing to unpack .../71-libjson-c-dev_0.12.1-1.3ubuntu0.3_amd64.deb ...
Unpacking libjson-c-dev:amd64 (0.12.1-1.3ubuntu0.3) ...
Selecting previously unselected package libkml-dev:amd64.
Preparing to unpack .../72-libkml-dev_1.3.0-5_amd64.deb ...
Unpacking libkml-dev:amd64 (1.3.0-5) ...
Selecting previously unselected package libproj-dev:amd64.
Preparing to unpack .../73-libproj-dev_4.9.3-2_amd64.deb ...
Unpacking libproj-dev:amd64 (4.9.3-2) ...
Selecting previously unselected package libogdi3.2-dev.
Preparing to unpack .../74-libogdi3.2-dev_3.2.0+ds-2_amd64.deb ...
Unpacking libogdi3.2-dev (3.2.0+ds-2) ...
Selecting previously unselected package libopenjp2-7-dev.
Preparing to unpack .../75-libopenjp2-7-dev_2.3.0-2build0.18.04.1_amd64.deb ...
Unpacking libopenjp2-7-dev (2.3.0-2build0.18.04.1) ...
Selecting previously unselected package libspatialite-dev:amd64.
Preparing to unpack .../76-libspatialite-dev_4.3.0a-5build1_amd64.deb ...
Unpacking libspatialite-dev:amd64 (4.3.0a-5build1) ...
Selecting previously unselected package libwebp-dev:amd64.
Preparing to unpack .../77-libwebp-dev_0.6.1-2_amd64.deb ...
Unpacking libwebp-dev:amd64 (0.6.1-2) ...
Selecting previously unselected package libgdal-dev.
Preparing to unpack .../78-libgdal-dev_2.2.3+dfsg-2_amd64.deb ...
Unpacking libgdal-dev (2.2.3+dfsg-2) ...
Selecting previously unselected package proj-bin.
Preparing to unpack .../79-proj-bin_4.9.3-2_amd64.deb ...
Unpacking proj-bin (4.9.3-2) ...
Setting up libminizip1:amd64 (1.1-8build1) ...
Setting up libaec0:amd64 (0.3.2-2) ...
Setting up libdap25:amd64 (3.19.1-2build1) ...
Setting up libopenjp2-7:amd64 (2.3.0-2build0.18.04.1) ...
Setting up libqhull7:amd64 (2015.2-4) ...
Setting up libsqlite3-dev:amd64 (3.22.0-1ubuntu0.4) ...
Setting up libgif-dev (5.1.4-2ubuntu0.1) ...
Setting up libgeos-3.6.2:amd64 (3.6.2-1build2) ...
Setting up uuid-dev:amd64 (2.31.1-0.4ubuntu3.7) ...
Setting up libopenjp2-7-dev (2.3.0-2build0.18.04.1) ...
Setting up libepsilon1:amd64 (0.9.2+dfsg-2) ...
Setting up libminizip-dev:amd64 (1.1-8build1) ...
Setting up libsuperlu5:amd64 (5.2.1+dfsg1-3) ...
Setting up libfreexl1:amd64 (1.0.5-1) ...
Setting up libfyba0:amd64 (4.1.1-3) ...
Setting up libjbig-dev:amd64 (2.1-3.1build1) ...
Setting up libdapclient6v5:amd64 (3.19.1-2build1) ...
Setting up gdal-data (2.2.3+dfsg-2) ...
Setting up libpoppler73:amd64 (0.62.0-2ubuntu2.12) ...
Setting up libgeos-c1v5:amd64 (3.6.2-1build2) ...
Setting up libsuperlu-dev:amd64 (5.2.1+dfsg1-3) ...
Setting up libdapserver7v5:amd64 (3.19.1-2build1) ...
Setting up libwebpmux3:amd64 (0.6.1-2) ...
Setting up libjson-c-dev:amd64 (0.12.1-1.3ubuntu0.3) ...
Setting up libtiffxx5:amd64 (4.0.9-5ubuntu0.3) ...
Setting up libwebpdemux2:amd64 (0.6.1-2) ...
Setting up libarpack2:amd64 (3.5.0+real-2) ...
Setting up libmysqlclient20:amd64 (5.7.32-0ubuntu0.18.04.1) ...
Setting up libhdf4-0-alt (4.2.13-2) ...
Setting up libfyba-dev:amd64 (4.1.1-3) ...
Setting up libboost1.65-dev:amd64 (1.65.1+dfsg-0ubuntu5) ...
Setting up hdf5-helpers (1.10.0-patch1+docs-4) ...
Setting up libqhull-r7:amd64 (2015.2-4) ...
Setting up libxerces-c3.2:amd64 (3.2.0+debian-2) ...
Setting up liburiparser1:amd64 (0.8.4-1) ...
Setting up libsz2:amd64 (0.3.2-2) ...
Setting up proj-data (4.9.3-2) ...
Setting up libfreexl-dev:amd64 (1.0.5-1) ...
Setting up libproj12:amd64 (4.9.3-2) ...
Setting up libxerces-c-dev (3.2.0+debian-2) ...
Setting up libpoppler-dev:amd64 (0.62.0-2ubuntu2.12) ...
Setting up libhdf5-100:amd64 (1.10.0-patch1+docs-4) ...
Setting up libdap-dev:amd64 (3.19.1-2build1) ...
Setting up libmysqlclient-dev (5.7.32-0ubuntu0.18.04.1) ...
Setting up libepsilon-dev:amd64 (0.9.2+dfsg-2) ...
Setting up libtiff5-dev:amd64 (4.0.9-5ubuntu0.3) ...
Setting up libaec-dev:amd64 (0.3.2-2) ...
Setting up libgeos-dev (3.6.2-1build2) ...
Setting up libkmlbase1:amd64 (1.3.0-5) ...
Setting up libqhull-dev:amd64 (2015.2-4) ...
Setting up libwebp-dev:amd64 (0.6.1-2) ...
Setting up libarmadillo8 (1:8.400.0+dfsg-2) ...
Setting up libogdi3.2 (3.2.0+ds-2) ...
Setting up libkmlxsd1:amd64 (1.3.0-5) ...
Setting up proj-bin (4.9.3-2) ...
Setting up libgeotiff2:amd64 (1.4.2-2build1) ...
Setting up libnetcdf13:amd64 (1:4.6.0-2build1) ...
Setting up libarpack2-dev:amd64 (3.5.0+real-2) ...
Setting up libspatialite7:amd64 (4.3.0a-5build1) ...
Setting up liburiparser-dev (0.8.4-1) ...
Setting up libkmldom1:amd64 (1.3.0-5) ...
Setting up default-libmysqlclient-dev:amd64 (1.0.4) ...
Setting up libboost-dev:amd64 (1.65.1.0ubuntu1) ...
Setting up libspatialite-dev:amd64 (4.3.0a-5build1) ...
Setting up libtiff-dev (4.0.9-5ubuntu0.3) ...
Setting up libgeotiff-dev:amd64 (1.4.2-2build1) ...
Setting up libproj-dev:amd64 (4.9.3-2) ...
Setting up libpoppler-private-dev:amd64 (0.62.0-2ubuntu2.12) ...
Setting up libhdf5-cpp-100:amd64 (1.10.0-patch1+docs-4) ...
Setting up libhdf5-dev (1.10.0-patch1+docs-4) ...
update-alternatives: using /usr/lib/x86_64-linux-gnu/pkgconfig/hdf5-serial.pc to provide /usr/lib/x86_64-linux-gnu/pkgconfig/hdf5.pc (hdf5.pc) in auto mode
Setting up libogdi3.2-dev (3.2.0+ds-2) ...
Setting up libkmlengine1:amd64 (1.3.0-5) ...
Setting up libnetcdf-dev (1:4.6.0-2build1) ...
Setting up libarmadillo-dev (1:8.400.0+dfsg-2) ...
Setting up libgdal20 (2.2.3+dfsg-2) ...
Setting up libkmlconvenience1:amd64 (1.3.0-5) ...
Setting up libhdf4-alt-dev (4.2.13-2) ...
Setting up libkmlregionator1:amd64 (1.3.0-5) ...
Setting up libkml-dev:amd64 (1.3.0-5) ...
Setting up libgdal-dev (2.2.3+dfsg-2) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...
Processing triggers for libc-bin (2.27-3ubuntu1.3) ...
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># %r</span>
<span class="c1"># install.packages(&quot;cartogram&quot;)</span>
<span class="c1"># install.packages(&quot;maptools&quot;)</span>
<span class="c1"># install.packages(&quot;rgeos&quot;)</span>
<span class="c1"># install.packages(&quot;sf&quot;)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="loading-data">
<h4>Loading data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#importing libraries
library(maptools)
library(cartogram)
library(rgeos)
library(sf)

### Load csv data into data frame ###
if (nchar(Sys.getenv(&quot;SPARK_HOME&quot;)) &lt; 1) {
  Sys.setenv(SPARK_HOME = &quot;/home/spark&quot;)
}
library(SparkR, lib.loc = c(file.path(Sys.getenv(&quot;SPARK_HOME&quot;), &quot;R&quot;, &quot;lib&quot;)))
sparkR.session(master = &quot;local[*]&quot;, sparkConfig = list(spark.driver.memory = &quot;2g&quot;))

sparkR.session(sparkPackages = &quot;org.apache.spark:spark-avro_2.12:3.0.1&quot;)

csvPath &lt;- &#39;/datasets/ScaDaMaLe/twitter/student-project-10_group-Geosmus/tmp/tmp.csv&#39;

df &lt;- read.df(csvPath, &quot;csv&quot;, header = &quot;true&quot;, inferSchema = &quot;true&quot;, na.strings = &quot;NA&quot;)
names(df)[names(df) == &quot;countryCode&quot;] &lt;- &quot;ISO2&quot;
names(df)[names(df) == &quot;count&quot;] &lt;- &quot;numTweets&quot;
local_df &lt;- collect(df)

### Load the world spatialpolygondataframe ###
data(wrld_simpl)
my_map=wrld_simpl#[wrld_simpl$REGION==150,]

### Merge the spatialpolygondataframe and the data frame
df_tweet &lt;- merge(my_map, local_df,  by.x=&#39;ISO2&#39;, by.y=&#39;ISO2&#39;)
df_tweet &lt;- df_tweet[!is.na(df_tweet$numTweets), ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_tweet</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>df_tweet_sf = st_as_sf(df_tweet)
df_tweet_sf_proj = st_transform(df_tweet_sf, 3857) #Mercator (EPSG: 3857)
drops &lt;- c(&quot;UN&quot;, &quot;FIPS&quot;, &quot;ISO3&quot;, &quot;REGION&quot;, &quot;LON&quot;, &quot;LAT&quot;, &quot;AREA&quot;, &quot;NAME&quot;, &quot;SUBREGION&quot;, &quot;popden&quot;)
df_tweet_sf_proj &lt;- df_tweet_sf_proj[ , !(names(df_tweet_sf_proj) %in% drops)]
 
# construct a cartogram using the number of tweets
df_tweet_cartogram &lt;- cartogram_cont(df_tweet_sf_proj, &quot;numTweets&quot;, itermax=20)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="todo-z-axis">
<h4>TODO: z-axis<a class="headerlink" href="#todo-z-axis" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>drops &lt;- c(&quot;UN&quot;, &quot;FIPS&quot;, &quot;ISO3&quot;, &quot;REGION&quot;, &quot;LON&quot;, &quot;LAT&quot;, &quot;AREA&quot;, &quot;NAME&quot;, &quot;SUBREGION&quot;, &quot;popden&quot;)
plot(df_tweet_cartogram[ , !(names(my_map) %in% drops)])
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="alternative-r-approach">
<h3>Alternative R approach<a class="headerlink" href="#alternative-r-approach" title="Permalink to this headline">¶</a></h3>
<p>The cartogram package is rather slow, and doesn’t seem to always
converge. In fact increasing the number of iterations sometimes leads to
worse performance. The rcartogram package is based on Mark Newman’s
method (and C code) and should be faster and hopefully also more
reliable. Uncomment the following cell to install on a new cluster.</p>
<p>This one is harder to install. I have not managed to get it to work so
far.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># %sh</span>
<span class="c1"># sudo apt-get update -y</span>
<span class="c1"># sudo apt-get install -y libfftw3-dev</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Hit:1 https://repos.azul.com/zulu/deb stable InRelease
Ign:2 http://repos.azulsystems.com/ubuntu stable InRelease
Hit:3 http://repos.azulsystems.com/ubuntu stable Release
Get:4 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Hit:6 http://archive.ubuntu.com/ubuntu bionic InRelease
Get:7 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Get:8 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Fetched 252 kB in 1s (221 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
libfftw3-dev is already the newest version (3.3.7-1).
pkg-config is already the newest version (0.29.1-0ubuntu2).
pkg-config set to manually installed.
The following packages were automatically installed and are no longer required:
  libcap2-bin libpam-cap zulu-repo
Use &#39;sudo apt autoremove&#39; to remove them.
The following NEW packages will be installed:
  libfftw3-3
0 upgraded, 1 newly installed, 0 to remove and 47 not upgraded.
Need to get 1,748 B of archives.
After this operation, 29.7 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libfftw3-3 amd64 3.3.7-1 [1,748 B]
debconf: delaying package configuration, since apt-utils is not installed
Fetched 1,748 B in 0s (6,650 B/s)
Selecting previously unselected package libfftw3-3:amd64.
(Reading database ... 
(Reading database ... 5%
(Reading database ... 10%
(Reading database ... 15%
(Reading database ... 20%
(Reading database ... 25%
(Reading database ... 30%
(Reading database ... 35%
(Reading database ... 40%
(Reading database ... 45%
(Reading database ... 50%
(Reading database ... 55%
(Reading database ... 60%
(Reading database ... 65%
(Reading database ... 70%
(Reading database ... 75%
(Reading database ... 80%
(Reading database ... 85%
(Reading database ... 90%
(Reading database ... 95%
(Reading database ... 100%
(Reading database ... 108134 files and directories currently installed.)
Preparing to unpack .../libfftw3-3_3.3.7-1_amd64.deb ...
Unpacking libfftw3-3:amd64 (3.3.7-1) ...
Setting up libfftw3-3:amd64 (3.3.7-1) ...
</pre></div>
</div>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># %r</span>
<span class="c1"># install.packages(&quot;fftw&quot;)</span>
<span class="c1"># install.packages(&quot;remotes&quot;)</span>
<span class="c1"># remotes::install_github(&quot;omegahat/Rcartogram&quot;)</span>
<span class="c1"># install.packages(&quot;getcartr&quot;)</span>
<span class="c1"># install.packages(&quot;rgdal&quot;)</span>
<span class="c1"># install.packages(&quot;sp&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># %r</span>
<span class="c1"># library(rgdal)#needed for readOGR</span>
<span class="c1"># library(sp) #needed for spplot</span>
<span class="c1"># library(Rcartogram)</span>
<span class="c1"># library(getcartr)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./000_0-sds-3-x-projects/student-project-10_group-Geosmus"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By ScaDaMaLe Team<br/>
        
            &copy; Copyright 2020 Creative Commons Zero v1.0 Universal.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>